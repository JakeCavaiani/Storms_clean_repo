"MOOS_storm6_09_14_NO3",
"MOOS_storm6_09_14_fDOM",
"MOOS_storm6_09_14_SPC",
"MOOS_storm6_09_14_turb",
"MOOS_storm6_09_14_abs")
MOOS.hyst.results.df$site.ID = "MOOS"
write.csv(MOOS.hyst.results.df, here("Output_from_analysis", "03_HI_FI", "2015", "MOOS", "MOOS.hyst.results.csv"))
# plot HI by normalized discharge
# HIs.Q.list =list()
# HIs.df.list = list()
# pdf("~/Documents/Storms/Output_from_analysis/HI_plots/2021/MOOS/MOOS.hyst.HI_Q.plots.pdf", width = 25, height =15, onefile=FALSE)
# par(mfrow=c(4,7))
# for (i in 1:length(HIs.list)) {
#   HIs.Q.list[[i]] = names(HIs.list[[i]])
#   HIs.Q.list[[i]] = (sapply(strsplit(HIs.Q.list[[i]], " "), "[[", 4))
#   HIs.Q.list[[i]] = as.numeric(gsub("%", "", HIs.Q.list[[i]]))
#   HIs.df.list[[i]] = as.data.frame(cbind(HIs.list[[i]], HIs.Q.list[[i]]))
#   HIs.df.list[[i]]= HIs.df.list[[i]][order(HIs.df.list[[i]][["V2"]]),]
# plot(HIs.df.list[[i]][["V1"]] ~ HIs.df.list[[i]][["V2"]], type="l",
#      ylab="norm.response", xlab="Q intervals", main= MOOS.hyst.results.df$storm.ID[i])
# abline(h=0, lty=2)
# }
# dev.off()
## plot HI with bootstrapped 95% CIs around the median ##
HIs.Q.list =list()
HIs.df.list = list()
par(mfrow=c(1,1))
for (i in 1:length(HIs.list)) {
HIs.Q.list[[i]] = names(HIs.list[[i]])
HIs.Q.list[[i]] = (sapply(strsplit(HIs.Q.list[[i]], " "), "[[", 4))
HIs.Q.list[[i]] = as.numeric(gsub("%", "", HIs.Q.list[[i]]))
HIs.df.list[[i]] = as.data.frame(cbind(HIs.list[[i]], HIs.Q.list[[i]]))
HIs.df.list[[i]]= HIs.df.list[[i]][order(HIs.df.list[[i]][["V2"]]),]
names(HIs.df.list[[i]]) = c("HI", "Q_interval")
}
MOOS.HI.df = bind_rows(HIs.df.list, .id = "column_label")
MOOS.HI.df$storm.ID = c(rep("MOOS_storm1_07_01_NO3", 50),
rep("MOOS_storm1_07_01_fDOM", 50),
rep("MOOS_storm1_07_01_SPC", 50),
rep("MOOS_storm1_07_01_turb", 50),
rep("MOOS_storm1_07_01_abs", 50),
rep("MOOS_storm2_07_18_NO3", 49),
rep("MOOS_storm2_07_18_fDOM", 50),
rep("MOOS_storm2_07_18_SPC", 50),
rep("MOOS_storm2_07_18_turb", 50),
rep("MOOS_storm3a_07_27_NO3", 50),
rep("MOOS_storm3a_07_27_abs", 50),
rep("MOOS_storm4_08_16_NO3", 50),
rep("MOOS_storm4_08_16_fDOM", 50),
rep("MOOS_storm4_08_16_SPC", 50),
rep("MOOS_storm4_08_16_turb", 50),
rep("MOOS_storm4_08_16_abs", 50),
rep("MOOS_storm5_08_25_fDOM", 50),
rep("MOOS_storm5_08_25_turb", 50),
rep("MOOS_storm6_09_14_NO3", 50),
rep("MOOS_storm6_09_14_fDOM", 50),
rep("MOOS_storm6_09_14_SPC", 50),
rep("MOOS_storm6_09_14_turb", 50),
rep("MOOS_storm6_09_14_abs", 50))
MOOS.HI.df$storm.ID = as.factor(MOOS.HI.df$storm.ID)
MOOS.HI.df = separate(data=MOOS.HI.df, col=storm.ID, into=c("site.ID","storm.num", "month", "day", "response"), sep = "_", remove = F)
par(mfrow=c(1,1))
median_cl_boot <- function(x, conf = 0.95) {
lconf <- (1 - conf)/2
uconf <- 1 - lconf
require(boot)
bmedian <- function(x, ind) median(x[ind])
bt <- boot(x, bmedian, 10000)
bb <- boot.ci(bt, conf = 0.95, type = "perc")
data.frame(y = median(x), ymin = quantile(bt$t, lconf), ymax = quantile(bt$t,
uconf))
}
g0 <- ggplot(MOOS.HI.df, aes(x = storm.num, y = HI, label=storm.num, fill=response))
g1 = g0 + geom_jitter(width = 0.1, fill = "grey", colour = "#0571B0", alpha=0.25, size=3) +
theme(axis.text.x = element_text(angle = 0))+  labs(x="") + facet_wrap(~ response, scales = "free_x") +
theme_bw() +geom_hline(yintercept=0) + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(legend.position = "none")
g2 <- g1 +
stat_summary(fun.data = median_cl_boot, geom = "errorbar",
colour = "black", width = 0.2, size=1) +
stat_summary(fun.y = median, geom = "point",
colour = "black", size = 3)
ggsave(here("plots", "HI_plots", "2015", "MOOS", "MOOS.HI.median.boot.pdf"), plot = g2,
width = 8, height = 6, units = "in")
write.csv(MOOS.HI.df, here("Output_from_analysis", "03_HI_FI", "2015", "MOOS", "MOOS.HI.df.csv"))
MOOS.HI.df$date <- as.Date(with(MOOS.HI.df, paste(month, day, sep = "-")), "%m-%d")
MOOS.HI.df$doy <- yday(MOOS.HI.df$date)
g0 <- ggplot(MOOS.HI.df, aes(x = doy, y = HI, label=doy, fill=response))
g1 = g0 + geom_jitter(width = 0.1, fill = "grey", colour = "#0571B0", alpha=0.25, size=3) +
theme(axis.text.x = element_text(angle = 0))+  labs(x="") + facet_wrap(~ response, scales = "free_x") +
theme_bw() +geom_hline(yintercept=0) + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(legend.position = "none")
g2 <- g1 +
stat_summary(fun.data = median_cl_boot, geom = "errorbar",
colour = "black", width = 0.2, size=1) +
stat_summary(fun.y = median, geom = "point",
colour = "black", size = 3)
ggsave(here("plots", "HI_plots", "2015", "MOOS", "MOOS.HI.median.boot.doy.pdf"), plot = g2,
width = 8, height = 6, units = "in")
write.csv(MOOS.HI.df, here("Output_from_analysis", "03_HI_FI", "2015", "MOOS", "MOOS.HI.df.doy.csv"))
reticulate::repl_python()
FRCH.hyst.results.list = list(py$hysdict_FRCH_storm1_06_21_NO3,
py$hysdict_FRCH_storm1_06_21_fDOM,
py$hysdict_FRCH_storm1_06_21_SPC,
py$hysdict_FRCH_storm1_06_21_turb,
py$hysdict_FRCH_storm1_06_21_abs,
py$hysdict_FRCH_storm2a_06_30_NO3,
py$hysdict_FRCH_storm2a_06_30_abs,
py$hysdict_FRCH_storm3_07_11_NO3,
py$hysdict_FRCH_storm3_07_11_abs,
py$hysdict_FRCH_storm4a_07_15_NO3,
py$hysdict_FRCH_storm4a_07_15_abs,
py$hysdict_FRCH_storm4b_07_17_NO3,
py$hysdict_FRCH_storm4b_07_17_abs,
py$hysdict_FRCH_storm5_08_05_NO3,
py$hysdict_FRCH_storm5_08_05_fDOM,
py$hysdict_FRCH_storm5_08_05_SPC,
py$hysdict_FRCH_storm5_08_05_turb,
py$hysdict_FRCH_storm5_08_05_abs,
py$hysdict_FRCH_storm6_08_13_fDOM,
py$hysdict_FRCH_storm6_08_13_SPC,
py$hysdict_FRCH_storm6_08_13_turb,
py$hysdict_FRCH_storm7_08_24_fDOM,
py$hysdict_FRCH_storm7_08_24_SPC,
py$hysdict_FRCH_storm7_08_24_turb,
py$hysdict_FRCH_storm8a_08_26_fDOM,
py$hysdict_FRCH_storm8a_08_26_SPC,
py$hysdict_FRCH_storm8a_08_26_turb,
py$hysdict_FRCH_storm9_08_30_fDOM,
py$hysdict_FRCH_storm9_08_30_SPC,
py$hysdict_FRCH_storm9_08_30_turb,
py$hysdict_FRCH_storm10_09_01_fDOM,
py$hysdict_FRCH_storm10_09_01_SPC,
py$hysdict_FRCH_storm10_09_01_turb)
FRCH.hyst.results.list.2 = list()
for (i in 1:length(FRCH.hyst.results.list)){
FRCH.hyst.results.list.2[[i]] = as.data.frame(t(as.numeric(c(
FRCH.hyst.results.list[[i]][["HI_mean_with_Interp"]],
FRCH.hyst.results.list[[i]][["HI_standard_deviation_with_Interp"]],
FRCH.hyst.results.list[[i]][["Normalized slope of response"]],
FRCH.hyst.results.list[[i]][["interpolated Max width of response"]],
FRCH.hyst.results.list[[i]][["Min response"]],
FRCH.hyst.results.list[[i]][["Max response"]],
FRCH.hyst.results.list[[i]][["Peak Q"]]
))))
names(FRCH.hyst.results.list.2[[i]]) = c("HI_mean_Interp", "HI_sd_with_Interp", "N.S.", "Max_width_Interp", "Min_response", "Max_response", "Peak_Q")
}
HIs.list = list()
HIs.tests = list()
for (i in 1:length(FRCH.hyst.results.list)){
HIs.list[[i]] = unlist(FRCH.hyst.results.list[[i]][["Hysteresis_Index"]],recursive=FALSE)
HIs.tests[[i]] = as.data.frame(t(round(as.numeric(c(shapiro.test(HIs.list[[i]])$statistic, shapiro.test(HIs.list[[i]])$p.value,
t.test(HIs.list[[i]], mu=0)$statistic, t.test(HIs.list[[i]], mu=0)$p.value,
t.test(HIs.list[[i]], mu=0)$conf.int[1],t.test(HIs.list[[i]], mu=0)$conf.int[2],
wilcox.test(HIs.list[[i]], mu=0)$statistic, wilcox.test(HIs.list[[i]], mu=0)$p.value)), 4)))
names(HIs.tests[[i]]) = c("ShapiroTest.W", "ShapiroTest.p", "t.test.stat", "t.test.p", "t.test.CIlow", "t.test.CIhigh",
"wilcox.test.stat", "wilcox.test.p")
}
FRCH.hyst.results.list.3 =list()
for (i in 1:length(FRCH.hyst.results.list)){
FRCH.hyst.results.list.3[[i]] = cbind(FRCH.hyst.results.list.2[[i]], HIs.tests[[i]])
}
FRCH.hyst.results.df = bind_rows(FRCH.hyst.results.list.3, .id = "column_label")
FRCH.hyst.results.df$storm.ID = c("FRCH_storm1_06_21_NO3",
"FRCH_storm1_06_21_fDOM",
"FRCH_storm1_06_21_SPC",
"FRCH_storm1_06_21_turb",
"FRCH_storm1_06_21_abs",
"FRCH_storm2a_06_30_NO3",
"FRCH_storm2a_06_30_abs",
"FRCH_storm3_07_11_NO3",
"FRCH_storm3_07_11_abs",
"FRCH_storm4a_07_15_NO3",
"FRCH_storm4a_07_15_abs",
"FRCH_storm4b_07_17_NO3",
"FRCH_storm4b_07_17_abs",
"FRCH_storm5_08_05_NO3",
"FRCH_storm5_08_05_fDOM",
"FRCH_storm5_08_05_SPC",
"FRCH_storm5_08_05_turb",
"FRCH_storm5_08_05_abs",
"FRCH_storm6_08_13_fDOM",
"FRCH_storm6_08_13_SPC",
"FRCH_storm6_08_13_turb",
"FRCH_storm7_08_24_fDOM",
"FRCH_storm7_08_24_SPC",
"FRCH_storm7_08_24_turb",
"FRCH_storm8a_08_26_fDOM",
"FRCH_storm8a_08_26_SPC",
"FRCH_storm8a_08_26_turb",
"FRCH_storm9_08_30_fDOM",
"FRCH_storm9_08_30_SPC",
"FRCH_storm9_08_30_turb",
"FRCH_storm10_09_01_fDOM",
"FRCH_storm10_09_01_SPC",
"FRCH_storm10_09_01_turb")
FRCH.hyst.results.df$site.ID = "FRCH"
write.csv(FRCH.hyst.results.df, here("Output_from_analysis", "03_HI_FI", "2018", "FRCH", "FRCH.hyst.results.csv"))
# plot HI by normalized discharge
HIs.Q.list =list()
HIs.df.list = list()
# pdf("~/Documents/Storms_clean_repo/Output_from_analysis/03_HI_FI/2018/FRCH/FRCH.hyst.HI_Q.plots.pdf", width = 25, height =15, onefile=FALSE)
# par(mfrow=c(4,7))
# for (i in 1:length(HIs.list)) {
#   HIs.Q.list[[i]] = names(HIs.list[[i]])
#   HIs.Q.list[[i]] = (sapply(strsplit(HIs.Q.list[[i]], " "), "[[", 4))
#   HIs.Q.list[[i]] = as.numeric(gsub("%", "", HIs.Q.list[[i]]))
#   HIs.df.list[[i]] = as.data.frame(cbind(HIs.list[[i]], HIs.Q.list[[i]]))
#   HIs.df.list[[i]]= HIs.df.list[[i]][order(HIs.df.list[[i]][["V2"]]),]
# plot(HIs.df.list[[i]][["V1"]] ~ HIs.df.list[[i]][["V2"]], type="l",
#      ylab="norm.response", xlab="Q intervals", main= FRCH.hyst.results.df$storm.ID[i])
# abline(h=0, lty=2)
# }
# dev.off()
## plot HI with bootstrapped 95% CIs around the median ##
HIs.Q.list =list()
HIs.df.list = list()
par(mfrow=c(1,1))
for (i in 1:length(HIs.list)) {
HIs.Q.list[[i]] = names(HIs.list[[i]])
HIs.Q.list[[i]] = (sapply(strsplit(HIs.Q.list[[i]], " "), "[[", 4))
HIs.Q.list[[i]] = as.numeric(gsub("%", "", HIs.Q.list[[i]]))
HIs.df.list[[i]] = as.data.frame(cbind(HIs.list[[i]], HIs.Q.list[[i]]))
HIs.df.list[[i]]= HIs.df.list[[i]][order(HIs.df.list[[i]][["V2"]]),]
names(HIs.df.list[[i]]) = c("HI", "Q_interval")
}
FRCH.HI.df = bind_rows(HIs.df.list, .id = "column_label")
FRCH.HI.df$storm.ID = c(rep("FRCH_storm1_06_21_NO3", 50),
rep("FRCH_storm1_06_21_fDOM", 50),
rep("FRCH_storm1_06_21_SPC", 50),
rep("FRCH_storm1_06_21_turb", 50),
rep("FRCH_storm1_06_21_abs", 50),
rep("FRCH_storm2a_06_30_NO3", 50),
rep("FRCH_storm2a_06_30_abs", 50),
rep("FRCH_storm3_07_11_NO3", 50),
rep("FRCH_storm3_07_11_abs", 50),
rep("FRCH_storm4a_07_15_NO3", 50),
rep("FRCH_storm4a_07_15_abs", 50),
rep("FRCH_storm4b_07_17_NO3", 50),
rep("FRCH_storm4b_07_17_abs", 50),
rep("FRCH_storm5_08_05_NO3", 50),
rep("FRCH_storm5_08_05_fDOM", 50),
rep("FRCH_storm5_08_05_SPC", 50),
rep("FRCH_storm5_08_05_turb", 50),
rep("FRCH_storm5_08_05_abs", 50),
rep("FRCH_storm6_08_13_fDOM", 50),
rep("FRCH_storm6_08_13_SPC", 50),
rep("FRCH_storm6_08_13_turb", 50),
rep("FRCH_storm7_08_24_fDOM", 50),
rep("FRCH_storm7_08_24_SPC", 50),
rep("FRCH_storm7_08_24_turb", 50),
rep("FRCH_storm8a_08_26_fDOM", 50),
rep("FRCH_storm8a_08_26_SPC", 50),
rep("FRCH_storm8a_08_26_turb", 50),
rep("FRCH_storm9_08_30_fDOM", 50),
rep("FRCH_storm9_08_30_SPC", 50),
rep("FRCH_storm9_08_30_turb", 50),
rep("FRCH_storm10_09_01_fDOM", 50),
rep("FRCH_storm10_09_01_SPC", 50),
rep("FRCH_storm10_09_01_turb", 50))
FRCH.HI.df$storm.ID = as.factor(FRCH.HI.df$storm.ID)
FRCH.HI.df = separate(data=FRCH.HI.df, col=storm.ID, into=c("site.ID","storm.num", "month", "day", "response"), sep = "_", remove = F)
par(mfrow=c(1,1))
median_cl_boot <- function(x, conf = 0.95) {
lconf <- (1 - conf)/2
uconf <- 1 - lconf
require(boot)
bmedian <- function(x, ind) median(x[ind])
bt <- boot(x, bmedian, 10000)
bb <- boot.ci(bt, conf = 0.95, type = "perc")
data.frame(y = median(x), ymin = quantile(bt$t, lconf), ymax = quantile(bt$t,
uconf))
}
g0 <- ggplot(FRCH.HI.df, aes(x = storm.num, y = HI, label=storm.num, fill=response))
g1 = g0 + geom_jitter(width = 0.1, fill = "grey", colour = "#0571B0", alpha=0.25, size=3) +
theme(axis.text.x = element_text(angle = 0))+  labs(x="") + facet_wrap(~ response, scales = "free_x") +
theme_bw() +geom_hline(yintercept=0) + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(legend.position = "none")
g2 <- g1 +
stat_summary(fun.data = median_cl_boot, geom = "errorbar",
colour = "black", width = 0.2, size=1) +
stat_summary(fun.y = median, geom = "point",
colour = "black", size = 3)
ggsave(here("plots", "HI_plots", "2018", "FRCH", "FRCH.HI.median.boot.pdf"), plot = g2,
width = 8, height = 6, units = "in")
write.csv(FRCH.HI.df, here("Output_from_analysis", "03_HI_FI", "2018", "FRCH", "FRCH.HI.df.csv"))
FRCH.HI.df$date <- as.Date(with(FRCH.HI.df, paste(month, day, sep = "-")), "%m-%d")
FRCH.HI.df$doy <- yday(FRCH.HI.df$date)
g0 <- ggplot(FRCH.HI.df, aes(x = doy, y = HI, label=doy, fill=response))
g1 = g0 + geom_jitter(width = 0.1, fill = "grey", colour = "#0571B0", alpha=0.25, size=3) +
theme(axis.text.x = element_text(angle = 0))+  labs(x="") + facet_wrap(~ response, scales = "free_x") +
theme_bw() +geom_hline(yintercept=0) + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(legend.position = "none")
g2 <- g1 +
stat_summary(fun.data = median_cl_boot, geom = "errorbar",
colour = "black", width = 0.2, size=1) +
stat_summary(fun.y = median, geom = "point",
colour = "black", size = 3)
ggsave(here("plots", "HI_plots", "2018", "FRCH", "FRCH.HI.median.boot.doy.pdf"), plot = g2,
width = 8, height = 6, units = "in")
write.csv(FRCH.HI.df, here("Output_from_analysis", "03_HI_FI", "2018", "FRCH", "FRCH.HI.df.doy.csv"))
reticulate::repl_python()
MOOS.hyst.results.list = list(
py$hysdict_MOOS_storm3_07_10_NO3,
py$hysdict_MOOS_storm3_07_10_abs,
py$hysdict_MOOS_storm5_08_05_NO3,
py$hysdict_MOOS_storm5_08_05_fDOM,
py$hysdict_MOOS_storm5_08_05_SPC,
py$hysdict_MOOS_storm5_08_05_turb,
py$hysdict_MOOS_storm5_08_05_abs,
py$hysdict_MOOS_storm6_08_13_NO3,
py$hysdict_MOOS_storm6_08_13_fDOM,
py$hysdict_MOOS_storm6_08_13_SPC,
py$hysdict_MOOS_storm6_08_13_turb,
py$hysdict_MOOS_storm6_08_13_abs,
py$hysdict_MOOS_storm7_08_23_NO3,
py$hysdict_MOOS_storm7_08_23_fDOM,
py$hysdict_MOOS_storm7_08_23_SPC,
py$hysdict_MOOS_storm7_08_23_turb,
py$hysdict_MOOS_storm7_08_23_abs,
py$hysdict_MOOS_storm8a_08_26_NO3,
py$hysdict_MOOS_storm8a_08_26_fDOM,
py$hysdict_MOOS_storm8a_08_26_SPC,
py$hysdict_MOOS_storm8a_08_26_turb,
py$hysdict_MOOS_storm8a_08_26_abs,
py$hysdict_MOOS_storm9_08_30_NO3,
py$hysdict_MOOS_storm9_08_30_fDOM,
py$hysdict_MOOS_storm9_08_30_SPC,
py$hysdict_MOOS_storm9_08_30_turb,
py$hysdict_MOOS_storm9_08_30_abs,
py$hysdict_MOOS_storm10_09_01_NO3,
py$hysdict_MOOS_storm10_09_01_fDOM,
py$hysdict_MOOS_storm10_09_01_SPC,
py$hysdict_MOOS_storm10_09_01_turb,
py$hysdict_MOOS_storm10_09_01_abs,
py$hysdict_MOOS_storm11a_09_22_NO3,
py$hysdict_MOOS_storm11a_09_22_fDOM,
py$hysdict_MOOS_storm11a_09_22_SPC,
py$hysdict_MOOS_storm11a_09_22_turb,
py$hysdict_MOOS_storm11a_09_22_abs)
MOOS.hyst.results.list.2 = list()
for (i in 1:length(MOOS.hyst.results.list)){
MOOS.hyst.results.list.2[[i]] = as.data.frame(t(as.numeric(c(
MOOS.hyst.results.list[[i]][["HI_mean_with_Interp"]],
MOOS.hyst.results.list[[i]][["HI_standard_deviation_with_Interp"]],
MOOS.hyst.results.list[[i]][["Normalized slope of response"]],
MOOS.hyst.results.list[[i]][["interpolated Max width of response"]],
MOOS.hyst.results.list[[i]][["Min response"]],
MOOS.hyst.results.list[[i]][["Max response"]],
MOOS.hyst.results.list[[i]][["Peak Q"]]
))))
names(MOOS.hyst.results.list.2[[i]]) = c("HI_mean_Interp", "HI_sd_with_Interp", "N.S.", "Max_width_Interp", "Min_response", "Max_response", "Peak_Q")
}
HIs.list = list()
HIs.tests = list()
for (i in 1:length(MOOS.hyst.results.list)){
HIs.list[[i]] = unlist(MOOS.hyst.results.list[[i]][["Hysteresis_Index"]],recursive=FALSE)
HIs.tests[[i]] = as.data.frame(t(round(as.numeric(c(shapiro.test(HIs.list[[i]])$statistic, shapiro.test(HIs.list[[i]])$p.value,
t.test(HIs.list[[i]], mu=0)$statistic, t.test(HIs.list[[i]], mu=0)$p.value,
t.test(HIs.list[[i]], mu=0)$conf.int[1],t.test(HIs.list[[i]], mu=0)$conf.int[2],
wilcox.test(HIs.list[[i]], mu=0)$statistic, wilcox.test(HIs.list[[i]], mu=0)$p.value)), 4)))
names(HIs.tests[[i]]) = c("ShapiroTest.W", "ShapiroTest.p", "t.test.stat", "t.test.p", "t.test.CIlow", "t.test.CIhigh",
"wilcox.test.stat", "wilcox.test.p")
}
MOOS.hyst.results.list.3 =list()
for (i in 1:length(MOOS.hyst.results.list)){
MOOS.hyst.results.list.3[[i]] = cbind(MOOS.hyst.results.list.2[[i]], HIs.tests[[i]])
}
MOOS.hyst.results.df = bind_rows(MOOS.hyst.results.list.3, .id = "column_label")
MOOS.hyst.results.df$storm.ID = c(
"MOOS_storm3_07_09_NO3",
"MOOS_storm3_07_09_abs",
"MOOS_storm5_08_05_NO3",
"MOOS_storm5_08_05_fDOM",
"MOOS_storm5_08_05_SPC",
"MOOS_storm5_08_05_turb",
"MOOS_storm5_08_05_abs",
"MOOS_storm6_08_13_NO3",
"MOOS_storm6_08_13_fDOM",
"MOOS_storm6_08_13_SPC",
"MOOS_storm6_08_13_turb",
"MOOS_storm6_08_13_abs",
"MOOS_storm7_08_23_NO3",
"MOOS_storm7_08_23_fDOM",
"MOOS_storm7_08_23_SPC",
"MOOS_storm7_08_23_turb",
"MOOS_storm7_08_23_abs",
"MOOS_storm8a_08_26_NO3",
"MOOS_storm8a_08_26_fDOM",
"MOOS_storm8a_08_26_SPC",
"MOOS_storm8a_08_26_turb",
"MOOS_storm8a_08_26_abs",
"MOOS_storm9_08_30_NO3",
"MOOS_storm9_08_30_fDOM",
"MOOS_storm9_08_30_SPC",
"MOOS_storm9_08_30_turb",
"MOOS_storm9_08_30_abs",
"MOOS_storm10_09_01_NO3",
"MOOS_storm10_09_01_fDOM",
"MOOS_storm10_09_01_SPC",
"MOOS_storm10_09_01_turb",
"MOOS_storm10_09_01_abs",
"MOOS_storm11a_09_22_NO3",
"MOOS_storm11a_09_22_fDOM",
"MOOS_storm11a_09_22_SPC",
"MOOS_storm11a_09_22_turb",
"MOOS_storm11a_09_22_abs")
MOOS.hyst.results.df$site.ID = "MOOS"
write.csv(MOOS.hyst.results.df, here("Output_from_analysis", "03_HI_FI", "2018", "MOOS", "MOOS.hyst.results.csv"))
# plot HI by normalized discharge
HIs.Q.list =list()
HIs.df.list = list()
#pdf("~/Documents/Storms/Output_from_analysis/HI_plots/2018/MOOS/MOOS.hyst.HI_Q.plots.pdf", width = 25, height =15, onefile=FALSE)
# par(mfrow=c(4,7))
# for (i in 1:length(HIs.list)) {
#   HIs.Q.list[[i]] = names(HIs.list[[i]])
#   HIs.Q.list[[i]] = (sapply(strsplit(HIs.Q.list[[i]], " "), "[[", 4))
#   HIs.Q.list[[i]] = as.numeric(gsub("%", "", HIs.Q.list[[i]]))
#   HIs.df.list[[i]] = as.data.frame(cbind(HIs.list[[i]], HIs.Q.list[[i]]))
#   HIs.df.list[[i]]= HIs.df.list[[i]][order(HIs.df.list[[i]][["V2"]]),]
# plot(HIs.df.list[[i]][["V1"]] ~ HIs.df.list[[i]][["V2"]], type="l",
#      ylab="norm.response", xlab="Q intervals", main= MOOS.hyst.results.df$storm.ID[i])
# abline(h=0, lty=2)
# }
# dev.off()
## plot HI with bootstrapped 95% CIs around the median ##
HIs.Q.list =list()
HIs.df.list = list()
par(mfrow=c(1,1))
for (i in 1:length(HIs.list)) {
HIs.Q.list[[i]] = names(HIs.list[[i]])
HIs.Q.list[[i]] = (sapply(strsplit(HIs.Q.list[[i]], " "), "[[", 4))
HIs.Q.list[[i]] = as.numeric(gsub("%", "", HIs.Q.list[[i]]))
HIs.df.list[[i]] = as.data.frame(cbind(HIs.list[[i]], HIs.Q.list[[i]]))
HIs.df.list[[i]]= HIs.df.list[[i]][order(HIs.df.list[[i]][["V2"]]),]
names(HIs.df.list[[i]]) = c("HI", "Q_interval")
}
MOOS.HI.df = bind_rows(HIs.df.list, .id = "column_label")
MOOS.HI.df$storm.ID = c(
rep("MOOS_storm3_07_10_NO3", 50),
rep("MOOS_storm3_07_10_abs", 50),
rep("MOOS_storm5_08_05_NO3", 50),
rep("MOOS_storm5_08_05_fDOM", 50),
rep("MOOS_storm5_08_05_SPC", 50),
rep("MOOS_storm5_08_05_turb", 50),
rep("MOOS_storm5_08_05_abs", 50),
rep("MOOS_storm6_08_13_NO3", 50),
rep("MOOS_storm6_08_13_fDOM", 50),
rep("MOOS_storm6_08_13_SPC", 50),
rep("MOOS_storm6_08_13_turb", 50),
rep("MOOS_storm6_08_13_abs", 50),
rep("MOOS_storm7_08_23_NO3", 50),
rep("MOOS_storm7_08_23_fDOM", 50),
rep("MOOS_storm7_08_23_SPC", 50),
rep("MOOS_storm7_08_23_turb", 50),
rep("MOOS_storm7_08_23_abs", 50),
rep("MOOS_storm8a_08_26_NO3", 50),
rep("MOOS_storm8a_08_26_fDOM", 50),
rep("MOOS_storm8a_08_26_SPC", 50),
rep("MOOS_storm8a_08_26_turb", 50),
rep("MOOS_storm8a_08_26_abs", 50),
rep("MOOS_storm9_08_30_NO3", 50),
rep("MOOS_storm9_08_30_fDOM", 50),
rep("MOOS_storm9_08_30_SPC", 50),
rep("MOOS_storm9_08_30_turb", 50),
rep("MOOS_storm9_08_30_abs", 50),
rep("MOOS_storm10_09_01_NO3", 50),
rep("MOOS_storm10_09_01_fDOM", 50),
rep("MOOS_storm10_09_01_SPC", 50),
rep("MOOS_storm10_09_01_turb", 50),
rep("MOOS_storm10_09_01_abs", 50),
rep("MOOS_storm11a_09_22_NO3", 50),
rep("MOOS_storm11a_09_22_fDOM", 50),
rep("MOOS_storm11a_09_22_SPC", 50),
rep("MOOS_storm11a_09_22_turb", 50),
rep("MOOS_storm11a_09_22_abs", 50))
MOOS.HI.df$storm.ID = as.factor(MOOS.HI.df$storm.ID)
MOOS.HI.df = separate(data=MOOS.HI.df, col=storm.ID, into=c("site.ID","storm.num", "month", "day", "response"), sep = "_", remove = F)
par(mfrow=c(1,1))
median_cl_boot <- function(x, conf = 0.95) {
lconf <- (1 - conf)/2
uconf <- 1 - lconf
require(boot)
bmedian <- function(x, ind) median(x[ind])
bt <- boot(x, bmedian, 10000)
bb <- boot.ci(bt, conf = 0.95, type = "perc")
data.frame(y = median(x), ymin = quantile(bt$t, lconf), ymax = quantile(bt$t,
uconf))
}
g0 <- ggplot(MOOS.HI.df, aes(x = storm.num, y = HI, label=storm.num, fill=response))
g1 = g0 + geom_jitter(width = 0.1, fill = "grey", colour = "#0571B0", alpha=0.25, size=3) +
theme(axis.text.x = element_text(angle = 0))+  labs(x="") + facet_wrap(~ response, scales = "free_x") +
theme_bw() +geom_hline(yintercept=0) + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(legend.position = "none")
g2 <- g1 +
stat_summary(fun.data = median_cl_boot, geom = "errorbar",
colour = "black", width = 0.2, size=1) +
stat_summary(fun.y = median, geom = "point",
colour = "black", size = 3)
ggsave(here("plots", "HI_plots", "2018", "MOOS", "MOOS.HI.median.boot.pdf"), plot = g2,
width = 8, height = 6, units = "in")
write.csv(MOOS.HI.df, here("Output_from_analysis", "03_HI_FI", "2018", "MOOS", "MOOS.HI.df.csv"))
MOOS.HI.df$date <- as.Date(with(MOOS.HI.df, paste(month, day, sep = "-")), "%m-%d")
MOOS.HI.df$doy <- yday(MOOS.HI.df$date)
g0 <- ggplot(MOOS.HI.df, aes(x = doy, y = HI, label=doy, fill=response))
g1 = g0 + geom_jitter(width = 0.1, fill = "grey", colour = "#0571B0", alpha=0.25, size=3) +
theme(axis.text.x = element_text(angle = 0))+  labs(x="") + facet_wrap(~ response, scales = "free_x") +
theme_bw() +geom_hline(yintercept=0) + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(legend.position = "none")
g2 <- g1 +
stat_summary(fun.data = median_cl_boot, geom = "errorbar",
colour = "black", width = 0.2, size=1) +
stat_summary(fun.y = median, geom = "point",
colour = "black", size = 3)
ggsave(here("plots", "HI_plots", "2018", "MOOS", "MOOS.HI.median.boot.doy.pdf"), plot = g2,
width = 8, height = 6, units = "in")
write.csv(MOOS.HI.df, here("Output_from_analysis", "03_HI_FI", "2018", "MOOS", "MOOS.HI.df.doy.csv"))
reticulate::repl_python()
