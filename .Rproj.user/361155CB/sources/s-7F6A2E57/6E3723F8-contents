---
title: "Model selection"
author: "Jake Cavaiani"
date: "1/28/2022"
output:
  word_document: default
  pdf_document: default
---


```{r load-packages, include=FALSE}
library(magrittr)
library(knitr)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(data.table)
library(scales)
library(lme4)
library(nlme)
library(datasets)
library(arm)
library(AICcmodavg)
library(gridExtra)
library(grid)
library(ggpmisc)
library(boot)
library(here)
library(broom)
library(viridis)
library(car)
library(MuMIn)
library(ggeffects)
library(dotwhisker)
```



The purpose of this script is to model HI/FI against fixed and random effects and perform model selection techniques to see which model is best fit

Input: 2019_2020 HI for each catchment that is will be from Output_from_analysis->07_Models
Step 1) import HI.dat file which is HI for individual storms in 2018-2021 across DoD sites
Step 2) standardize and center the data
Step 3) add fixed (storm total, intensity, week precip, month precip, 3month precip and doy) and random effects (catchments)
Output: linear model plot 

```{r}
# Read in data # 
antecedent_HI_FI_1_0 <- read_csv("~/Documents/Storms/Output_from_analysis/06_HI_fire_permafrost_script/antecedent_HI_FI_1.0.csv") # read in data 
antecedent_HI_FI_1_0 <- antecedent_HI_FI_1_0[,-c(1:2,14:15,17,19)] # cleaning up columns that are unnecessary 

colNames <- c("Hyst_index", "HI_ymin", "HI_ymax", "site.ID", "storm.ID", "month", "day", "response_var", "Flush_index", "FI_ymin", "FI_ymax", "year", "beta", "StormPrecip", "StormTemp", "PrecipWeek", "PrecipMonth", "ThreeMonth", "TempWeek", "Duration", "Intensity", "doy", "burn", "pf", "date", "TimeSinceChena")

names(antecedent_HI_FI_1_0)<- colNames # renaming columns 

# filling in holes that the automated script did not do correctly 
antecedent_HI_FI_1_0[c(306:310), 20] <- 68.75
antecedent_HI_FI_1_0[c(306:310), 21] <- 0.01454545

antecedent_HI_FI_1_0[c(313:315), 20] <- 68.75
antecedent_HI_FI_1_0[c(313:315), 21] <- 0.01454545

antecedent_HI_FI_1_0[c(327:330), 20] <- 61.25
antecedent_HI_FI_1_0[c(327:330), 21] <- 0.07183673

antecedent_HI_FI_1_0[c(628:631), 20] <- 21.25
antecedent_HI_FI_1_0[c(628:631), 21] <- 0.09411765

antecedent_HI_FI_1_0[c(650:652), 20] <- 30.25
antecedent_HI_FI_1_0[c(650:652), 21] <- 0.2181818

antecedent_HI_FI_1_0[c(656:657), 20] <- 23.5
antecedent_HI_FI_1_0[c(656:657), 21] <- 0.03404255

antecedent_HI_FI_1_0[c(810:813), 20] <- 30.5
antecedent_HI_FI_1_0[c(810:813), 21] <- 0.1901639

antecedent_HI_FI_1_0[c(848:850), 20] <- 58.5
antecedent_HI_FI_1_0[c(848:850), 21] <- 0.1628205

antecedent_HI_FI_1_0[c(885:888), 20] <- 31.5
antecedent_HI_FI_1_0[c(885:888), 21] <- 0.1777778

antecedent_HI_FI_1_0[c(86), 14] <- 6.604
antecedent_HI_FI_1_0[c(86), 15] <- 13.560411
antecedent_HI_FI_1_0[c(86), 16] <- 9.779
antecedent_HI_FI_1_0[c(86), 17] <- 79.756
antecedent_HI_FI_1_0[c(86), 18] <- 79.756
antecedent_HI_FI_1_0[c(86), 19] <- 6.389494
antecedent_HI_FI_1_0[c(86), 20] <- 32.46667
antecedent_HI_FI_1_0[c(86), 21] <- 0.203408624
antecedent_HI_FI_1_0[c(86), 22] <- 179.2299
antecedent_HI_FI_1_0[c(86), 23] <- "burned"
antecedent_HI_FI_1_0[c(86), 24] <- "medium"

antecedent_HI_FI_1_0[c(86), 26] <- 38.22986

antecedent_HI_FI_1_0[c(110), 14] <- 2.667
antecedent_HI_FI_1_0[c(110), 15] <- 7.809827
antecedent_HI_FI_1_0[c(110), 16] <- 8.255
antecedent_HI_FI_1_0[c(110), 17] <- 109.474000
antecedent_HI_FI_1_0[c(110), 18] <- 175.641000
antecedent_HI_FI_1_0[c(110), 19] <- 9.680474
antecedent_HI_FI_1_0[c(110), 20] <- 47.96667
antecedent_HI_FI_1_0[c(110), 21] <- 0.055601112
antecedent_HI_FI_1_0[c(110), 22] <- 235.4590
antecedent_HI_FI_1_0[c(110), 23] <- "burned"
antecedent_HI_FI_1_0[c(110), 24] <- "medium"
#antecedent_HI_FI_1_0[c(110), 25] <- "2018-06-29"
antecedent_HI_FI_1_0[c(110), 26] <- 94.45903

antecedent_HI_FI_1_0[c(126:127), 14] <- 40.640
antecedent_HI_FI_1_0[c(126:127), 15] <- 4.928689
antecedent_HI_FI_1_0[c(126:127), 16] <- 21.082
antecedent_HI_FI_1_0[c(126:127), 17] <- 26.543
antecedent_HI_FI_1_0[c(126:127), 18] <- 26.543
antecedent_HI_FI_1_0[c(126:127), 19] <- 5.977116
antecedent_HI_FI_1_0[c(126:127), 20] <- 104.96667
antecedent_HI_FI_1_0[c(126:127), 21] <- 0.387170530
antecedent_HI_FI_1_0[c(126:127), 22] <- 262.9174
antecedent_HI_FI_1_0[c(126:127), 23] <- "burned"
antecedent_HI_FI_1_0[c(126:127), 24] <- "medium"
#antecedent_HI_FI_1_0[c(126:127), 25] <- "2018-06-29"
antecedent_HI_FI_1_0[c(126:127), 26] <- 121.91736

antecedent_HI_FI_1_0[c(130), 14] <- 4.572
antecedent_HI_FI_1_0[c(130), 15] <- 4.103419
antecedent_HI_FI_1_0[c(130), 16] <- 48.133
antecedent_HI_FI_1_0[c(130), 17] <- 67.183
antecedent_HI_FI_1_0[c(130), 18] <- 67.183
antecedent_HI_FI_1_0[c(130), 19] <- 5.676306
antecedent_HI_FI_1_0[c(130), 20] <- 130.96667
antecedent_HI_FI_1_0[c(130), 21] <- 0.034909646
antecedent_HI_FI_1_0[c(130), 22] <- 267.3340
antecedent_HI_FI_1_0[c(130), 23] <- "burned"
antecedent_HI_FI_1_0[c(130), 24] <- "medium"
#antecedent_HI_FI_1_0[c(130), 25] <- "2018-06-29"
antecedent_HI_FI_1_0[c(130), 26] <- 126.33403

antecedent_HI_FI_1_0[c(305), 23] <- "burned"
antecedent_HI_FI_1_0[c(305), 24] <- "high"

antecedent_HI_FI_1_0[c(313), 14] <- 37.600
antecedent_HI_FI_1_0[c(313), 15] <- 12.7643333
antecedent_HI_FI_1_0[c(313), 16] <- 54.800
antecedent_HI_FI_1_0[c(313), 17] <- 106.600
antecedent_HI_FI_1_0[c(313), 18] <- 229.000
antecedent_HI_FI_1_0[c(313), 19] <- 12.263147
antecedent_HI_FI_1_0[c(313), 20] <- 68.75
antecedent_HI_FI_1_0[c(313), 21] <- 0.014545450
antecedent_HI_FI_1_0[c(313), 22] <- 216.6042
antecedent_HI_FI_1_0[c(313), 23] <- "burned"
antecedent_HI_FI_1_0[c(313), 24] <- "high"
#antecedent_HI_FI_1_0[c(313), 25] <- "2018-06-29"
#antecedent_HI_FI_1_0[c(313), 26] <- 79.60417

antecedent_HI_FI_1_0[c(339:342), 23] <- "burned"
antecedent_HI_FI_1_0[c(339:342), 24] <- "high"

antecedent_HI_FI_1_0 <- antecedent_HI_FI_1_0[-658,]

antecedent_HI_FI_1_0[c(750), 23] <- "burned"
antecedent_HI_FI_1_0[c(750), 24] <- "medium"

which(antecedent_HI_FI_1_0$site.ID == "MOOS")
# i have a discrepency with is MOOS is burned or not....2018/2019 are listed as burned and 2020/2021 are listed as unburned....MOOS is catergorized as BURNED

antecedent_HI_FI_1_0[c(503:532, 817:846), 23] <- "burned"

antecedent_HI_FI_1_0 <- antecedent_HI_FI_1_0[-c(1:4,9,35:41,43,82:85,106:109, 
                                                153:156, 158:160,162:164,166:168,170:172,221:226,265:279,298:301,343:354,370:373,387:402,
                                                459:462,530,533:540,561:564,574:575,593:596,674:677,695:698,711:718,
                                                786,850,893:896,918:921,946:949), ] # removing storms that do not have a Q respond

antecedent_HI_FI_1_0[c(251,285,408,583,740,363,515,615,663,664,698,737,739), 13] <- NA # removing errant Beta values that are close to 25-50ish 


##subsetting by solute 
# NO3 #
HI_FI_NO3 = subset(antecedent_HI_FI_1_0, response_var == "NO3")
# fDOM #
HI_FI_fDOM = subset(antecedent_HI_FI_1_0, response_var == "fDOM")
# SPC #
HI_FI_SPC = subset(antecedent_HI_FI_1_0, response_var == "SPC")
# turb #
HI_FI_turb = subset(antecedent_HI_FI_1_0, response_var == "turb")

```

#########################################################################################################
##################################### HI vs. FI #########################################################
#########################################################################################################
``` {r}

HI_FI_NO3.p = 
  ggplot(HI_FI_NO3, aes(Flush_index, Hyst_index)) + geom_point(aes(colour=factor(site.ID), shape = pf), size = 4)+
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_hline(yintercept = 0) + geom_vline(xintercept = 0)+
  geom_errorbarh(aes(xmin=FI_ymin, xmax=FI_ymax), colour="black", alpha=0.5, size=.5, height = 0.1) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  ylim(-1.5, 1.5) + xlim(-1.5, 1.5)+
  ggtitle("a) NO3-")+ 
  ylab("HI") +
  xlab("") +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"), text = element_text(size = 20)) 
HI_FI_NO3.p
```
Doesnt look like there is too much of a pattern here....slightly more (+) HI and slightly more (-) FI


### HI vs. FI ### PF
``` {r}

HI_FI_fDOM$site.ID <- factor(HI_FI_fDOM$site.ID, levels = c('FRCH','MOOS','CARI','POKE','STRT', 'VAUL'))

HI_FI_fDOM.p = 
  ggplot(HI_FI_fDOM, aes(Flush_index, Hyst_index)) + geom_point(aes(colour=factor(site.ID), shape = pf), size = 4)+
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_hline(yintercept = 0) + geom_vline(xintercept = 0)+
  geom_errorbarh(aes(xmin=FI_ymin, xmax=FI_ymax), colour="black", alpha=0.5, size=.5, height = 0.1) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  ylim(-1.5, 1.5) + xlim(-1.5, 1.5)+
  ggtitle("b) fDOM")+ 
  xlab("") +
  ylab("") +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"), text = element_text(size = 20)) 
HI_FI_fDOM.p
```
Looks like there is a clear pattern with VAUL and MOOS as it usually dilutes during a storm meanwhile CARI and the other sites flush more frequently


### HI vs. FI
``` {r}
HI_FI_SPC$site.ID <- factor(HI_FI_SPC$site.ID, levels = c('FRCH','MOOS','CARI','POKE','STRT', 'VAUL'))

HI_FI_SPC.p = 
  ggplot(HI_FI_SPC, aes(Flush_index, Hyst_index)) + geom_point(aes(colour=factor(site.ID), shape = pf), size = 4)+
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_hline(yintercept = 0) + geom_vline(xintercept = 0)+
  geom_errorbarh(aes(xmin=FI_ymin, xmax=FI_ymax), colour="black", alpha=0.5, size=.5, height = 0.1) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  ylim(-1.5, 1.5) + xlim(-1.5, 1.5)+
  ggtitle("c) SPC")+
  xlab("FI") + 
  ylab("HI") +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"), text = element_text(size = 20)) 
HI_FI_SPC.p
```
Mostly a dilution and clockwise effect for SPC 

### HI vs. FI
``` {r}
HI_FI_turb$site.ID <- factor(HI_FI_turb$site.ID, levels = c('FRCH','MOOS','POKE','STRT','VAUL', 'CARI'))

HI_FI_turb.p = 
  ggplot(HI_FI_turb, aes(Flush_index, Hyst_index)) + geom_point(aes(colour=factor(site.ID), shape = pf), size = 4)+
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_hline(yintercept = 0) + geom_vline(xintercept = 0)+
  geom_errorbarh(aes(xmin=FI_ymin, xmax=FI_ymax), colour="black", alpha=0.5, size=.5, height = 0.1) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  ylim(-1.5, 1.5) + xlim(-1.5, 1.5)+
  ggtitle("d) Turb")+ 
  xlab("FI") +
  ylab("") +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"), text = element_text(size = 20)) 
HI_FI_turb.p

```
This seems like we would expect...a mostly flushing effect during storms



``` {r}
library(ggpubr)
ggarrange(HI_FI_NO3.p, HI_FI_fDOM.p, HI_FI_SPC.p, HI_FI_turb.p, ncol=2, nrow=2, common.legend = TRUE, legend="right")

ggsave("~/Documents/Storms/Output_from_analysis/From_07_Modelling/HI_FI_permafrost.pdf", width = 10, height = 10, device = "pdf")
```

### HI vs. FI ### FIRE
``` {r}

HI_FI_NO3.p.fire = 
  ggplot(HI_FI_NO3, aes(Flush_index, Hyst_index)) + geom_point(aes(colour=factor(site.ID), shape = burn), size = 4)+
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_hline(yintercept = 0) + geom_vline(xintercept = 0)+
  geom_errorbarh(aes(xmin=FI_ymin, xmax=FI_ymax), colour="black", alpha=0.5, size=.5, height = 0.1) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  ylim(-1.5, 1.5) + xlim(-1.5, 1.5)+
  ggtitle("a) NO3-")+ 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"), text = element_text(size = 20)) 
HI_FI_NO3.p.fire
```


``` {r}

HI_FI_fDOM.p.fire = 
  ggplot(HI_FI_fDOM, aes(Flush_index, Hyst_index)) + geom_point(aes(colour=factor(site.ID), shape = burn), size = 4)+
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_hline(yintercept = 0) + geom_vline(xintercept = 0)+
  geom_errorbarh(aes(xmin=FI_ymin, xmax=FI_ymax), colour="black", alpha=0.5, size=.5, height = 0.1) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  ylim(-1.5, 1.5) + xlim(-1.5, 1.5)+
  ggtitle("b) fDOM")+ 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"), text = element_text(size = 20)) 
HI_FI_fDOM.p.fire
```

``` {r}
HI_FI_SPC.p.fire = 
  ggplot(HI_FI_SPC, aes(Flush_index, Hyst_index)) + geom_point(aes(colour=factor(site.ID), shape = burn), size = 4)+
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_hline(yintercept = 0) + geom_vline(xintercept = 0)+
  geom_errorbarh(aes(xmin=FI_ymin, xmax=FI_ymax), colour="black", alpha=0.5, size=.5, height = 0.1) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  ylim(-1.5, 1.5) + xlim(-1.5, 1.5)+
  ggtitle("c) SPC")+ 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"), text = element_text(size = 20)) 
HI_FI_SPC.p.fire
```

``` {r}
HI_FI_turb.p.fire = 
  ggplot(HI_FI_turb, aes(Flush_index, Hyst_index)) + geom_point(aes(colour=factor(site.ID), shape = burn), size = 4)+
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_hline(yintercept = 0) + geom_vline(xintercept = 0)+
  geom_errorbarh(aes(xmin=FI_ymin, xmax=FI_ymax), colour="black", alpha=0.5, size=.5, height = 0.1) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  ylim(-1.5, 1.5) + xlim(-1.5, 1.5)+
  ggtitle("d) Turb")+ 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"), text = element_text(size = 20)) 
HI_FI_turb.p.fire

```
``` {r}

ggarrange(HI_FI_NO3.p.fire, HI_FI_fDOM.p.fire, HI_FI_SPC.p.fire, HI_FI_turb.p.fire, ncol=2, nrow=2, common.legend = TRUE, legend="right")

ggsave("~/Documents/Storms/Output_from_analysis/From_07_Modelling/HI_FI_fire.pdf", width = 10, height = 10, device = "pdf")
```

### regression between FI and Beta
``` {r}
# all together
ggplot(HI_FI_NO3, aes(Flush_index, beta)) + geom_point(aes(colour=factor(site.ID)), size = 4) +
  ylim(-1.5, 1.5) + xlim(-1.5, 1.5) +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE)
```

``` {r}
# all together
ggplot(HI_FI_fDOM, aes(Flush_index, beta)) + geom_point(aes(colour=factor(site.ID)), size = 4) +
  ylim(-1.5, 1.5) + xlim(-1.5, 1.5) +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE)
```

``` {r}
# all together
ggplot(HI_FI_SPC, aes(Flush_index, beta)) + geom_point(aes(colour=factor(site.ID)), size = 4) +
  ylim(-1.5, 1.5) + xlim(-1.5, 1.5) +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE)
```

``` {r}
ggplot(HI_FI_turb, aes(Flush_index, beta)) + geom_point(aes(colour=factor(site.ID)), size = 4) +
  ylim(-1.5, 1.5) + xlim(-1.5, 1.5) +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE)
```

### HI vs. beta ### PF
``` {r}

HI_FI_NO3.p.beta = 
  ggplot(HI_FI_NO3, aes(beta, Hyst_index)) + geom_point(aes(colour=factor(site.ID), shape = pf), size = 4)+
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_hline(yintercept = 0) + geom_vline(xintercept = 0)+
  geom_errorbarh(aes(xmin=FI_ymin, xmax=FI_ymax), colour="black", alpha=0.5, size=.5, height = 0.1) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  ylim(-1.5, 1.5) + xlim(-1.5, 1.5)+
  ggtitle("a) NO3-")+ 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"), text = element_text(size = 20)) 
HI_FI_NO3.p.beta
```

``` {r}

HI_FI_fDOM.p.beta = 
  ggplot(HI_FI_fDOM, aes(beta, Hyst_index)) + geom_point(aes(colour=factor(site.ID), shape = pf), size = 4)+
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_hline(yintercept = 0) + geom_vline(xintercept = 0)+
  geom_errorbarh(aes(xmin=FI_ymin, xmax=FI_ymax), colour="black", alpha=0.5, size=.5, height = 0.1) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  ylim(-1.5, 1.5) + xlim(-1.5, 1.5)+
  ggtitle("b) fDOM")+ 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"), text = element_text(size = 20)) 
HI_FI_fDOM.p.beta
```


``` {r}
HI_FI_SPC.p.beta = 
  ggplot(HI_FI_SPC, aes(beta, Hyst_index)) + geom_point(aes(colour=factor(site.ID), shape = pf), size = 4)+
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_hline(yintercept = 0) + geom_vline(xintercept = 0)+
  geom_errorbarh(aes(xmin=FI_ymin, xmax=FI_ymax), colour="black", alpha=0.5, size=.5, height = 0.1) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  ylim(-1.5, 1.5) + xlim(-1.5, 1.5)+
  ggtitle("c) SPC")+ 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"), text = element_text(size = 20)) 
HI_FI_SPC.p.beta
```


``` {r}
HI_FI_turb.p.beta = 
  ggplot(HI_FI_turb, aes(beta, Hyst_index)) + geom_point(aes(colour=factor(site.ID), shape = pf), size = 4)+
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_hline(yintercept = 0) + geom_vline(xintercept = 0)+
  geom_errorbarh(aes(xmin=FI_ymin, xmax=FI_ymax), colour="black", alpha=0.5, size=.5, height = 0.1) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  ylim(-1.5, 1.5) + xlim(-1.5, 1.5)+
  ggtitle("d) Turb")+ 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"), text = element_text(size = 20)) 
HI_FI_turb.p.beta

```

``` {r}
ggplot(antecedent_HI_FI_1_0, aes(doy, TimeSinceChena)) +
  geom_point() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  facet_grid(rows = vars(year))

  
  
```


#### Data visualization ####

```{r}
ggplot(antecedent_HI_FI_1_0, aes(doy, Hyst_index)) +
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1) + 
  geom_point(aes(color = site.ID))  +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
  ggtitle("HI") +
  facet_grid(rows=vars(year), cols = vars(response_var)) 


```


### Checking for outliers 
```{r}

HI_FI_NO3.pl <- HI_FI_NO3 %>% filter(year == "2018") %>%
  ggplot(aes(x = doy, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(3)), "Catchment")+
  ylab("Hysteresis Index") +
  ggtitle("a) 2018 NO3-")

HI_FI_NO3.pl
  


```
So when I look here I see early storms in French but I don't see corresponding storms in Moose or Caribou...why might this happen?

1) There could be missing data for the duration of that storm due to instrument malfunction/servicing/user error


2) Streams may respond differently to a rain event due to physical attributes within the catchment...
  lets look at the discharge record to compare Q response look at the discharge record to see if we are missing a storm...If you are going to do this go back to the first script and run the discharge and chem script to get the file loaded in so you can check the alarm bells and the Q response:'
  
3) Storms alarms may trigger in one catchment and not in another due to the location of the precipitation event!
  
4) A storm may have been delineated from the triage of storm or not and then when it was time to run in through the HI function it came back with an error code that would potentially occur due to missing data points/jumps in datetime (requires a full continuous record) or the format of the data was not correct (as.posixct, as.numeric)...(this one does happen but probably the least out of the options listed above when it comes to HI)

DOY 175 is 6/24
DOY 250 is 9/7
1) FRCH storm with such a big CI around day 195 which is mid/end of July, lets look at the jitter plot for HI for that. The range of the 2% discharge increments go from -0.2 all the way up to 0.7 so that explains the big CI. This CQ loop also criss crosses...Do you think that has any influence on the CI?
How should we remedy this?

2) MOOS storms in end of season due to more complete chemistry record....FRCH has a big gap throughout beginning of august to end of September


```{r}
#HI_FI_NO3.2018 <- HI_FI_NO3 %>% filter(year == "2018")
#plot(POKE.st$inst_rainfall_mm ~ POKE.st$DateTime, type="h",
#     xlim = as.POSIXct(c("2018-05-01 0:00:00","2018-10-15 00:00:00"), tz="America/Anchorage"),
#     ylim = c(10,0), 
##     axes=F, xlab="", ylab="")
#axis(side = 4)
#mtext(side = 4, line = 3, 'POKE precip. (mm)')
##abline(v = as.POSIXct(poke.five.fourty.eight$DateTime), col="yellow", lwd = 0.1)
#abline(v = as.POSIXct(poke.five.twenty.four$DateTime), col = "green", lwd = 0.1)
#par(new = T)
#plot(MOOS$MeanDischarge ~ MOOS$DateTime, type = "l", xlab = "", ylab = "Q (L/sec)", col = "purple", ylim = c(0,4000)) +
 # lines(FRCH$MeanDischarge ~ FRCH$DateTime, type = "l", col = "red") 



```
As can be seen here it does appear that we can have a storm in one catchment vs another catchment (look at end of June for an example of Moose having a response in Q and FRCH not)


```{r}
HI_FI_NO3.2019.pl <- HI_FI_NO3 %>% filter(year == "2019") %>%
  ggplot(aes(x = doy, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+
  ylab("Hysteresis Index") +
  ggtitle("b) 2019 NO3-")
  
HI_FI_NO3.2019.pl

```
This is showing a lot of early 2019 storms for FRCH when MOOS does not have a storm....let us check the Q record as we did for 2018 to make sure that we are correct in that here: 

1) Our Q record shows us that some of our streams respond differently to some of our rain events...FRCH indicates a storm by MOOS does not.

2) CARI has a storm earlier than every other site due to longer record.


```{r}

#plot(FRCH.st$inst_rainfall_mm ~ FRCH.st$DateTime, type="h",
#     xlim = as.POSIXct(c("2019-05-01 0:00:00","2019-10-15 00:00:00"), tz="America/Anchorage"),
#     ylim = c(10,0), 
#     axes=F, xlab="", ylab="")
#axis(side = 4)
#mtext(side = 4, line = 3, 'POKE precip. (mm)')
##abline(v = as.POSIXct(frch.five.fourty.eight$DateTime), col="yellow", lwd = 0.1)
#abline(v = as.POSIXct(frch.five.twenty.four$DateTime), col = "green", lwd = 0.1)
#par(new = T)
#plot(MOOS$Q ~ MOOS$DateTime, type = "l", xlab = "", ylab = "Q (L/sec)", col = "purple", ylim = c(0,7000)) +
#  lines(FRCH$Q ~ FRCH$DateTime, type = "l", col = "red") +
#  lines(VAUL$Q ~ VAUL$DateTime, type = "l", col = "blue") +
#  lines(POKE$Q ~ POKE$DateTime, type = "l", col = "black") +
#  lines(STRT$Q ~ STRT$DateTime, type = "l", col = "orange") 


```

```{r}
HI_FI_NO3.2020.pl <- HI_FI_NO3 %>% filter(year == "2020") %>%
  ggplot(aes(x = doy, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+
  ylab("Hysteresis Index") +
  ggtitle("c) 2020 NO3-")
  
HI_FI_NO3.2020.pl

```
This appears to be consistent:

1) Storms line up across catchments 
```{r}

#plot(FRCH.st$inst_rainfall_mm ~ FRCH.st$DateTime, type="h",
#     xlim = as.POSIXct(c("2020-05-01 0:00:00","2020-10-15 00:00:00"), tz="America/Anchorage"),
#     ylim = c(10,0), 
#     axes=F, xlab="", ylab="")
#axis(side = 4)
#mtext(side = 4, line = 3, 'POKE precip. (mm)')
#abline(v = as.POSIXct(frch.five.fourty.eight$DateTime), col="yellow", lwd = 0.1)
#abline(v = as.POSIXct(frch.five.twenty.four$DateTime), col = "green", lwd = 0.1)
#par(new = T)
#plot(MOOS$Q ~ MOOS$DateTime, type = "l", xlab = "", ylab = "Q (L/sec)", col = "purple", ylim = c(0,7000)) +
#  lines(FRCH$Q ~ FRCH$DateTime, type = "l", col = "red") +
 # lines(VAUL$Q ~ VAUL$DateTime, type = "l", col = "blue") +
  #lines(POKE$Q ~ POKE$DateTime, type = "l", col = "black") +
#  lines(STRT$Q ~ STRT$DateTime, type = "l", col = "orange") 


```

```{r}
HI_FI_NO3.2021.pl <- HI_FI_NO3 %>% filter(year == "2021") %>%
  ggplot(aes(x = doy, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+
  ylab("Hysteresis Index") +
  ggtitle("d) 2021 NO3-")
  
HI_FI_NO3.2021.pl
```
Unfortunately we have some missing records for 2021:

1) FRCH/MOOS/VAUL Q record doesnt start until 6/30

2) Beaver dams at STRT and POKE throughout the year took away accurate Q measurements for multiple precip events that would have been a storm 

3) MOOS SUNA was out of commission for the entire year

4) Records that overlap appear to look alright


```{r}

HI_FI_fDOM.2018.pl <- HI_FI_fDOM %>% filter(year == "2018") %>%
  ggplot(aes(x = doy, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+
  ylab("Hysteresis Index") +
  ggtitle("a) 2018 fDOM")
  
HI_FI_fDOM.2018.pl

```
Nothing looks too out of the ordinary for this

```{r}
HI_FI_fDOM.2019.pl <- HI_FI_fDOM %>% filter(year == "2019") %>%
  ggplot(aes(x = doy, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+
  ylab("Hysteresis Index") +
  ggtitle("b) 2019 fDOM")
  
HI_FI_fDOM.2019.pl

```
From DOY 160-180 there are only storms for FRCH....is this true?

1) Looking at my storm events it is true that I only have FRCH storms for this early year. 

2) When we look at the rest of the record it looks pretty normal.

```{r}
HI_FI_fDOM.2020.pl <- HI_FI_fDOM %>% filter(year == "2020") %>%
  ggplot(aes(x = doy, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+
  ylab("Hysteresis Index") +
  ggtitle("c) 2020 fDOM")
  
HI_FI_fDOM.2020.pl

```
This plot looks pretty normal as most of the time there was a storm in one catchment there were registered storms elsewhere. 

```{r}
HI_FI_fDOM.2021.pl <- HI_FI_fDOM %>% filter(year == "2021") %>%
  ggplot(aes(x = doy, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+
  ylab("Hysteresis Index") +
  ggtitle("d) 2021 fDOM")
  
HI_FI_fDOM.2021.pl
```
Unfortunately we have some missing records for 2021:

1) FRCH/MOOS/VAUL Q record doesnt start until 6/30

2) Beaver dams at STRT and POKE throughout the year took away accurate Q measurements for multiple precip events that would have been a storm

3) Records that overlap appear to look alright

```{r}
grid.arrange(HI_FI_fDOM.2018.pl, HI_FI_fDOM.2019.pl,
             HI_FI_fDOM.2020.pl, HI_FI_fDOM.2021.pl)

```
2020 shows some clear patterns between catchment as VAUL maintains positive HI indicating proximal stores and or insufficient sources to maintain throughout entire storm 

```{r}

HI_FI_SPC.2018.pl <- HI_FI_SPC %>% filter(year == "2018") %>%
  ggplot(aes(x = doy, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+
  ylab("Hysteresis Index") +
  ggtitle("a) 2018 SPC")
  
HI_FI_SPC.2018.pl

```
This looks pretty consistent as when one storm occurs it appears that most if not all catchments register a storm as well.

```{r}
HI_FI_SPC.2019.pl <- HI_FI_SPC %>% filter(year == "2019") %>%
  ggplot(aes(x = doy, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+
  ylab("Hysteresis Index") +
  ggtitle("b) 2019 SPC")
  
HI_FI_SPC.2019.pl

```
From DOY 160-180 there are only storms for FRCH....is this true?

1) Looking at my storm events/Q record it is true that I only have FRCH storms for this early year. 

2) When we look at the rest of the record it looks pretty normal.

```{r}
HI_FI_SPC.2020.pl <- HI_FI_SPC %>% filter(year == "2020") %>%
  ggplot(aes(x = doy, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+
  ylab("Hysteresis Index") +
  ggtitle("c) 2020 SPC")
  
HI_FI_SPC.2020.pl

```
Some pretty big shifts in HI from caribou but it only occurs in consecutive storms 


```{r}
HI_FI_SPC.2021.pl <- HI_FI_SPC %>% filter(year == "2021") %>%
  ggplot(aes(x = doy, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+
  ylab("Hysteresis Index") +
  ggtitle("d) 2021 SPC")
  
HI_FI_SPC.2021.pl
```
Unfortunately we have some missing records for 2021:

1) FRCH/MOOS/VAUL Q record doesnt start until 6/30

2) Beaver dams at STRT and POKE throughout the year took away accurate Q measurements for multiple precip events that would have been a storm

3) Records that overlap appear to look alright

```{r}
grid.arrange(HI_FI_SPC.2018.pl, HI_FI_SPC.2019.pl,
             HI_FI_SPC.2020.pl, HI_FI_SPC.2021.pl)

```


```{r}

HI_FI_turb.2018.pl <- HI_FI_turb %>% filter(year == "2018") %>%
  ggplot(aes(x = doy, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+
  ylab("Hysteresis Index") +
  ggtitle("a) 2018 turb")
  
HI_FI_turb.2018.pl

```
Doesn't look like anything is too out of the ordinary

```{r}
HI_FI_turb.2019.pl <- HI_FI_turb %>% filter(year == "2019") %>%
  ggplot(aes(x = doy, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+
  ylab("Hysteresis Index") +
  ggtitle("b) 2019 turb")
  
HI_FI_turb.2019.pl

```
From DOY 160-180 there are only storms for FRCH....is this true?

1) Looking at my storm events/Q record it is true that I only have FRCH storms for this early year. 

2) When we look at the rest of the record it looks pretty normal.

```{r}
HI_FI_turb.2020.pl <- HI_FI_turb %>% filter(year == "2020") %>%
  ggplot(aes(x = doy, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+
  ylab("Hysteresis Index") +
  ggtitle("c) 2020 turb")
  
HI_FI_turb.2020.pl

```
Nothing looks too out of the ordinary 

```{r}
HI_FI_turb.2021.pl <- HI_FI_turb %>% filter(year == "2021") %>%
  ggplot(aes(x = doy, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+
  ylab("Hysteresis Index") +
  ggtitle("d) 2021 turb")
  
HI_FI_turb.2021.pl
```
Unfortunately we have some missing records for 2021:

1) FRCH/MOOS/VAUL Q record doesnt start until 6/30

2) Beaver dams at STRT and POKE throughout the year took away accurate Q measurements for multiple precip events that would have been a storm

3) Records that overlap appear to look alright

```{r}
grid.arrange(HI_FI_turb.2018.pl, HI_FI_turb.2019.pl,
             HI_FI_turb.2020.pl, HI_FI_turb.2021.pl)

```
Doesn't look like anything is too out of the ordinary 

Make scatterplot matrix for each predictor on HI – color site 
## Assessing model assumptions

```{r, echo=FALSE}

is.na(antecedent_HI_FI_1_0) <- sapply(antecedent_HI_FI_1_0, is.na) # removing any NAs

# scaling data # 
#scaling # 
antecedent_HI_FI_1_0[c("StormPrecip", "StormTemp", "PrecipWeek", "PrecipMonth", "ThreeMonth", "TempWeek", "Intensity", "TimeSinceChena")] <- lapply(antecedent_HI_FI_1_0[c("StormPrecip", "StormTemp", "PrecipWeek", "PrecipMonth", "ThreeMonth", "TempWeek", "Intensity", "TimeSinceChena")], function(x) c(scale(x)))

HI_FI_NO3 = subset(antecedent_HI_FI_1_0, response_var == "NO3")
# fDOM #
HI_FI_fDOM = subset(antecedent_HI_FI_1_0, response_var == "fDOM")
# SPC #
HI_FI_SPC = subset(antecedent_HI_FI_1_0, response_var == "SPC")
# turb #
HI_FI_turb = subset(antecedent_HI_FI_1_0, response_var == "turb")

```


Our next problem that we seem to have is that I say that the total precip totals for POKE seem to be higher than the rest of our gauges.....let us investigate that claim here:



```{r}
#FRCH_RainGauge_2019.url <- "https://docs.google.com/spreadsheets/d/e/2PACX-1vRClQEChvrubY0D1iWXnZ8QQKY1NexCzcKHEC3XsnAmn4IlP2O2wUUOBoF9A1dOd-Fl5AeuPsUInZ12/pub?output=csv"
#POKE_RainGauge_2019.url <- "https://docs.google.com/spreadsheets/d/e/2PACX-1vRClQEChvrubY0D1iWXnZ8QQKY1NexCzcKHEC3XsnAmn4IlP2O2wUUOBoF9A1dOd-Fl5AeuPsUInZ12/pub?output=csv"
#VAUL_RainGauge_2019.url <- "https://docs.google.com/spreadsheets/d/e/2PACX-1vRKbGuJu7VV9oVxTC96mhlmV-VNiHmmSSEbrPaZEEbX7RJy3yHu8HO5ifx6VLLsLOr-qCPny5FjW3bU/pub?output=csv"

#VAUL_RainGauge_2019 <- read.csv(url(VAUL_RainGauge_2019.url), skip = 1)
#VAUL_RainGauge_2019 <- VAUL_RainGauge_2019[,-c(4:7)]

#FRCH_RainGauge_2019 <- read.csv(url(FRCH_RainGauge_2019.url), skip = 1)
#FRCH_RainGauge_2019 <- FRCH_RainGauge_2019[,-c(4:7)]

#names(VAUL_RainGauge_2019) <- c("Site", "DateTimeGMT", "Precip")
#VAUL_RainGauge_2019$Site <- "VAUL" # adding a site column
#names(FRCH_RainGauge_2019) <- c("Site", "DateTimeGMT", "Precip")
#FRCH_RainGauge_2019$Site <- "FRCH" # adding a site column


#VAUL_RainGauge_2019$DateTime <- mdy_hms(VAUL_RainGauge_2019$DateTimeGMT, tz = "GMT")
#attributes(VAUL_RainGauge_2019$DateTime)$tzone <- 'America/Anchorage'

#FRCH_RainGauge_2019$DateTime <- mdy_hms(FRCH_RainGauge_2019$DateTimeGMT, tz = "GMT")
#attributes(FRCH_RainGauge_2019$DateTime)$tzone <- 'America/Anchorage'

#ggplot(VAUL_RainGauge_2019) +
 # geom_line(aes(x = DateTime, y = Precip)) +
#  xlab("Date") +
#  ylab("Cumulative Precipitation (mm)") +
#  ggtitle("VAUL 2019 Rain Gauge")

#ggplot(FRCH_RainGauge_2019) +
#  geom_line(aes(x = DateTime, y = Precip)) +
#  xlab("Date") +
#  ylab("Cumulative Precipitation (mm)") +
#  ggtitle("FRCH 2019 Rain Gauge")

#rain.gauge.2019 <- bind_rows(VAUL_RainGauge_2019, FRCH_RainGauge_2019)



#total.precip.2019 <- ggplot(rain.gauge.2019) +
#  geom_line(aes(x = DateTime, y = Precip, color = Site)) +
#  xlab("Date") + 
#  ylab("Cumulative Precipitation in cm") +
#  ggtitle("STRT FRCH VAUL Rain Gauge")
#total.precip.2019


#range(FRCH_RainGauge_2019$Datetime)
#range(POKE_RainGauge_2019$DateTime)
#range(VAUL_RainGauge_2019$DateTime)

#sum(FRCH_RainGauge_2019$inst_rainfall_mm)
#sum(POKE_RainGauge_2019$inst_rainfall_mm)
#sum(VAUL_RainGauge_2019$inst_rainfall_mm)

```
This is showing that we may have a pretty sizeable difference in precip totals across site 




```{r}
### This script reads in and plots Rain Gauge data at FRCH, STRT, VAUL, CARI, CRREL sites for 2020 from our HOBOs and POKE from LTER data ###

#Step 1: Import raw data from HOBOware # File path directory DoD Project->2020 AK Sensors-> Rain Gauge-> "site"
#Step 2: Plot data # HOBOware data comes in the form of cumulative precip....you have to put it in instanteous 15 minute intervals
#Step 3: output csv with Site, DateTime, and Precip

### Import Data from our sites ###
### This script reads in and plots Rain Gauge data at FRCH, STRT, VAUL, CARI, CRREL sites for 2020 from our HOBOs and POKE from LTER data ###

#Step 1: Import raw data from HOBOware # File path directory DoD Project->2020 AK Sensors-> Rain Gauge-> "site"
#Step 2: Plot data # HOBOware data comes in the form of cumulative precip....you have to put it in instanteous 15 minute intervals
#Step 3: output csv with Site, DateTime, and Precip

### Import Data from our sites ###
#strt.2020.url <- "https://docs.google.com/spreadsheets/d/e/2PACX-1vT05dgyg07MOSVdaEFFywTuktj7TTY0ukYjp5ZckRTP5BJ9dFaq5fT0MppdTchBJseTlLSzoyuLbWNS/pub?output=csv"
#frch.2020.url <- "https://docs.google.com/spreadsheets/d/e/2PACX-1vSXjY8hE7y3xpQs42ce8tTuqxadD-9GSLdlzmlzapcdxZoYwZ0M3GOjrQfKshj5Cw1XlPMICGK2v51L/pub?output=csv"
#vaul.2020.url <- "https://docs.google.com/spreadsheets/d/e/2PACX-1vTd-IH6XcwWpzDQav6eQO5NBzV2XB3XzCwJdxHarSiOniu57EoqegV8vU4eF8bo_8REcr8SxsXaDMpR/pub?output=csv"
### from CPCRW Caribou Peak Met Station ###
#caribou.2020.url <- "https://docs.google.com/spreadsheets/d/e/2PACX-1vSYvitZk-JWF9bNRKvg2EWyAzt3YPPnWm3UioUEEyoMXaUkZSJRov-R0bk9nMOoXP1CcyyBtELi1_ZF/pub?output=csv"
### from CPCRW CRREL Main Met Station ###
#crrel.2020.url <- "https://docs.google.com/spreadsheets/d/e/2PACX-1vTNOk0Gqqc-CqnXO220DIWIeGP9RQLMNEC54QAn-civk5a6Fb_Y3Z3oBNpJNAni46foqRkyytes9GT8/pub?output=csv"

# read in data # 
#strt.2020.gauge <- read.csv(url(strt.2020.url), skip = 1)
#frch.2020.gauge <- read.csv(url(frch.2020.url), skip = 1)                       
#vaul.2020.gauge <- read.csv(url(vaul.2020.url), skip = 1)
#caribou.2020.gauge <- read.csv(url(caribou.2020.url), skip = 4)
#crrel.2020.gauge <- read.csv(url(crrel.2020.url), skip = 4)

#caribou.2020.gauge$Site <- "CARI" # adding a site column
#crrel.2020.gauge$Site <- "CRREL" # adding a site column
### Rename columns ###
#names(strt.2020.gauge) <- c("Site", "DateTimeGMT", "Precip")
#names(frch.2020.gauge) <- c("Site", "DateTimeGMT", "Precip")
#names(vaul.2020.gauge) <- c("Site", "DateTimeGMT", "Precip")
#names(caribou.2020.gauge) <- c("DateTimeGMT", "Precip", "Site")
#names(crrel.2020.gauge) <- c("DateTimeGMT", "Precip", "Site")

#strt.2020.gauge$Site <- "STRT" # adding a site column
#frch.2020.gauge$Site <- "FRCH" # adding a site column
#vaul.2020.gauge$Site <- "VAUL" # adding a site column

# Input NA for missing time #
#strt.2020.gauge$DateTimeGMT[strt.2020.gauge$DateTimeGMT == ""] <- NA
#frch.2020.gauge$DateTimeGMT[frch.2020.gauge$DateTimeGMT == ""] <- NA
#vaul.2020.gauge$DateTimeGMT[vaul.2020.gauge$DateTimeGMT == ""] <- NA
#caribou.2020.gauge$DateTimeGMT[caribou.2020.gauge$DateTimeGMT == ""] <- NA
#crrel.2020.gauge$DateTimeGMT[crrel.2020.gauge$DateTimeGMT == ""] <- NA


# Convert time and put in AK time #
#strt.2020.gauge$DateTime <- mdy_hms(strt.2020.gauge$DateTimeGMT, tz = "GMT")
#attributes(strt.2020.gauge$DateTime)$tzone <- 'America/Anchorage'

#frch.2020.gauge$DateTime <- mdy_hms(frch.2020.gauge$DateTimeGMT, tz = "GMT")
#attributes(frch.2020.gauge$DateTime)$tzone <- 'America/Anchorage'

#vaul.2020.gauge$DateTime <- mdy_hms(vaul.2020.gauge$DateTimeGMT, tz = "GMT")
#attributes(vaul.2020.gauge$DateTime)$tzone <- 'America/Anchorage'

#caribou.2020.gauge$DateTime = as.POSIXct(caribou.2020.gauge$DateTimeGMT, "%m/%d/%y %H:%M", tz="America/Anchorage")
#crrel.2020.gauge$DateTime = as.POSIXct(crrel.2020.gauge$DateTimeGMT, "%m/%d/%y %H:%M", tz="America/Anchorage")

# Plot data #
#STRT.2020.RAIN <- ggplot(strt.2020.gauge) +
 # geom_line(aes(x = DateTime, y = Precip)) +
  #xlab("Date") +
  #ylab("Cumulative Precipitation (mm)") +
  #ggtitle("Stuart 2020 Rain Gauge")

#STRT.2020.RAIN

#FRCH.2020.RAIN <- ggplot(frch.2020.gauge) + 
 # geom_line(aes(x = DateTime, y = Precip)) +
  #xlab("Date") +
#ylab("Cumulative Precipitation (mm)") +
 # ggtitle("French 2020 Rain Gauge")
#FRCH.2020.RAIN

#VAUL.2020.RAIN <- ggplot(vaul.2020.gauge) +
#  geom_line(aes(x = DateTime, y = Precip)) +
#  xlab("Date") +
#  ylab("Cumulative Precipitation (mm)") +
#  ggtitle("Vault 2020 Rain Gauge")
#VAUL.2020.RAIN

#CARI.2020.RAIN <- ggplot(caribou.2020.gauge) +
#  geom_line(aes(x = DateTime, y = Precip)) +
#  xlab("Date") +
#  ylab("Instanteous Precipitation (mm)") +
#  ggtitle("CPCRW CARI 2020 Rain Gauge")
#CARI.2020.RAIN

#CRREL.2020.RAIN <- ggplot(crrel.2020.gauge) +
#  geom_line(aes(x = DateTime, y = Precip)) +
#  xlab("Date") +
#  ylab("Instanteous Precipitation (mm)") +
#  ggtitle("CPCRW CRREL 2020 Rain Gauge")
#CRREL.2020.RAIN

# Bind Together # Poker is going to be the average between these two rain gauges
#poke.2020.gauge <- data.frame(caribou.2020.gauge$DateTime, crrel.2020.gauge$Precip, #caribou.2020.gauge$Precip)
#poke.2020.gauge$MeanPrecip <- rowMeans(poke.2020.gauge[,c('crrel.2020.gauge.Precip', 'caribou.2020.gauge.Precip')], na.rm = TRUE)
#poke.2020.gauge$Site <- "POKE"
#names(poke.2020.gauge) <- c("DateTime", "CRREL_Precip", "CARI_Precip", "inst_rainfall_mm", "Site")

## STRT ## turn into instantaneous precip
#strt.2020.gauge$inst_rainfall_mm = 0.2

## FRCH ##
#frch.2020.gauge$inst_rainfall_mm = 0.2

## VAUL ##
#vaul.2020.gauge$inst_rainfall_mm = 0.2


#### compile into per 15 min rainfall ###

## FRCH ##
#min<-cut(frch.2020.gauge$DateTime, breaks="15 min")
#FRCH.2020.st <- as.data.frame(aggregate(inst_rainfall_mm ~ min, data = frch.2020.gauge, FUN=function(x) 
#  sum=sum(x)))
#FRCH.2020.st$DateTime<-as.POSIXct(FRCH.2020.st$min, "%Y-%m-%d %H:%M:%S", tz="America/Anchorage")

## STRT ## adding FRCH data to data frame because STRT didnt have a rain gauge there until the 7/29/20
#min<-cut(strt.2020.gauge$DateTime, breaks="15 min")
#STRT.2020.st <- as.data.frame(aggregate(inst_rainfall_mm ~ min, data = strt.2020.gauge, FUN=function(x) 
#  sum=sum(x)))
#STRT.2020.st$DateTime <-as.POSIXct(STRT.2020.st$min, "%Y-%m-%d %H:%M:%S", tz="America/Anchorage")

#STRT.FRCH <- FRCH.2020.st[-c(438:677), ] #clipping off 7/29-on 

#STRT.2020.st <- full_join(STRT.FRCH, STRT.2020.st, by = c("DateTime")) #merging FRCH and STRT
#STRT.2020.st$inst_rainfall_mm <- rowMeans(STRT.2020.st[,c(2,5)], na.rm = TRUE) 

## VAUL ##
#min<-cut(vaul.2020.gauge$DateTime, breaks="15 min")
#VAUL.2020.st <- as.data.frame(aggregate(inst_rainfall_mm ~ min, data=vaul.2020.gauge, FUN=function(x) 
#  sum=sum(x)))
#VAUL.2020.st$DateTime<-as.POSIXct(VAUL.2020.st$min, "%Y-%m-%d %H:%M:%S", tz="America/Anchorage")#

#VAUL.FRCH <- FRCH.2020.st[-c(175:677)] #clipping off 6-22 on

#VAUL.2020.st <- full_join(VAUL.FRCH, VAUL.2020.st) #merging FRCH and VAUL


#### round time to nearest 15 min ####
#STRT.2020.st$DateTime = lubridate::round_date(STRT.2020.st$DateTime, "15 minutes")
#FRCH.2020.st$DateTime = lubridate::round_date(FRCH.2020.st$DateTime, "15 minutes")
#VAUL.2020.st$DateTime = lubridate::round_date(VAUL.2020.st$DateTime, "15 minutes")

### Remove columns that are not needed ###
#STRT.2020.st <- STRT.2020.st[,-c(1,2,4,5)]
#FRCH.2020.st <- FRCH.2020.st[,-c(1)]
#VAUL.2020.st <- VAUL.2020.st[,-c(1)]
#poke.2020.gauge <- poke.2020.gauge[,-c(2,3)]
#STRT.2020.st$Site <- "STRT"
#FRCH.2020.st$Site <- "FRCH"
#VAUL.2020.st$Site <- "VAUL"
#### plot to check ####
#plot(STRT.2020.st$inst_rainfall_mm ~ STRT.2020.st$DateTime, type="h", 
#     xlim=c(as.POSIXct("2020-06-05 00:00:00"), as.POSIXct("2020-10-21 00:00:00")),
#     ylim=c(0,13))

#plot(FRCH.2020.st$inst_rainfall_mm ~ FRCH.2020.st$DateTime, type="h", 
#     xlim=c(as.POSIXct("2020-06-05 00:00:00"), as.POSIXct("2020-10-21 00:00:00")),
#     ylim=c(0,13))

#plot(VAUL.2020.st$inst_rainfall_mm ~ VAUL.2020.st$DateTime, type="h", 
#     xlim=c(as.POSIXct("2020-06-05 00:00:00"), as.POSIXct("2020-10-21 00:00:00")),
#     ylim=c(0,13))



#rain.gauge.2020 <- bind_rows(strt.2020.gauge, frch.2020.gauge, vaul.2020.gauge, poke.2020.gauge)#

#sum(frch.2020.gauge$inst_rainfall_mm)
#sum(poke.2020.gauge$inst_rainfall_mm)

#total.precip.2020 <- ggplot(rain.gauge.2020) +
##  geom_line(aes(x = DateTime, y = Precip, color = Site)) +
#  xlab("Date") + 
#  ylab("Cumulative Precipitation in cm") +
#  ggtitle("STRT FRCH VAUL Rain Gauge")
#total.precip.2020



```
Summing the total precip for FRCH and POKE and Poker (CRREL and CARI combined and averaged) has almost 40 mm more of rain in 2020 then FRCH. Does this mean that our rain guages are less sensitive or does this fall in the range of rainfall across space?

#### Scatter plot matrix ####


ADD IN R^2 value to see if you can get any sense of this!

``` {r}
NO3_data.1 <- HI_FI_NO3[,c("Hyst_index","StormPrecip")]

pairs(NO3_data.1)

HI_FI_NO3 %>% ggplot(aes(x = StormPrecip, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
  ggtitle("HI vs. StormPrecip")

```


``` {r}
NO3_data.2 <- HI_FI_NO3[,c("Hyst_index","PrecipWeek")]

pairs(NO3_data.2)

HI_FI_NO3 %>% ggplot(aes(x = PrecipWeek, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
  ggtitle("HI vs. PrecipWeek")




```

``` {r}
NO3_data.3 <- HI_FI_NO3[,c("Hyst_index","PrecipMonth")]

pairs(NO3_data.3)

HI_FI_NO3 %>% ggplot(aes(x = PrecipMonth, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
  ggtitle("HI vs. PrecipMonth")

```




``` {r}
NO3_data.4 <- HI_FI_NO3[,c("Hyst_index","ThreeMonth")]

pairs(NO3_data.4)
HI_FI_NO3_CARI <- filter(HI_FI_NO3, site.ID == "CARI")
HI_FI_NO3_FRCH <- filter(HI_FI_NO3, site.ID == "FRCH")
HI_FI_NO3_MOOS <- filter(HI_FI_NO3, site.ID == "MOOS")
HI_FI_NO3_POKE <- filter(HI_FI_NO3, site.ID == "POKE")
HI_FI_NO3_VAUL <- filter(HI_FI_NO3, site.ID == "VAUL")
HI_FI_NO3_STRT <- filter(HI_FI_NO3, site.ID == "STRT")

HI_FI_NO3_CARI %>% ggplot(aes(x = ThreeMonth, y = Hyst_index)) +
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = year), size = 2)

HI_FI_NO3_FRCH %>% ggplot(aes(x = ThreeMonth, y = Hyst_index)) +
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = year), size = 2)

HI_FI_NO3_MOOS %>% ggplot(aes(x = ThreeMonth, y = Hyst_index)) +
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = year), size = 2)

HI_FI_NO3_POKE %>% ggplot(aes(x = ThreeMonth, y = Hyst_index)) +
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = year), size = 2)

HI_FI_NO3_VAUL %>% ggplot(aes(x = ThreeMonth, y = Hyst_index)) +
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = year), size = 2)

HI_FI_NO3_STRT %>% ggplot(aes(x = ThreeMonth, y = Hyst_index)) +
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = year), size = 2)


 
HI_FI_NO3 %>% ggplot(aes(x = ThreeMonth, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
  ggtitle("HI vs. ThreeMonth")

```
Caribou potentially not right 
``` {r}
NO3_data.5 <- HI_FI_NO3[,c("Hyst_index","Intensity")]

HI_FI_NO3 %>% ggplot(aes(x = Intensity, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+
  ylab("Hysteresis Index") +
  ggtitle("HI vs. Intensity")

pairs(NO3_data.5)

which(HI_FI_NO3$Intensity > 1.5)

HI_FI_NO3.low <- HI_FI_NO3[-c(45,60,67,97,106,154,155,161,165,168,173,188,189,221), ]
which(HI_FI_NO3.low$Intensity > 1.0)


#HI_FI_NO3.low <- HI_FI_NO3.low[-c(42,  71,  89,  92, 137, 138, 139, 140, 145, 147, 152, 176), ]

NO3_data.5 <- HI_FI_NO3.low[,c("Hyst_index","Intensity")]

pairs(NO3_data.5)

```
I removed some storms that were way higher in intensity then any other storm 



``` {r}
NO3_data.6 <- HI_FI_NO3[,c("Hyst_index","StormTemp")]

pairs(NO3_data.6)

HI_FI_NO3 %>% ggplot(aes(x = StormTemp, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
  ggtitle("HI vs. StormTemp")

```

``` {r}
NO3_data.7 <- HI_FI_NO3[,c("Hyst_index","TempWeek")]

pairs(NO3_data.7)

HI_FI_NO3 %>% ggplot(aes(x = TempWeek, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
  ggtitle("HI vs. StormTemp")
```


``` {r}
NO3_data.8 <- HI_FI_NO3[,c("Hyst_index","TimeSinceChena")]

pairs(NO3_data.8)

HI_FI_NO3 %>% ggplot(aes(x = TimeSinceChena, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha = 0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID, shape = as.factor(year)), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
   ggtitle("HI vs. StormTemp")



```

#### Correlation 
``` {r}
NO3_data <- HI_FI_NO3[,c("Hyst_index", "site.ID", "StormPrecip", "StormTemp", "PrecipWeek", "PrecipMonth", "ThreeMonth", "TempWeek", "Intensity", "TimeSinceChena", "pf", "burn", "year")]
NO3_data <- na.omit(NO3_data) # 236 to 223 rows 
cor(NO3_data[,c(1,3:10)])

```
1) Storm temperature is heavily correlated with temperature a week leading up to a storm (0.794) but storm temperature is slightly more correlated with HI (-0.173 vs. -0.164)

2) Storm temperature is also correlated with time since chena (-0.735) but time since chena is more correlated with HI (0.251 vs. -0.173) so this makes me want to keep Time since Chena and temperature a week before considering that is a more marginal comparison with HI and the temperature predictors. 

3)Precip week is correlated with precip month (0.511) but precip week is more correlated with HI than precip month (-0.242 vs. 0.048)

4)Precip month is correlated with three month precip (0.591) but three month precip is more correlated with HI (0.220 vs. 0.048)

5) Three month is correlated with Time since Chena (0.619) but time since chena is more correlated with HI (0.251 vs. 0.220)

* to sum up this makes me want to drop storm temperature and three month precipitation.....but lets run the model with all of the candidate predictors first and go from there 

```{r, echo=FALSE}
f0 <- formula(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + ThreeMonth + Intensity + StormTemp + TempWeek +  TimeSinceChena + (1|site.ID))

M0 <- lmer(f0, REML = TRUE, data = NO3_data)

summary(M0)

```
1) Scaled residulas look pretty good as our median is close to 0 and our quartiles are roughly the same

2) This shows us that the site explains 0 of our variance which doesn't make complete sence

3) This makes it seem that precip week and storm precip are the most significant in HI which doesnt make sense when we have time since chena as the highest cor factor with HI

```{r, echo=FALSE}
plot(M0)
```
1) Ideally the residual plot will show no fitted pattern. The red line should be horizontal at 0.

This residual are spread equally along the ranges of predictors. It is good to see a horizontal line with equal spread points

```{r, echo=FALSE}
qqnorm(resid(M0))
```
1) Ideally the QQ plot should be a straight line to visually check the normality assumptions. If it is not a straight line we can try log transforming the response variable but this looks pretty good.


```{r}
vif(M0)
``` 
Anything above a 2 indicates a high correlation and should be removed....lets take StormTemp out and ThreeMonth

```{r}
f1 <- formula(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity  + TempWeek + TimeSinceChena + (1|site.ID))

M1 <- lmer(f1, data = NO3_data)
summary(M1)
vif(M1)
```
1) Our scaled residuals look good

2) Site still not accounting for any variance

3) This makes it seem like precip week leading up to the storm affects HI the most with precip month also significant 

4) all VIFs are below 2 which is good!

5) TimeSinceChena and TempWeek are correlated with each other at 0.61 which breaks our rule of not including anything >0.5. Should I keep it as is or get rid of TempWeek

```{r, echo=FALSE}
plot(M1)
```

### Partial residuals ###
Plot partial residual for the interesting predictor – PrecipWeek

```{r}
pr <- ggpredict(M1, terms = c("PrecipWeek"))
plot(pr, add.data = TRUE)

ggsave("~/Documents/Storms/Output_from_analysis/From_07_Modelling/HI/NO3/partial.residuals.pdf")
```
Visually look at the effect of PrecipWeek on HI and we would expect these to look like a nice regression model 
```{r, echo=FALSE}
qqnorm(resid(M1))
```

```{r}
vif(M1)
```
TimeSinceChena and TempWeek are correlated (0.61) so lets try and remove TempWeek 

```{r}
f2 <- formula(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TimeSinceChena + (1|site.ID))

M2 <- lmer(f2, REML = TRUE, data = NO3_data)
summary(M2)

```

```{r}
pr <- ggpredict(M2, terms = c("PrecipWeek"))
plot(pr, add.data = TRUE)
vif(M2)
```

```{r}
f3 <- formula(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity  + TempWeek + TimeSinceChena + (PrecipWeek|site.ID))

M3 <- lmer(f3, REML = TRUE, data = NO3_data)
summary(M3)

```
alter structure between random slopes and random intercepts

```{r}
pr.no3 <- ggpredict(M3, terms = c("PrecipWeek"))
plot(pr.no3, add.data = TRUE)
ggsave("~/Documents/Storms/Output_from_analysis/From_07_Modelling/HI/NO3/partial.residuals.png", device = "png")
```


```{r}
f10 <- formula(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity  + TempWeek + TimeSinceChena + (0+PrecipWeek|site.ID) + (1|site.ID))

M10 <- lmer(f10, REML = TRUE, data = NO3_data)
summary(M10)

```
```{r}
f11 <- formula(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity  + TempWeek + TimeSinceChena + (1|site.ID) + (1|year))

M11 <- lmer(f11, data = NO3_data)
summary(M11)

```

```{r}
f12 <- formula(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity  + TempWeek + TimeSinceChena + (0+PrecipWeek|site.ID) + (1|site.ID) + (1|year))

M12 <- lmer(f12, data = NO3_data)


```

```{r}
aictab(list(M0,M1,M2,M3,M10,M11,M12))
```
Mod3: Model without TempWeek, ThreeMonth, or StormTemp with a random intercept structure 
Mod2: Model without ThreeMonth or StormTemp with a random intercept structure
Mod5: Reduced model with random slopes and intercepts uncorrelated 
Mod6: Reduced model with random effect of year and site 
Mod7: Reduced model with random effect of year with uncorrelated structure 
Mod4: Model without ThreeMonth or StormTemp with a random slope structure with (PrecipWeek|site.ID)
Mod1: full model with all candidate predictors and random intercept structure

This shows us that the random intercept structure is a better fit model 

### Dot and Whisker plot ###

```{r}
m1 <- lm(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TempWeek + TimeSinceChena, data = NO3_data)
dwplot(m1,
       dot_args = list(color = "black"), # color for the dot
       whisker_args = list(color = "red"),   # color for the whisker
       vline = geom_vline(xintercept = 0, colour = "grey50", linetype = 2)) +
    xlab("Coefficient") + 
  ggtitle("") +
  theme_classic() 

ggsave("~/Documents/Storms/Output_from_analysis/From_07_Modelling/HI/NO3/coefficient.png")

```
CI overlapping 0 are nonsignificant 


```{r}
summary(M1)
anova(M0, M1, test = "Chi") 

plot(M1, site.ID ~ resid(.), abline = 0 ) # generate diagnostic plots
```
Looking for equal variance -testing assumptions of the model 


This plot shows us that there are some outliers in POKE and  that the variability within FRCH is greater than in other sites we therefore examine the sites in isolation standardized residuals versus fitted values

```{r}
plot(M1, resid(., type = "pearson") ~ fitted(.) | site.ID, id = 0.05, 
     adj = -0.3, pch = 20, col = "gray40")
```
The plot shows the standardized residuals (or Pearson’s residuals) versus fitted values and suggests that there are outliers in the data (the names elements in the plots). To check if these outliers are a cause for concern, we will now use a Levene’s test to check if the variance is distributed homogeneously (homoscedasticity) or whether the assumption of variance homogeneity is violated (due to the outliers).


### Mixed effect model is a pseudo r^2  ###
```{r}

sjPlot::tab_model(M1)


```

The R2 values of the summary table are incorrect (as indicated by the missing conditional R2 value). The more appropriate conditional and marginal coefficient of determination for generalized mixed-effect models can be extracted using the r.squaredGLMM function from the MuMIn package


The marginal R2 (marginal coefficient of determination) represents the variance explained by the fixed effects while the conditional R2 is interpreted as a variance explained by the entire model, including both fixed and random effects


```{r}
r.squaredGLMM(M1)

```
random effect isnt explaining only explaining 15 % of the model....maybe dont need a random effect in the model at all if it is 0 
```{r}
sjPlot::plot_model(M1, type = "pred", terms = c("PrecipWeek")) +
  # show uncentered date rather than centered date
  scale_x_continuous(name = "PrecipWeek", 
                     breaks = seq(-500, 300, 100), 
                     labels = seq(1150, 1950, 100))

```
While we have already shown that the effect of PrecipWeek is significant, it is small which means that the HI does not correlate very strongly with PrecipWeek. This suggests that other factors that are not included in the model also influence HI (and probably more meaningfully, too).

Before turning to the diagnostics, we will use the fitted (or predicted) and the observed values with a regression line for the predicted values. This will not only show how good the model fit the data but also the direction and magnitude of the effect.

### Interactions ###
### Permafrost ###
```{r}
f4 <- formula(Hyst_index ~ StormPrecip*pf + PrecipWeek*pf + PrecipMonth*pf + Intensity*pf  + TempWeek*pf + TimeSinceChena*pf + (1|site.ID))

M4 <- lmer(f4, data = NO3_data)
summary(M4)

```
This shows us if there is an interaction with any of our candidate predictors and permafrost extent and it doesnt seem like there is any

### burn ###
```{r}
f5 <- formula(Hyst_index ~ StormPrecip*burn + PrecipWeek*burn + PrecipMonth*burn + Intensity*burn  + TempWeek*burn + TimeSinceChena*pf  + (1|site.ID))

M5 <- lmer(f5, data = NO3_data)
summary(M5)

```
This shows us if there is an interaction with any of our candidate predictors and burn vs. unburned catchments and it doesnt seem like there are any


#########################################################################################################
####################################### fDOM ############################################################
#########################################################################################################

#### Scatter plot matrix ####
``` {r}

HI_FI_fDOM_CARI <- filter(HI_FI_fDOM, site.ID == "CARI")
HI_FI_fDOM_FRCH <- filter(HI_FI_fDOM, site.ID == "FRCH")
HI_FI_fDOM_MOOS <- filter(HI_FI_fDOM, site.ID == "MOOS")
HI_FI_fDOM_POKE <- filter(HI_FI_fDOM, site.ID == "POKE")
HI_FI_fDOM_VAUL <- filter(HI_FI_fDOM, site.ID == "VAUL")
HI_FI_fDOM_STRT <- filter(HI_FI_fDOM, site.ID == "STRT")

fDOM_data.1 <- HI_FI_fDOM[,c("Hyst_index","StormPrecip")]

pairs(fDOM_data.1)

HI_FI_fDOM %>% ggplot(aes(x = StormPrecip, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
   ggtitle("HI vs. StormPrecip")




```
Big storms in FRCH but why not every where else 
``` {r}
fDOM_data.2 <- HI_FI_fDOM[,c("Hyst_index","PrecipWeek")]

pairs(fDOM_data.2)

HI_FI_fDOM %>% ggplot(aes(x = PrecipWeek, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
   ggtitle("HI vs. PrecipWeek")

```

``` {r}
fDOM_data.3 <- HI_FI_fDOM[,c("Hyst_index","PrecipMonth")]

pairs(fDOM_data.3)

HI_FI_fDOM %>% ggplot(aes(x = PrecipMonth, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
   ggtitle("HI vs. PrecipMonth")

```

``` {r}
fDOM_data.4 <- HI_FI_fDOM[,c("Hyst_index","ThreeMonth")]

pairs(fDOM_data.4)

HI_FI_fDOM %>% ggplot(aes(x = ThreeMonth, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
   ggtitle("HI vs. ThreeMonth")

```


``` {r}
fDOM_data.5 <- HI_FI_fDOM[,c("Hyst_index","Intensity")]

pairs(fDOM_data.5)

HI_FI_fDOM %>% ggplot(aes(x = Intensity, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
   ggtitle("HI vs. Intensity")

```


``` {r}
fDOM_data.6 <- HI_FI_fDOM[,c("Hyst_index","StormTemp")]

pairs(fDOM_data.6)

HI_FI_fDOM %>% ggplot(aes(x = StormTemp, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
   ggtitle("HI vs. StormTemp")

```


``` {r}
fDOM_data.7 <- HI_FI_fDOM[,c("Hyst_index","TempWeek")]

pairs(fDOM_data.7)

HI_FI_fDOM %>% ggplot(aes(x = TempWeek, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
   ggtitle("HI vs. TempWeek")

```

``` {r}
fDOM_data.8 <- HI_FI_fDOM[,c("Hyst_index","TimeSinceChena")]

pairs(fDOM_data.8)

HI_FI_fDOM %>% ggplot(aes(x = TimeSinceChena, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
   ggtitle("HI vs. TimeSinceChena")

```
It appears that fDOM has slightly more site variation. It seems like there is a clearer distinction between sites and fDOM responses. Lets see if that shows in the model...

``` {r}
fDOM_data <- HI_FI_fDOM[,c("Hyst_index", "site.ID", "StormPrecip", "StormTemp", "PrecipWeek", "PrecipMonth", "ThreeMonth", "TempWeek", "Intensity", "TimeSinceChena", "burn", "pf", "year")]

fDOM_data <- na.omit(fDOM_data) # 241 to 237
cor(fDOM_data[, c(1,3:10)])

```
1) Storm temperature is heavily correlated with temp week (0.798) but temp week is more correlated with HI (0.0892 vs. -0.0032)

2) Precip week is correlated with precip month (0.546) but precip month is more correlated with HI (0.281 vs. 0.190)

3) Precip month is correlated with three month (0.627) but precip month is more correlated with HI (0.281 vs. 0.224)

4) Three month is correlated with Time since Chena (0.567) but three month is more correlated with HI ( 0.224 vs. 0.0603)

* this makes me want to drop time since chena and three month 

```{r, echo=FALSE}
f0.fDOM <- formula(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + ThreeMonth + Intensity + StormTemp + TempWeek +  TimeSinceChena + (1|site.ID))

M0.fDOM <- lmer(f0.fDOM, data = fDOM_data)

summary(M0.fDOM)

```
1) Scaled residuals look appropriate

2) The site accounts for slightly more variation 

3)Precip month is the most significant 

``` {r}
vif(M0.fDOM)

```
Any values over 2 indicate heavy correlation...lets remove ThreeMonth and StormTemp as this is what we did for NO3-

```{r, echo=FALSE}
f1.fDOM <- formula(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TempWeek +  TimeSinceChena + (1|site.ID))

M1.fDOM <- lmer(f1.fDOM, data = fDOM_data)

summary(M1.fDOM)

```

``` {r}
vif(M1.fDOM)

```
None of our VIFs are over 2 which is good!
however as was true with NO3 PrecipWeek and PrecipMonth are correlated (0.54) and TimeSinceChena and TempWeek are correlated (-0.58)

```{r, echo=FALSE}
plot(M1.fDOM)
```
Potentially some funneling of the residuals from left to right


```{r, echo=FALSE}
qqnorm(resid(M1.fDOM))
```

```{r}
pr <- ggpredict(M1.fDOM, terms = c("PrecipMonth"))
plot(pr, add.data = TRUE)

```

### Altnerative slopes ###
```{r, echo=FALSE}

f2.fDOM <- formula(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TempWeek + TimeSinceChena + (PrecipWeek|site.ID))

M2.fDOM <- lmer(f2.fDOM, data = fDOM_data)

summary(M2.fDOM)

```

### Altnerative slopes ###
```{r, echo=FALSE}

f10.fDOM <- formula(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TempWeek + TimeSinceChena + (0 + PrecipWeek|site.ID) + (1|site.ID))

M10.fDOM <- lmer(f10.fDOM, data = fDOM_data)

```

```{r}
pr <- ggpredict(M2.fDOM, terms = c("PrecipMonth"))
plot(pr, add.data = TRUE)

```

```{r}
f11 <- formula(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity  + TempWeek + TimeSinceChena + (1|site.ID) + (1|year))

M11.fDOM <- lmer(f11, data = fDOM_data)


```

```{r}
f12 <- formula(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity  + TempWeek + TimeSinceChena + (0+PrecipWeek|site.ID) + (1|site.ID) + (1|year))

M12.fDOM <- lmer(f12, data = fDOM_data)


```


```{r}
aictab(list(M0.fDOM, M1.fDOM, M2.fDOM, M10.fDOM,M11.fDOM,M12.fDOM))

```
Mod6: Reduced model with uncorrelated random intercept and slope with random effect of year 
Mod5: Reduced model with random intercept with year and site as random effects 
Mod4: Reduced model with uncorrelated random intercept and random slope strucuture 
Mod3: Reduced model (no StormTemp or ThreeMonth precip) and random intercept structure
Mod2: Reduced model ('') with random slopes structure
Mod1: Full model with random intercept structure 

Mod2 with random intercept structure is the better model.

```{r}
m1 <- lm(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TempWeek + TimeSinceChena, data = fDOM_data)
dwplot(m1,
       dot_args = list(color = "black"), # color for the dot
       whisker_args = list(color = "red"),   # color for the whisker
       vline = geom_vline(xintercept = 0, colour = "grey50", linetype = 2)) +
    xlab("Coefficient") + 
  ggtitle("") +
  theme_classic() 

ggsave("~/Documents/Storms/Output_from_analysis/From_07_Modelling/HI/fDOM/coefficient.png")

```
CI overlapping 0 are nonsignificant...This shows us that the only predictor that is significant is PrecipMonth precip  


```{r}
plot(M1.fDOM, site.ID ~ resid(.), abline = 0 ) # generate diagnostic plots
```
This plot shows us that there are some outliers in POKE, STRT, and CARI and that the variability within MOOS is greater than in other sites we therefore examine the sites in isolation standardized residuals versus fitted values

```{r}
plot(M1.fDOM, resid(., type = "pearson") ~ fitted(.) | site.ID, id = 0.05, 
     adj = -0.3, pch = 20, col = "gray40")
```
The plot shows the standardized residuals (or Pearson’s residuals) versus fitted values and suggests that there are outliers in the data (the names elements in the plots). To check if these outliers are a cause for concern, we will now use a Levene’s test to check if the variance is distributed homogeneously (homoscedasticity) or whether the assumption of variance homogeneity is violated (due to the outliers).

### Mixed effect model is a pseudo r^2  ###
```{r}
sjPlot::tab_model(M12.fDOM)
r.squaredGLMM(M12.fDOM)
```

The R2 values of the summary table are correct as Marginal and conditional are both there. The more appropriate conditional and marginal coefficient of determination for generalized mixed-effect models can be extracted using the r.squaredGLMM function from the MuMIn package


The marginal R2 (marginal coefficient of determination) represents the variance explained by the fixed effects while the conditional R2 is interpreted as a variance explained by the entire model, including both fixed and random effects


```{r}
r.squaredGLMM(M2.fDOM)

```

This tells us that 31% of the variance can be explained...when I did the Levens test and added weights to the model it was closer to 42% but we talked about how that is a bad test and any transformation of the data would be more appropriate so let me quickly log transform this model and see if that helps with anything

```{r, echo=FALSE}
flog.fDOM <- formula(log(Hyst_index + 1) ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TempWeek +  TimeSinceChena + (1|site.ID))

Mlog.fDOM <- lmer(flog.fDOM, data = fDOM_data)

summary(Mlog.fDOM)

```
1) The scaled residuals look worse
```{r}

plot(Mlog.fDOM)

```


```{r}
qqnorm(resid(Mlog.fDOM))
```

```{r}
r.squaredGLMM(Mlog.fDOM)
```
Worse so lets stick with the original model 

```{r}
sjPlot::plot_model(M1.fDOM, type = "pred", terms = c("PrecipMonth")) +
  # show uncentered date rather than centered date
  scale_x_continuous(name = "PrecipMonth", 
                     breaks = seq(-500, 300, 100), 
                     labels = seq(1150, 1950, 100))

```

### Permafrost ###
```{r}
f4.fDOM <- formula(Hyst_index ~ StormPrecip*pf + PrecipWeek*pf + PrecipMonth*pf + Intensity*pf  + TempWeek*pf +  TimeSinceChena*pf + (1|site.ID))

M4.fDOM <- lmer(f4.fDOM, data = fDOM_data)
summary(M4.fDOM)

```
This does not show us that pf has really an effect on on predictors 

### burn ###
```{r}
f5.fDOM <- formula(Hyst_index ~ StormPrecip*burn + PrecipWeek*burn + PrecipMonth*burn + Intensity*burn  + TempWeek*burn +  TimeSinceChena*burn + (1|site.ID))

M5.fDOM <- lmer(f5.fDOM, data = fDOM_data)
summary(M5.fDOM)

```
Burn also doesnt have any significance here 

#########################################################################################################
#########################################################################################################
##################################### SPC ##############################################################
#########################################################################################################
#########################################################################################################


#### Scatter plot matrix ####
``` {r}
HI_FI_SPC_CARI <- filter(HI_FI_SPC, site.ID == "CARI")
HI_FI_SPC_FRCH <- filter(HI_FI_SPC, site.ID == "FRCH")
HI_FI_SPC_MOOS <- filter(HI_FI_SPC, site.ID == "MOOS")
HI_FI_SPC_POKE <- filter(HI_FI_SPC, site.ID == "POKE")
HI_FI_SPC_VAUL <- filter(HI_FI_SPC, site.ID == "VAUL")
HI_FI_SPC_STRT <- filter(HI_FI_SPC, site.ID == "STRT")


SPC_data.1 <- HI_FI_SPC[,c("Hyst_index","StormPrecip")]

pairs(SPC_data.1)

HI_FI_SPC %>% ggplot(aes(x = StormPrecip, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
  ggtitle("HI vs. StormPrecip")

```

``` {r}
SPC_data.2 <- HI_FI_SPC[,c("Hyst_index","PrecipWeek")]

pairs(SPC_data.2)

HI_FI_SPC %>% ggplot(aes(x = PrecipWeek, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
  ggtitle("HI vs. PrecipWeek")

```

``` {r}
SPC_data.3 <- HI_FI_SPC[,c("Hyst_index","PrecipMonth")]

pairs(SPC_data.3)

HI_FI_SPC %>% ggplot(aes(x = PrecipMonth, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
  ggtitle("HI vs. PrecipMonth")



```

``` {r}
SPC_data.4 <- HI_FI_SPC[,c("Hyst_index","ThreeMonth")]

pairs(SPC_data.4)

HI_FI_SPC %>% ggplot(aes(x = ThreeMonth, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
  ggtitle("HI vs. ThreeMonth")

```


``` {r}
SPC_data.5 <- HI_FI_SPC[,c("Hyst_index","Intensity")]

pairs(SPC_data.5)

HI_FI_SPC %>% ggplot(aes(x = Intensity, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
  ggtitle("HI vs. Intensity")

```


``` {r}
SPC_data.6 <- HI_FI_SPC[,c("Hyst_index","StormTemp")]

pairs(SPC_data.6)

HI_FI_SPC %>% ggplot(aes(x = StormTemp, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
  ggtitle("HI vs. StormTemp")
```


``` {r}
SPC_data.7 <- HI_FI_SPC[,c("Hyst_index","TempWeek")]

pairs(SPC_data.7)

HI_FI_SPC %>% ggplot(aes(x = TempWeek, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
  ggtitle("HI vs. TempWeek")

```

``` {r}
SPC_data.8 <- HI_FI_SPC[,c("Hyst_index","TimeSinceChena")]

pairs(SPC_data.8)

HI_FI_SPC %>% ggplot(aes(x = TimeSinceChena, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
  ggtitle("HI vs. TimeSinceChena")

```


``` {r}
SPC_data <- HI_FI_SPC[,c("Hyst_index", "site.ID", "StormPrecip", "StormTemp", "PrecipWeek", "PrecipMonth", "ThreeMonth", "TempWeek", "Intensity", "TimeSinceChena", "burn", "pf", "year")]

SPC_data <- na.omit(SPC_data) # 232-228
cor(SPC_data[,c(1,3:10)])

```
1) StormTemp is heavily correlated with TempWeek (0.794) but TempWeek is more correlated with HI (0.024 vs. 0.01)

2) StormTemp is also correlated with TimeSinceChena (-0.722) but TimeSinceChena is more correlated with HI (0.033 vs. -0.01)

3) PrecipWeek is correlated with PrecipMonth (0.552) but PrecipWeek is more correlated with HI (-0.314 vs. -0.246)

4) PrecipMonth is correlated with ThreeMonth (0.631) but PrecipMonth is more correlated with HI (-0.246 vs. -0.114)

5) ThreeMonth is correlated with TimeSinceChena (0.563) but ThreeMonth is more correlated with HI ( -0.114 vs. 0.033)

* this makes me want to drop time since chena and three month 

```{r, echo=FALSE}

f0.SPC <- formula(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + ThreeMonth + Intensity + StormTemp + TempWeek +  TimeSinceChena + (1|site.ID))

M0.SPC <- lmer(f0.SPC, data = SPC_data)

summary(M0.SPC)

```
1) Scaled residuals do not look as normal as they should

2) The site accounts for none of the variation 

3) Precip week is the most significant 

```{r, echo=FALSE}
plot(M0.SPC)
```
Looks good


```{r, echo=FALSE}
qqnorm(resid(M0.SPC))
```
A little bent 
``` {r}
vif(M0.SPC)

```
Any VIF>2 indicates high correlation....StormTemp and TimeSinceChena are above three...lets remove StormTemp and ThreeMonth

```{r, echo=FALSE}

f1.SPC <- formula(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TempWeek +  TimeSinceChena + (1|site.ID))

M1.SPC <- lmer(f1.SPC, data = SPC_data)

vif(M1.SPC)

```
1) all VIFs are below 2 which is good!

2) PrecipWeek and PrecipMonth (0.55)

3) TimeSinceChena and TempWeek (-0.59)

```{r, echo=FALSE}
plot(M1.SPC)
```

```{r, echo=FALSE}
qqnorm(resid(M1.SPC))
```

```{r}
pr <- ggpredict(M1.SPC, terms = c("PrecipWeek"))
plot(pr, add.data = TRUE)

```

### alternative slope ### 

```{r, echo=FALSE}

f2.SPC <- formula(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity  + TempWeek +  TimeSinceChena + (PrecipWeek|site.ID))

M2.SPC <- lmer(f2.SPC, data = SPC_data)


```


```{r, echo=FALSE}

f10.SPC <- formula(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity  + TempWeek +  TimeSinceChena + (0+PrecipWeek|site.ID) + (1|site.ID))

M10.SPC <- lmer(f10.SPC, data = SPC_data)


```


```{r}
f11 <- formula(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity  + TempWeek + TimeSinceChena + (1|site.ID) + (1|year))

M11.SPC <- lmer(f11, data = SPC_data)


```

```{r}
f12 <- formula(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity  + TempWeek + TimeSinceChena + (0+PrecipWeek|site.ID) + (1|site.ID) + (1|year))

M12.SPC <- lmer(f12, data = SPC_data)


```

```{r}
aictab(list(M0.SPC, M1.SPC, M2.SPC, M10.SPC,M11.SPC,M12.SPC))

```
Mod5: Reduced model with random intercept structure with random year and site effect 
Mod2: Reduced model (no StormTemp or ThreeMonth Precip) with random intercept structure
Mod6: Reduced model with unncorelated structure with random year and site effect
Mod4: Reduced model ('') with uncorrelated random slopes and intercept 
Mod3: Reduced model ('') with random slope structure
Mod1: Full model with random intercept structure



```{r}
m1 <- lm(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TempWeek + TimeSinceChena, data = SPC_data)
dwplot(m1,
       dot_args = list(color = "black"), # color for the dot
       whisker_args = list(color = "red"),   # color for the whisker
       vline = geom_vline(xintercept = 0, colour = "grey50", linetype = 2)) +
    xlab("Coefficient") + 
  ggtitle("") +
  theme_classic() 

ggsave("~/Documents/Storms/Output_from_analysis/From_07_Modelling/HI/SPC/coefficient.png")

```
CI overlapping 0 are nonsignificant. PrecipWeek and maybe PrecipMonth are significant


```{r}
plot(M1.SPC, site.ID ~ resid(.), abline = 0 ) # generate diagnostic plots
```
This plot shows us that there are some outliers in VAUL, POKE, and MOOS and that the variability within VAUL is greater than in other sites we therefore examine the sites in isolation standardized residuals versus fitted values

```{r}
plot(M1.SPC, resid(., type = "pearson") ~ fitted(.) | site.ID, id = 0.05, 
     adj = -0.3, pch = 20, col = "gray40")
```
The plot shows the standardized residuals (or Pearson’s residuals) versus fitted values and suggests that there are outliers in the data (the names elements in the plots). To check if these outliers are a cause for concern, we will now use a Levene’s test to check if the variance is distributed homogeneously (homoscedasticity) or whether the assumption of variance homogeneity is violated (due to the outliers).

### Mixed effect model is a pseudo r^2  ###
```{r}
sjPlot::tab_model(M11.SPC)
r.squaredGLMM(M11.SPC)
```

The R2 values of the summary table are correct as Marginal and conditional are bothe there. The more appropriate conditional and marginal coefficient of determination for generalized mixed-effect models can be extracted using the r.squaredGLMM function from the MuMIn package


The marginal R2 (marginal coefficient of determination) represents the variance explained by the fixed effects while the conditional R2 is interpreted as a variance explained by the entire model, including both fixed and random effects


```{r}
r.squaredGLMM(M1.SPC)

```
Only ~14% of the variance is explained in this model...ouch


```{r}
sjPlot::plot_model(M1.SPC, type = "pred", terms = c("PrecipWeek")) +
  # show uncentered date rather than centered date
  scale_x_continuous(name = "PrecipWeek", 
                     breaks = seq(-500, 300, 100), 
                     labels = seq(1150, 1950, 100))

```

### Permafrost ###
```{r}
f4.SPC <- formula(Hyst_index ~ StormPrecip*pf + PrecipWeek*pf + PrecipMonth*pf + Intensity*pf  + TempWeek*pf +  TimeSinceChena*pf + (1|site.ID))

M4.SPC <- lmer(f4.SPC, data = SPC_data)
summary(M4.SPC)

```
Nothing sticking out here 

### burn ###
```{r}
f5.SPC <- formula(Hyst_index ~ StormPrecip*burn + PrecipWeek*burn + PrecipMonth*burn + Intensity*burn  + TempWeek*burn +  TimeSinceChena*burn + (1|site.ID))

M5.SPC <- lmer(f5.SPC, data = SPC_data)
summary(M5.SPC)

```
Nothing sticking out here 

#########################################################################################################
#########################################################################################################
##################################### TURB ##############################################################
#########################################################################################################
#########################################################################################################


#### Scatter plot matrix ####
``` {r}
HI_FI_turb_CARI <- filter(HI_FI_turb, site.ID == "CARI")
HI_FI_turb_FRCH <- filter(HI_FI_turb, site.ID == "FRCH")
HI_FI_turb_MOOS <- filter(HI_FI_turb, site.ID == "MOOS")
HI_FI_turb_POKE <- filter(HI_FI_turb, site.ID == "POKE")
HI_FI_turb_VAUL <- filter(HI_FI_turb, site.ID == "VAUL")
HI_FI_turb_STRT <- filter(HI_FI_turb, site.ID == "STRT")

turb_data.1 <- HI_FI_turb[,c("Hyst_index","StormPrecip")]

pairs(turb_data.1)

HI_FI_turb %>% ggplot(aes(x = StormPrecip, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
  ggtitle("HI vs. StormPrecip")

```

``` {r}
turb_data.2 <- HI_FI_turb[,c("Hyst_index","PrecipWeek")]

pairs(turb_data.2)

HI_FI_turb %>% ggplot(aes(x = PrecipWeek, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
  ggtitle("HI vs. PrecipWeek")

```

``` {r}
turb_data.3 <- HI_FI_turb[,c("Hyst_index","PrecipMonth")]

pairs(turb_data.3)

HI_FI_turb %>% ggplot(aes(x = PrecipMonth, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
  ggtitle("HI vs. PrecipMonth")



```

``` {r}
turb_data.4 <- HI_FI_turb[,c("Hyst_index","ThreeMonth")]

pairs(SPC_data.4)

HI_FI_turb %>% ggplot(aes(x = ThreeMonth, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
  ggtitle("HI vs. ThreeMonth")

```


``` {r}
turb_data.5 <- HI_FI_turb[,c("Hyst_index","Intensity")]

pairs(turb_data.5)

HI_FI_turb %>% ggplot(aes(x = Intensity, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
  ggtitle("HI vs. Intensity")

```


``` {r}
turb_data.6 <- HI_FI_turb[,c("Hyst_index","StormTemp")]

pairs(turb_data.6)

HI_FI_turb %>% ggplot(aes(x = StormTemp, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
  ggtitle("HI vs. StormTemp")
```


``` {r}
turb_data.7 <- HI_FI_turb[,c("Hyst_index","TempWeek")]

pairs(turb_data.7)

HI_FI_turb %>% ggplot(aes(x = TempWeek, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
  ggtitle("HI vs. TempWeek")

```

``` {r}
turb_data.8 <- HI_FI_turb[,c("Hyst_index","TimeSinceChena")]

pairs(turb_data.8)

HI_FI_turb %>% ggplot(aes(x = TimeSinceChena, y = Hyst_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=HI_ymin, ymax=HI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylab("Hysteresis Index") +
  ggtitle("HI vs. TimeSinceChena")

```


``` {r}
turb_data <- HI_FI_turb[,c("Hyst_index", "site.ID", "StormPrecip", "StormTemp", "PrecipWeek", "PrecipMonth", "ThreeMonth", "TempWeek", "Intensity", "TimeSinceChena", "burn", "pf", "year")]

turb_data <- na.omit(turb_data) # 240 to 235
cor(turb_data[,c(1,3:10)])

```
1) StormTemp is heavily correlated with TempWeek (0.797) but StormTemp is more correlated with HI (-0.07 vs. -0.06)

2) StormTemp is also correlated with TimeSinceChena (-0.722) but StormTemp is more correlated with HI (-0.07 vs. -0.02)

2) PrecipWeek is correlated with PrecipMonth (0.542) but PrecipWeek is more correlated with HI (0.228 vs. -0.004)

3) PrecipMonth is correlated with ThreeMonth (0.628) but ThreeMonth is more correlated with HI (-0.139 vs. -0.004)

4) ThreeMonth is correlated with TimeSinceChena (0.571) but ThreeMonth is more correlated with HI ( -0.139 vs. -0.028)

* this makes me want to drop time since chena and three month 

```{r, echo=FALSE}
f0.turb <- formula(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + ThreeMonth + Intensity + StormTemp + TempWeek +  TimeSinceChena + (1|site.ID))

M0.turb <- lmer(f0.turb, data = turb_data)

summary(M0.turb)

```
1) Scaled residuals dont look ideal 

2) The site accounts for slightly more variation 

3)Precip week is the most significant 

```{r, echo=FALSE}
plot(M0.turb)
```
perhaps some funnelling 


```{r, echo=FALSE}
qqnorm(resid(M0.turb))
```

``` {r}
vif(M0.turb)

```
Any VIF > 2 indicates high correlation....lets remove StormTemp and ThreeMonth


```{r, echo=FALSE}
f1.turb <- formula(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TempWeek + TimeSinceChena + (1|site.ID))

M1.turb <- lmer(f1.turb, data = turb_data)

vif(M1.turb)
summary(M1.turb)

```
1) VIFs are all below 2...woot

2) PrecipWeek and PrecipMonth (0.54)

3) TimeSinceChena (-0.588)
```{r, echo=FALSE}
plot(M1.turb)
```

```{r, echo=FALSE}
qqnorm(resid(M1.turb))
```

```{r}
pr <- ggpredict(M1.turb, terms = c("PrecipWeek"))
plot(pr, add.data = TRUE)

```

### Alternative slopes ### 
```{r, echo=FALSE}
f2.turb <- formula(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TempWeek + TimeSinceChena + (PrecipWeek|site.ID))

M2.turb <- lmer(f2.turb, data = turb_data)

summary(M2.turb)

```

```{r, echo=FALSE}
f10.turb <- formula(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TempWeek + TimeSinceChena + (0+PrecipWeek|site.ID)+(1|site.ID))

M10.turb <- lmer(f10.turb, data = turb_data)

summary(M10.turb)

```

```{r}
pr <- ggpredict(M10.turb, terms = c("PrecipWeek"))
plot(pr, add.data = TRUE)

```


```{r}
f11 <- formula(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity  + TempWeek + TimeSinceChena + (1|site.ID) + (1|year))

M11.Turb <- lmer(f11, data = turb_data)


```

```{r}
f12 <- formula(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity  + TempWeek + TimeSinceChena + (0+PrecipWeek|site.ID) + (1|site.ID) + (1|year))

M12.Turb <- lmer(f12, data = turb_data)


```



```{r}
aictab(list(M0.turb, M1.turb, M2.turb, M10.turb, M11.Turb,M12.Turb))

```
Mod6: Uncorrelated random slope and random intercept with year and site as effect 
Mod4: Reduced model with uncorrelated random slope and random intercept 
Mod5: Reduced model with random intercept and year effect 
Mod3: Reduced model (no StormTemp, ThreeMonth Precip) with random slope intercept structure
Mod2: Reduced model ('') with random intercept structure
Mod1: Full model with random intercept structure 


```{r}
m1 <- lm(Hyst_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TempWeek + TimeSinceChena, data = turb_data)
dwplot(m1,
       dot_args = list(color = "black"), # color for the dot
       whisker_args = list(color = "red"),   # color for the whisker
       vline = geom_vline(xintercept = 0, colour = "grey50", linetype = 2)) +
    xlab("Coefficient") + 
  ggtitle("") +
  theme_classic() 

ggsave("~/Documents/Storms/Output_from_analysis/From_07_Modelling/HI/Turb/coefficient.png")

```
CI overlapping 0 are nonsignificant which is almost everything besides PrecipMonth and PrecipWeek for our reduced model 


```{r}
plot(M1.turb, site.ID ~ resid(.), abline = 0 ) # generate diagnostic plots
```
This plot shows us that there are some outliers in all of our sites and that the variability within FRCH is greater than in other sites we therefore examine the sites in isolation standardized residuals versus fitted values

```{r}
plot(M1.turb, resid(., type = "pearson") ~ fitted(.) | site.ID, id = 0.05, 
     adj = -0.3, pch = 20, col = "gray40")
```
The plot shows the standardized residuals (or Pearson’s residuals) versus fitted values and suggests that there are outliers in the data (the names elements in the plots). To check if these outliers are a cause for concern, we will now use a Levene’s test to check if the variance is distributed homogeneously (homoscedasticity) or whether the assumption of variance homogeneity is violated (due to the outliers).


### Mixed effect model is a pseudo r^2  ###
```{r}
sjPlot::tab_model(M12.Turb)
r.squaredGLMM(M12.Turb)
```

The R2 values of the summary table are correct as Marginal and conditional are bothe there. The more appropriate conditional and marginal coefficient of determination for generalized mixed-effect models can be extracted using the r.squaredGLMM function from the MuMIn package


The marginal R2 (marginal coefficient of determination) represents the variance explained by the fixed effects while the conditional R2 is interpreted as a variance explained by the entire model, including both fixed and random effects


```{r}
r.squaredGLMM(M10.turb)

```
only 12%...ouch
```{r}
sjPlot::plot_model(M1.turb, type = "pred", terms = c("PrecipWeek")) +
  # show uncentered date rather than centered date
  scale_x_continuous(name = "PrecipWeek", 
                     breaks = seq(-500, 300, 100), 
                     labels = seq(1150, 1950, 100))

```

### Permafrost ###
```{r}
f4.turb <- formula(Hyst_index ~ StormPrecip*pf + PrecipWeek*pf + PrecipMonth*pf + Intensity*pf  + TempWeek*pf +  TimeSinceChena*pf + (1|site.ID))

M4.turb <- lmer(f4.turb, data = turb_data)
summary(M4.turb)

```
Permafrost does have a significant effect with PrecipMonth

### burn ###
```{r}
f5.turb <- formula(Hyst_index ~ StormPrecip*burn + PrecipWeek*burn + PrecipMonth*burn + Intensity*burn  + TempWeek*burn +  TimeSinceChena*burn + (1|site.ID))

M5.turb <- lmer(f5.turb, data = turb_data)
summary(M5.turb)

```
Fire has significant interaction with TimeSinceChena 


############################################################################################################################################### Catchment effects ################################################
#########################################################################################################


```{r}
CV.all <- antecedent_HI_FI_1_0 %>% group_by(response_var,site.ID, year) %>%
  summarize(meanHI = mean(Hyst_index),
            meanFI = mean(Flush_index, na.rm = TRUE),
            meanBETA = mean(beta, na.rm = TRUE),
            sdHI = sd(Hyst_index),
            sdFI = sd(Flush_index, na.rm = TRUE),
            sdBETA = sd(beta, na.rm = TRUE),
            CVhi = sdHI/meanHI,
            CVfi = sdFI/meanFI,
            CVbeta = sdBETA/meanBETA,
            pf = paste(pf),
            burn = paste(burn)) # calculating mean HI and CV for each year and each site

CV.all <- CV.all[!duplicated(CV.all$meanHI), ] # removing duplicated rows 

chem <- read_csv("~/Documents/Storms/Output_from_analysis/From_07_Modelling/Results_figures/Discharge_chem/all.chem.csv", 
    col_types = cols(fDOM.QSU = col_double(), 
        nitrateuM = col_double(), SpCond.uScm = col_double(), 
        Turbidity.FNU = col_double())) # reading in all chem data 

chem.mean <- chem %>% group_by(Site, year) %>% 
  summarize(meanfDOM = mean(fDOM.QSU, na.rm = TRUE)) # generating mean fDOM concentration by site and year 

names(chem.mean) <- c("site.ID", "year", "meanfDOM") # changing the names so they can be merged

CV.all.model <- left_join(CV.all, chem.mean, by = c("site.ID", "year")) # merging TNDOC and CV to run for the model 

NO3.CV <- subset(CV.all.model, CV.all$response_var == "NO3")
NO3.CV <- NO3.CV[-c(4,19),] # removing CARI 2021 due to it being an outlier 


fcvno3 <- formula(CVhi ~ pf*meanfDOM + burn*meanfDOM + (1|year))

Mcvno3 <- lmer(fcvno3, data = NO3.CV)
summary(Mcvno3)

plot(Mcvno3)

qqnorm(resid(Mcvno3))

sjPlot::tab_model(Mcvno3)
r.squaredGLMM(Mcvno3)

m1 <- lm(CVhi ~ pf*meanfDOM + burn*meanfDOM, data = NO3.CV)
dwplot(m1,
       dot_args = list(color = "black"), # color for the dot
       whisker_args = list(color = "red"),   # color for the whisker
       vline = geom_vline(xintercept = 0, colour = "grey50", linetype = 2)) +
    xlab("Coefficient") + 
  ggtitle("") +
  theme_classic() 

#write.csv(CV.all.model, "~/Documents/Storms/Output_from_analysis/From_07_Modelling/TNDOC_CV.csv")

CV.all <- antecedent_HI_FI_1_0 %>% group_by(response_var,site.ID, year) %>%
  summarize(meanHI = mean(Hyst_index),
            meanFI = mean(Flush_index),
            meanBETA = mean(beta),
            sdHI = sd(Hyst_index),
            sdFI = sd(Flush_index),
            sdBETA = sd(beta),
            CVhi = sd(Hyst_index)/mean(Hyst_index),
            CVfi = sd(Flush_index)/mean(Flush_index),
            CVbeta = sd(beta)/mean(beta),
            pf = paste(pf),
            burn = paste(burn)) # calculating mean HI and CV for each year and each site

chem.mean <- chem %>% group_by(Site, year) %>% 
  summarize(meanfDOM = mean(fDOM.QSU, na.rm = TRUE)) # generating mean fDOM concentration by site and year 
```



######################################################################################################################################################### beta ################################################## #########################################################################################################

```{r}

beta.pl <- antecedent_HI_FI_1_0  %>%
  ggplot(aes(x = doy, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID)) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("Beta") +
  ggtitle("Beta") +
  facet_grid(rows=vars(year), cols = vars(response_var)) 
  
beta.pl

```

#### Scatter plot matrix ####
``` {r}
HI_FI_NO3 %>% ggplot(aes(x = StormPrecip, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("beta") +
  ggtitle("Beta vs. StormPrecip")

```

``` {r}
HI_FI_NO3 %>% ggplot(aes(x = PrecipWeek, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("beta") +
  ggtitle("Beta vs. PrecipWeek")

```
any value over 1.5 is an outlier 

``` {r}
NO3_data.1 <- HI_FI_NO3[,c("beta","PrecipMonth")]

pairs(NO3_data.1)

HI_FI_NO3 %>% ggplot(aes(x = PrecipMonth, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("beta") +
  ggtitle("Beta vs. PrecipMonth")

```

``` {r}
NO3_data.1 <- HI_FI_NO3[,c("beta","ThreeMonth")]

pairs(NO3_data.1)

HI_FI_NO3 %>% ggplot(aes(x = ThreeMonth, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("beta") +
  ggtitle("Beta vs. ThreeMonth")

```

``` {r}
HI_FI_NO3 %>% ggplot(aes(x = StormTemp, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("beta") +
  ggtitle("Beta vs. StormTemp")

```

``` {r}
HI_FI_NO3 %>% ggplot(aes(x = TempWeek, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("beta") +
  ggtitle("Beta vs.TempWeek")

```

``` {r}
HI_FI_NO3 %>% ggplot(aes(x = Intensity, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("beta") +
  ggtitle("Beta vs. Intensity")

```

``` {r}
HI_FI_NO3 %>% ggplot(aes(x = TimeSinceChena, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("Flushing Index") +
  ggtitle("Beta vs. TimeSinceChena")

```

``` {r}
NO3_data_beta <- HI_FI_NO3[,c("beta", "site.ID", "StormPrecip", "StormTemp", "PrecipWeek", "PrecipMonth", "ThreeMonth", "TempWeek", "Intensity", "TimeSinceChena", "burn", "pf", "year")]

NO3_data_beta <- na.omit(NO3_data_beta) #236 to 216
which(NO3_data_beta$beta > 1.5)
NO3_data_beta <- NO3_data_beta[-c(5,63,80,102,125,144,151,180,192,201), ] # remove outliers
which(NO3_data_beta$beta < -1.5)
NO3_data_beta <- NO3_data_beta[-c(56,78,90,91,113,129,163,173,204), ] # remove outliers

cor(NO3_data_beta[,c(1,3:10)])


```
1) StormTemp is correlated with TempWeek (0.799) but TempWeek is more correlated with beta (0.12 vs. 0.11)

2) StormTemp is correlated with TimeSinceChena (-0.759) but TimeSinceChena is more correlated with beta (-0.16 vs. 0.11)

3) PrecipWeek is correlated with PrecipMonth (0.574) but PrecipWeek is more correlated with beta (0.12 vs. -0.03)

4) PrecipMonth is correlated with ThreeMonth (0.589) but ThreeMonth is more correlated with beta (-0.13 vs. -0.03) 

5) ThreeMonth is correlated with TimeSinceChena (0.613) but TimeSinceChena is more correlated with beta (-0.16 vs. -0.13)

```{r, echo=FALSE}
f0.NO3_beta <- formula(beta ~ StormPrecip + PrecipWeek + PrecipMonth + ThreeMonth + Intensity + StormTemp + TempWeek +  TimeSinceChena + (1|site.ID))

M0.NO3_beta <- lmer(f0.NO3_beta, data = NO3_data_beta)

summary(M0.NO3_beta)

```
1) Our scaled residuals look good

2) site slightly explains variance

3) PrecipWeek seems to be the most important 
```{r, echo=FALSE}
plot(M0.NO3_beta)
```

```{r, echo=FALSE}
qqnorm(resid(M0.NO3_beta))
```

```{r, echo=FALSE}
vif(M0.NO3_beta)
```
Any VIFs > 2 indicated correlation 

```{r, echo=FALSE}
f1.NO3_beta <- formula(beta ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TempWeek +  TimeSinceChena + (1|site.ID))

M1.NO3.beta <- lmer(f1.NO3_beta, data = NO3_data_beta)

vif(M1.NO3.beta)

```
1) No VIFs over 2!

2) PrecipWeek and PrecipMonth (0.57)

3) TimeSinceChena and TempWeek (-0.63)
```{r, echo=FALSE}
plot(M1.NO3.beta)
```

```{r, echo=FALSE}
qqnorm(resid(M1.NO3.beta))
```

```{r}
pr <- ggpredict(M1.NO3.beta, terms = c("PrecipWeek"))
plot(pr, add.data = TRUE)

```

```{r}
f2.NO3_beta <- formula(beta ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TempWeek +  TimeSinceChena + (PrecipWeek|site.ID))

M2.NO3.beta <- lmer(f2.NO3_beta, data = NO3_data_beta)


```


```{r}
f10.NO3_beta <- formula(beta ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TempWeek +  TimeSinceChena + (0+PrecipWeek|site.ID)+(1|site.ID))

M10.NO3.beta <- lmer(f10.NO3_beta, data = NO3_data_beta)


```

```{r}
pr <- ggpredict(M10.NO3.beta, terms = c("PrecipWeek"))
plot(pr, add.data = TRUE)

```


```{r}
f11.NO3_beta <- formula(beta ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity  + TempWeek + TimeSinceChena + (1|site.ID) + (1|year))

M11.NO3.beta <- lmer(f11.NO3_beta, data = NO3_data_beta)

```

```{r}
f12.NO3_beta <- formula(beta ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity  + TempWeek + TimeSinceChena + (0+PrecipWeek|site.ID) + (1|site.ID) + (1|year))

M12.NO3.beta <- lmer(f12.NO3_beta, data = NO3_data_beta)

```


```{r}
aictab(list(M0.NO3_beta, M1.NO3.beta, M2.NO3.beta, M10.NO3.beta, M11.NO3.beta, M12.NO3.beta))

```
Mod4: Reduced model with uncorrelated random slopes and intercept
Mod6: Reduced model with uncorrelated structure with year and site as random effect 
Mod3: Reduced model (No StormTemp or ThreeMonth) with random slopes structure
Mod2: Reduced model ('') with random intercept structure
Mod5: Reduced model with random intercept structure with year and site as random effect 
Mod1: Full model with random intercept structure

```{r}
m1 <- lm(beta ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TempWeek + TimeSinceChena, data = NO3_data_beta)
dwplot(m1,
       dot_args = list(color = "black"), # color for the dot
       whisker_args = list(color = "red"),   # color for the whisker
       vline = geom_vline(xintercept = 0, colour = "grey50", linetype = 2)) +
    xlab("Coefficient") + 
  ggtitle("") +
  theme_classic() 

ggsave("~/Documents/Storms/Output_from_analysis/From_07_Modelling/Beta/NO3 /coefficient.png")

```
CI overlapping with 0 implies nonsignificace
PrecipWeek is the only significant predictor
```{r}
sjPlot::tab_model(M10.NO3.beta)
r.squaredGLMM(M10.NO3.beta)

sjPlot::tab_model(M2.NO3.beta)
r.squaredGLMM(M2.NO3.beta)
```
Only 12.3% explained 

### Permafrost ###
```{r, echo=FALSE}
f3.NO3_beta <- formula(beta ~ StormPrecip*pf + PrecipWeek*pf + PrecipMonth*pf + ThreeMonth*pf + Intensity*pf + StormTemp*pf + TempWeek*pf +  TimeSinceChena*pf + (1|site.ID))

M3.NO3_beta <- lmer(f3.NO3_beta, data = NO3_data_beta)

summary(M3.NO3_beta)

```

### Wildfire ###
```{r, echo=FALSE}
f4.NO3_beta <- formula(beta ~ StormPrecip*burn + PrecipWeek*burn + PrecipMonth*burn + ThreeMonth*burn + Intensity*burn + StormTemp*burn + TempWeek*burn +  TimeSinceChena*burn + (1|site.ID))

M4.NO3_beta <- lmer(f4.NO3_beta, data = NO3_data_beta)

summary(M4.NO3_beta)

```

#########################################################################################################
######################################### fDOM ##########################################################
#########################################################################################################


#### Scatter plot matrix ####
``` {r}
HI_FI_fDOM %>% ggplot(aes(x = StormPrecip, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("beta") +
  ggtitle("Beta vs. StormPrecip")

```

``` {r}
HI_FI_fDOM %>% ggplot(aes(x = PrecipWeek, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("beta") +
  ggtitle("Beta vs.PrecipWeek")

```

``` {r}
HI_FI_fDOM %>% ggplot(aes(x = PrecipMonth, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("beta") +
  ggtitle("Beta vs. PrecipMonth")

```

``` {r}
HI_FI_fDOM %>% ggplot(aes(x = ThreeMonth, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("beta") +
  ggtitle("Beta vs.ThreeMonth")



```

``` {r}
HI_FI_fDOM %>% ggplot(aes(x = StormTemp, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("beta") +
  ggtitle("Beta vs. StormTemp")

```

``` {r}

HI_FI_fDOM %>% ggplot(aes(x = TempWeek, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("beta") +
  ggtitle("Beta vs. TempWeek")

```

``` {r}
HI_FI_fDOM %>% ggplot(aes(x = Intensity, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("beta") +
  ggtitle("Beta vs. Intensity")

```

``` {r}
HI_FI_fDOM %>% ggplot(aes(x = TimeSinceChena, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("beta") +
  ggtitle("Beta vs. TimeSinceChena")

```


``` {r}
fDOM_data_beta <- HI_FI_fDOM[,c("beta", "site.ID", "StormPrecip", "StormTemp", "PrecipWeek", "PrecipMonth", "ThreeMonth", "TempWeek", "Intensity", "TimeSinceChena", "burn", "pf", "year")]

fDOM_data_beta <- na.omit(fDOM_data_beta) #241 to 232

which(fDOM_data_beta$beta > 1.5)
fDOM_data_beta <- fDOM_data_beta[-c(29,40,46, 54,57,79,85,105,125,152,153,154,177,185,186,195,205,207,212, 215, 221), ] # remove outliers
which(fDOM_data_beta$beta < -1.5)
fDOM_data_beta <- fDOM_data_beta[-c(56,83,84,90,117,164,201,203), ] # remove outliers

cor(fDOM_data_beta[,c(1,3:10)])


```

1) StormTemp is correlated with TempWeek (0.776) but TempWeek is more correlated with beta (-0.21 vs. 0.12)

2) StormTemp is correlated with TimeSinceChena (-0.713) but StormTemp is more correlated with beta (0.12 vs. 0.02)

3) PrecipWeek is correlated with PrecipMonth (0.56) but PrecipMonth is more correlated with beta (-0.18 vs. 0.09)

4) PreciMonth is correlated with ThreeMonth (0.648) but ThreeMonth is more correlated with beta (-0.19 vs. -0.18) 

5) ThreeMonth is correlated with TimeSinceChena (0.576) but ThreeMonth is is more correlated with beta (-0.19 vs. 0.02)

```{r, echo=FALSE}
f0.fDOM_beta <- formula(beta ~ StormPrecip + PrecipWeek + PrecipMonth + ThreeMonth + Intensity + StormTemp + TempWeek +  TimeSinceChena + (1|site.ID))

M0.fDOM_beta <- lmer(f0.fDOM_beta, data = fDOM_data_beta)

summary(M0.fDOM_beta)

```
1) scaled residuals look good
2) Site is explaining a little of the variance 
3)Apparently nothing is significant 
```{r, echo=FALSE}
plot(M0.fDOM_beta)
```

```{r, echo=FALSE}
qqnorm(resid(M0.fDOM_beta))
```

```{r, echo=FALSE}
vif(M0.fDOM_beta)
```
VIFs > 2 indicate correlation 

```{r, echo=FALSE}
f1.fDOM_beta <- formula(beta ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TempWeek +  TimeSinceChena + (1|site.ID))

M1.fDOM_beta <- lmer(f1.fDOM_beta, data = fDOM_data_beta)

summary(M1.fDOM_beta)

```
TempWeek is the most important 

```{r, echo=FALSE}
vif(M1.fDOM_beta)
```


```{r, echo=FALSE}
plot(M1.fDOM_beta)
```

```{r, echo=FALSE}
qqnorm(resid(M1.fDOM_beta))
```

```{r}
pr <- ggpredict(M1.fDOM_beta, terms = c("StormPrecip"))
plot(pr, add.data = TRUE)

```

```{r, echo=FALSE}
f2.fDOM_beta <- formula(beta ~ StormPrecip + PrecipWeek + PrecipMonth + ThreeMonth + Intensity + StormTemp + TempWeek +  TimeSinceChena + (PrecipWeek|site.ID))

M2.fDOM_beta <- lmer(f2.fDOM_beta, data = fDOM_data_beta)

summary(M2.fDOM_beta)

```
```{r, echo=FALSE}
f10.fDOM_beta <- formula(beta ~ StormPrecip + PrecipWeek + PrecipMonth + ThreeMonth + Intensity + StormTemp + TempWeek +  TimeSinceChena + (0+PrecipWeek|site.ID) + (1|site.ID))

M10.fDOM_beta <- lmer(f10.fDOM_beta, data = fDOM_data_beta)


```


```{r}
f11.fDOM_beta <- formula(beta ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity  + TempWeek + TimeSinceChena + (1|site.ID) + (1|year))

M11.fDOM.beta <- lmer(f11.fDOM_beta, data = fDOM_data_beta)

```

```{r}
f12.fDOM_beta <- formula(beta ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity  + TempWeek + TimeSinceChena + (0+PrecipWeek|site.ID) + (1|site.ID) + (1|year))

M12.fDOM.beta <- lmer(f12.fDOM_beta, data = fDOM_data_beta)

```


```{r}
aictab(list(M0.fDOM_beta, M1.fDOM_beta, M2.fDOM_beta, M10.fDOM_beta, M11.fDOM.beta, M12.fDOM.beta))

```
Mod2: Reduced model (No StormTemp or ThreeMonth Precip) with random intercept structure
Mod5: Reduced model ('') with random intercept with year and site as random effects
Mod6: Reduced model ('') with uncorrelated structure with year and site as random effect
Mod1: Full model with random intercept structure
Mod4: Reduced model('') with uncorrelated slope and intercept structure 
Mod3: Reduced model ('') with random slope structure


```{r}
m1 <- lm(beta ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TempWeek + TimeSinceChena, data = fDOM_data_beta)
dwplot(m1,
       dot_args = list(color = "black"), # color for the dot
       whisker_args = list(color = "red"),   # color for the whisker
       vline = geom_vline(xintercept = 0, colour = "grey50", linetype = 2)) +
    xlab("Coefficient") + 
  ggtitle("") +
  theme_classic() 

ggsave("~/Documents/Storms/Output_from_analysis/From_07_Modelling/Beta/fDOM /coefficient.png")

```
CI overlapping 0 indicate nonsignificance and it seems like only TempWeek is significant

```{r}
sjPlot::tab_model(M1.fDOM_beta)
r.squaredGLMM(M1.fDOM_beta)
```
21% explained 

### Permafrost ###
```{r, echo=FALSE}
f3.fDOM_beta <- formula(beta ~ StormPrecip*pf + PrecipWeek*pf + PrecipMonth*pf + ThreeMonth*pf + Intensity*pf + StormTemp*pf + TempWeek*pf +  TimeSinceChena*pf + (1|site.ID))

M3.fDOM_beta <- lmer(f3.fDOM_beta, data = fDOM_data_beta)

summary(M3.fDOM_beta)

```
PF doesnt appear to have an effect 

### Wildfire ###
```{r, echo=FALSE}
f4.fDOM_beta <- formula(beta ~ StormPrecip*burn + PrecipWeek*burn + PrecipMonth*burn + ThreeMonth*burn + Intensity*burn + StormTemp*burn + TempWeek*burn +  TimeSinceChena*burn + (1|site.ID))

M4.fDOM_beta <- lmer(f4.fDOM_beta, data = fDOM_data_beta)

summary(M4.fDOM_beta)

```
Wildfire seems to have a more substantial effect 

#########################################################################################################
######################################### SPC ##########################################################
#########################################################################################################


#### Scatter plot matrix ####
``` {r}
HI_FI_SPC %>% ggplot(aes(x = StormPrecip, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("beta") +
  ggtitle("Beta vs. StormPrecip")

```

``` {r}
HI_FI_SPC %>% ggplot(aes(x = PrecipWeek, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("beta") +
  ggtitle("Beta vs. PrecipWeek")

```

``` {r}
HI_FI_SPC %>% ggplot(aes(x = PrecipMonth, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("beta") +
  ggtitle("beta vs. PrecipMonth")

```

``` {r}
HI_FI_SPC %>% ggplot(aes(x = ThreeMonth, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("beta") +
  ggtitle("Beta vs. ThreeMonth")

```

``` {r}
HI_FI_SPC %>% ggplot(aes(x = StormTemp, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("beta") +
  ggtitle("Beta vs. StormTemp")

```

``` {r}
HI_FI_SPC %>% ggplot(aes(x = TempWeek, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("Beta") +
  ggtitle("Beta vs. TempWeek")

```

``` {r}

HI_FI_SPC %>% ggplot(aes(x = Intensity, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("Beta") +
  ggtitle("Beta vs. Intensity")

```

``` {r}
HI_FI_SPC %>% ggplot(aes(x = TimeSinceChena, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("beta") +
  ggtitle("Beta vs. TimeSinceChena")

```


``` {r}
SPC_data_beta <- HI_FI_SPC[,c("beta", "site.ID", "StormPrecip", "StormTemp", "PrecipWeek", "PrecipMonth", "ThreeMonth", "TempWeek", "Intensity", "TimeSinceChena", "burn", "pf", "year")]

SPC_data_beta <- na.omit(SPC_data_beta) #232 to 223
which(SPC_data_beta$beta > 1.5)
SPC_data_beta <- SPC_data_beta[-c(48,61,88,109,111,130,173,206), ]
which(SPC_data_beta$beta < -1.5)
SPC_data_beta <- SPC_data_beta[-c(44,96,97,100,117,120), ]
cor(SPC_data_beta[,c(1,3:10)])


```

1) StormTemp is correlated with TempWeek (0.80) but TempWeek is more correlated with beta (0.10 vs. 0.03)

2) StormTemp is correlated with TimeSinceChena (-0.737) but TSC is more correlated with beta (-0.04 vs. 0.03)

3) PrecipWeek is correlated with PrecipMonth (0.591) but PrecipMonth is more correlated with beta (0.10 vs. 0.02)

4) PrecipMonth is correlated with ThreeMonth (0.627) but ThreeMonth is more correlated with beta (0.20 vs. 0.20) 

5) ThreeMonth is correlated with TimeSinceChena (0.556) but ThreeMonth is more correlated with FI (0.20 vs. 0.04)

```{r, echo=FALSE}
f0.SPC_beta <- formula(beta ~ StormPrecip + PrecipWeek + PrecipMonth + ThreeMonth + Intensity + StormTemp + TempWeek +  TimeSinceChena + (1|site.ID))

M0.SPC_beta <- lmer(f0.SPC_beta, data = SPC_data_beta)

summary(M0.SPC_beta)

```
1) Scaled residuals look okay
2) Site slight explanation for variation
3) Nothing really significant 
```{r, echo=FALSE}
plot(M0.SPC_beta)
```
This looks less good 
```{r, echo=FALSE}
qqnorm(resid(M0.SPC_beta))
```
Do we need to log transform this?


```{r, echo=FALSE}
f1.SPC_beta <- formula(beta ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TempWeek +  TimeSinceChena + (1|site.ID))

M1.SPC_beta <- lmer(f1.SPC_beta, data = SPC_data_beta)

summary(M1.SPC_beta)

```
```{r, echo=FALSE}
vif(M1.SPC_beta)
```


```{r, echo=FALSE}
plot(M1.SPC_beta)
```

```{r, echo=FALSE}
qqnorm(resid(M1.SPC_beta))
```

```{r}
pr <- ggpredict(M1.turb, terms = c("PrecipMonth"))
plot(pr, add.data = TRUE)

```

```{r, echo=FALSE}
f2.SPC_beta <- formula(beta ~ StormPrecip + PrecipWeek + PrecipMonth  + Intensity + TempWeek +  TimeSinceChena + (PrecipWeek|site.ID))

M2.SPC_beta <- lmer(f2.SPC_beta, data = SPC_data_beta)

summary(M2.SPC_beta)

```
```{r, echo=FALSE}
f10.SPC_beta <- formula(beta ~ StormPrecip + PrecipWeek + PrecipMonth  + Intensity + TempWeek +  TimeSinceChena + (0+PrecipWeek|site.ID)+(1|site.ID))

M10.SPC_beta <- lmer(f10.SPC_beta, data = SPC_data_beta)


```


```{r}
f11.SPC_beta <- formula(beta ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity  + TempWeek + TimeSinceChena + (1|site.ID) + (1|year))

M11.SPC.beta <- lmer(f11.SPC_beta, data = SPC_data_beta)

```

```{r}
f12.SPC_beta <- formula(beta ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity  + TempWeek + TimeSinceChena + (0+PrecipWeek|site.ID) + (1|site.ID) + (1|year))

M12.SPC.beta <- lmer(f12.SPC_beta, data = SPC_data_beta)

```



```{r}
aictab(list(M0.SPC_beta, M1.SPC_beta, M2.SPC_beta, M10.SPC_beta, M11.SPC.beta, M12.SPC.beta))

```
Mod5: Reduced modelwith random intercept structure with site and year as random effects
Mod6: Uncorrelated structure with year and site as a random effect
Mod2: Reduced model (No StormTemp or ThreeMonth Precip) with random intercept structure
Mod4: Reduced model ('') with uncorrelated slope and intercept 
Mod3: Reduced model ('') with random slope structure
Mod1: Full model with random intercept structure

```{r}
m1 <- lm(beta ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TempWeek + TimeSinceChena, data = SPC_data_beta)
dwplot(m1,
       dot_args = list(color = "black"), # color for the dot
       whisker_args = list(color = "red"),   # color for the whisker
       vline = geom_vline(xintercept = 0, colour = "grey50", linetype = 2)) +
    xlab("Coefficient") + 
  ggtitle("") +
  theme_classic() 

ggsave("~/Documents/Storms/Output_from_analysis/From_07_Modelling/Beta/SPC /coefficient.png")

```


```{r}
sjPlot::tab_model(M11.SPC.beta)
r.squaredGLMM(M11.SPC.beta)
```
13.8% explained 

### Permafrost ###
```{r, echo=FALSE}
f3.SPC_beta <- formula(beta ~ StormPrecip*pf + PrecipWeek*pf + PrecipMonth*pf + ThreeMonth*pf + Intensity*pf + StormTemp*pf + TempWeek*pf +  TimeSinceChena*pf + (1|site.ID))

M3.SPC_beta <- lmer(f3.SPC_beta, data = SPC_data_beta)

summary(M3.SPC_beta)

```
Permafors on TimeSinceChena

### Wildfire ###
```{r, echo=FALSE}
f4.SPC_beta <- formula(beta ~ StormPrecip*burn + PrecipWeek*burn + PrecipMonth*burn + ThreeMonth*burn + Intensity*burn + StormTemp*burn + TempWeek*burn +  TimeSinceChena*burn + (1|site.ID))

M4.SPC_beta <- lmer(f4.SPC_beta, data = SPC_data_beta)

summary(M4.SPC_beta)

```
Wildfire doesnt seem to have much of an effect 

#########################################################################################################
######################################### turb ##########################################################
#########################################################################################################


#### Scatter plot matrix ####
``` {r}
HI_FI_turb %>% ggplot(aes(x = StormPrecip, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("beta") +
  ggtitle("beta vs. StormPrecip")

```

``` {r}
HI_FI_turb %>% ggplot(aes(x = PrecipWeek, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("Beta") +
  ggtitle("Beta vs. PrecipWeek")

```

``` {r}
HI_FI_turb %>% ggplot(aes(x = PrecipMonth, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("Beta") +
  ggtitle("Beta vs. PrecipMonth")

```

``` {r}
HI_FI_turb %>% ggplot(aes(x = ThreeMonth, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("Beta") +
  ggtitle("Beta vs. ThreeMonth")

```

``` {r}

HI_FI_turb %>% ggplot(aes(x = StormTemp, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("Beta") +
  ggtitle("Beta vs. StormTemp")

```

``` {r}
HI_FI_turb %>% ggplot(aes(x = TempWeek, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("Beta") +
  ggtitle("Beta vs. TempWeek")

```

``` {r}
HI_FI_turb %>% ggplot(aes(x = Intensity, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("beta") +
  ggtitle("Beta vs. Intensity")

```

``` {r}

HI_FI_turb %>% ggplot(aes(x = TimeSinceChena, y = beta)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)), "Catchment")+theme_bw() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = 1)) + 
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "right",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  ylim(c(-1.5, 1.5)) +
  ylab("beta ") +
  ggtitle("Beta vs. TimeSinceChena")

```


``` {r}
turb_data_beta <- HI_FI_turb[,c("beta", "site.ID", "StormPrecip", "StormTemp", "PrecipWeek", "PrecipMonth", "ThreeMonth", "TempWeek", "Intensity", "TimeSinceChena", "burn", "pf", "year")]

turb_data_beta <- na.omit(turb_data_beta) #240 to 229
which(turb_data_beta$beta > 1.5)
turb_data_beta <- turb_data_beta[-c(22,25,51,68,73,83,91,92,95,99,120,129,146,174,177,200,209,219,221),]
which(turb_data_beta$beta < -1.5)
turb_data_beta <- turb_data_beta[-c(21,139,195),]

cor(turb_data_beta[,c(1,3:10)])


```
1) StormTemp is correlated with TempWeek (0.806) but StormTemp is more correlated with beta (0.04 vs. 0.008)

2) StormTemp is correlated with TimeSinceChena (-0.704) but StormTemp is more correlated with beta (-0.03 vs. 0.04)

3) PrecipWeek is correlated with PrecipMonth (0.546) but PrecipWeek is more correlated with beta (-0.18 vs. -0.157)

4) PrecipMonth is correlated with ThreeMonth (0.633) but PrecipMonth is more correlated with beta (-0.15 vs. -0.14) 

5) ThreeMonth is correlated with TimeSinceChena (0.558) but ThreeMonth is more correlated with beta (-0.14 vs. -0.03)

```{r, echo=FALSE}
f0.turb_beta <- formula(beta ~ StormPrecip + PrecipWeek + PrecipMonth + ThreeMonth + Intensity + StormTemp + TempWeek +  TimeSinceChena + (1|site.ID))

M0.turb_beta <- lmer(f0.turb_beta, data = turb_data_beta)

summary(M0.turb_beta)

```
1)Scaled residuals look eh

2) Slight site variation

3) StormPrecip is most important

```{r, echo=FALSE}
plot(M0.turb_beta)
```

```{r, echo=FALSE}
qqnorm(resid(M0.turb_beta))
```


```{r, echo=FALSE}
f1.turb_beta <- formula(beta~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TempWeek +  TimeSinceChena + (1|site.ID))

M1.turb_beta <- lmer(f1.turb_beta, data = turb_data_beta)

summary(M1.turb_beta)

```

```{r, echo=FALSE}
vif(M1.turb_beta)
```

```{r, echo=FALSE}
plot(M1.turb_beta)
```

```{r, echo=FALSE}
qqnorm(resid(M1.turb_beta))
```

```{r}
pr <- ggpredict(M1.turb_beta, terms = c("PrecipWeek"))
plot(pr, add.data = TRUE)

```

```{r, echo=FALSE}
f2.turb_beta <- formula(beta ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TempWeek +  TimeSinceChena + (PrecipWeek|site.ID))

M2.turb_beta <- lmer(f2.turb_beta, data = turb_data_beta)

summary(M2.turb_beta)

```
```{r, echo=FALSE}
f10.turb_beta <- formula(beta ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TempWeek +  TimeSinceChena + (0+PrecipWeek|site.ID)+(1|site.ID))

M10.turb_beta <- lmer(f10.turb_beta, data = turb_data_beta)


```


```{r}
f11.turb_beta <- formula(beta ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity  + TempWeek + TimeSinceChena + (1|site.ID) + (1|year))

M11.turb.beta <- lmer(f11.turb_beta, data = turb_data_beta)

```

```{r}
f12.turb_beta <- formula(beta ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity  + TempWeek + TimeSinceChena + (0+PrecipWeek|site.ID) + (1|site.ID) + (1|year))

M12.turb.beta <- lmer(f12.turb_beta, data = turb_data_beta)

```


```{r}
aictab(list(M0.turb_beta, M1.turb_beta, M2.turb_beta, M10.turb_beta, M11.turb.beta, M12.turb.beta))

```
Mod5: Reduced model with random intercept structure with year and site as a random effect
Mod6: Reduced model with uncorrelated structure with year and site as a random effect 
Mod2: Reduced Model (no StormPrcip or ThreeMonth) with random intercept structure
Mod4: Reduced Model('') with uncorrelated structure 
Mod3: Reduced model ('') with random slope structure
Mod1: Full model with random intercept structure 

```{r}
m1 <- lm(beta ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TempWeek + TimeSinceChena, data = turb_data_beta)
dwplot(m1,
       dot_args = list(color = "black"), # color for the dot
       whisker_args = list(color = "red"),   # color for the whisker
       vline = geom_vline(xintercept = 0, colour = "grey50", linetype = 2)) +
    xlab("Coefficient") + 
  ggtitle("") +
  theme_classic() 

ggsave("~/Documents/Storms/Output_from_analysis/From_07_Modelling/Beta/Turb/coefficient.png")

```

```{r}
sjPlot::tab_model(M11.turb.beta)
r.squaredGLMM(M11.turb.beta)
```
13% explained

### Permafrost ###
```{r, echo=FALSE}
f3.turb_beta <- formula(beta ~ StormPrecip*pf + PrecipWeek*pf + PrecipMonth*pf + ThreeMonth*pf + Intensity*pf + StormTemp*pf + TempWeek*pf +  TimeSinceChena*pf + (1|site.ID))

M3.turb_beta <- lmer(f3.turb_beta, data = turb_data_beta)

summary(M3.turb_beta)

```

### Wildfire ###
```{r, echo=FALSE}
f4.turb_beta <- formula(beta ~ StormPrecip*burn + PrecipWeek*burn + PrecipMonth*burn + Intensity*burn + TempWeek*burn +  TimeSinceChena*burn + (1|site.ID))

M4.turb_beta <- lmer(f4.turb_beta, data = turb_data_beta)

summary(M4.turb_beta)

```


#########################################################################################################
#########################################################################################################
##################################### FI ################################################################
#########################################################################################################
#########################################################################################################



```{r}

FI.pl <- antecedent_HI_FI_1_0  %>%
  ggplot(aes(x = doy, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID)) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("FI") +
  facet_grid(rows=vars(year), cols = vars(response_var)) 
  
FI.pl

```
fDOM: Potentially an out outlier in 2019 POKE
NO3-: Potentially some outliers in 2021 VAUL
SPC: potentially some outliers in 2020 CARI
Turb: Potentially some outliuers in VAUL 2020
Lets check it out:

```{r}
FI_fDOM.2019.pl <- HI_FI_fDOM %>% filter(year == "2019") %>%
  ggplot(aes(x = doy, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("2019 fDOM")
  
FI_fDOM.2019.pl
```
First storm of VAUL and last storm of POKE seem a little sus.

```{r}
FI_NO3.2021.pl <- HI_FI_NO3 %>% filter(year == "2021") %>%
  ggplot(aes(x = doy, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("2021 NO3")
  
FI_NO3.2021.pl
```
First two storms of poker seem a little suspicious 


```{r}
FI_SPC.2020.pl <- HI_FI_SPC %>% filter(year == "2020") %>%
  ggplot(aes(x = doy, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("2020 SPC")
  
FI_SPC.2020.pl
```
Highest Caribou point doesnt look normal

```{r}
FI_turb.2020.pl <- HI_FI_turb %>% filter(year == "2020") %>%
  ggplot(aes(x = doy, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("2020 turb")
  
FI_turb.2020.pl
```
Both negative points for VAUL seem erroneous 

#### Scatter plot matrix ####
``` {r}
NO3_data.1 <- HI_FI_NO3[,c("Flush_index","StormPrecip")]

pairs(NO3_data.1)

HI_FI_NO3 %>% ggplot(aes(x = StormPrecip, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. StormPrecip")

```

``` {r}
NO3_data.2 <- HI_FI_NO3[,c("Flush_index","PrecipWeek")]

pairs(NO3_data.2)

HI_FI_NO3 %>% ggplot(aes(x = PrecipWeek, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. PrecipWeek")

```

``` {r}
NO3_data.3 <- HI_FI_NO3[,c("Flush_index","PrecipMonth")]

pairs(NO3_data.3)

HI_FI_NO3 %>% ggplot(aes(x = PrecipMonth, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. PrecipMonth")

```

``` {r}
NO3_data.4 <- HI_FI_NO3[,c("Flush_index","ThreeMonth")]

pairs(NO3_data.4)

HI_FI_NO3 %>% ggplot(aes(x = ThreeMonth, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. ThreeMonth")

```

``` {r}
NO3_data.5 <- HI_FI_NO3[,c("Flush_index","StormTemp")]

pairs(NO3_data.5)

HI_FI_NO3 %>% ggplot(aes(x = StormTemp, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. StormTemp")

```

``` {r}
NO3_data.6 <- HI_FI_NO3[,c("Flush_index","TempWeek")]

pairs(NO3_data.6)

HI_FI_NO3 %>% ggplot(aes(x = TempWeek, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. TempWeek")

```

``` {r}
NO3_data.7 <- HI_FI_NO3[,c("Flush_index","Intensity")]

pairs(NO3_data.7)

HI_FI_NO3 %>% ggplot(aes(x = Intensity, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. Intensity")

```

``` {r}
NO3_data.8 <- HI_FI_NO3[,c("Flush_index","TimeSinceChena")]

pairs(NO3_data.8)

HI_FI_NO3 %>% ggplot(aes(x = StormPrecip, y = TimeSinceChena)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. TimeSinceChena")

```

``` {r}
NO3_data_FI <- HI_FI_NO3[,c("Flush_index","StormPrecip", "StormTemp", "PrecipWeek", "PrecipMonth", "ThreeMonth", "TempWeek", "Intensity", "TimeSinceChena")]

NO3_data_FI <- na.omit(NO3_data_FI)
cor(NO3_data_FI)

```
1) Storm temperature is correlated with temp week (0.870) but temp week is more correlated with FI (0.191 vs. 0.122)

2) Storm temperature is correlated with TimeSinceChena (-0.771) but storm temp is more correlated with FI (0.122 vs. -0.03)

3) Precip week is correlated with precip month (0.592) but precip week is more correlated with FI (0.163 vs. 0.073)

4) Precip month is correlated with three month (0.587) but precip month is more correlated with FI (0.07 vs. -0.03) 

5) Three month is correlated with TimeSinceChena (0.662) but ThreeMonth is more correlated with FI (-0.0305 vs. -0.0301)



```{r, echo=FALSE}
NO3_data_FI <- HI_FI_NO3[,c("Flush_index","StormPrecip", "StormTemp", "PrecipWeek", "PrecipMonth", "ThreeMonth", "TempWeek", "Intensity", "TimeSinceChena")]

f1.NO3.FI <- formula(Flush_index ~ StormPrecip + PrecipWeek + PrecipMonth + ThreeMonth + Intensity + StormTemp + TempWeek +  TimeSinceChena + (1|site.ID))

M0.NO3.FI <- lmer(f1.NO3.FI, data = HI_FI_NO3)

summary(M0.NO3.FI)

```
1) Scaled residuals look appropriate

2) Site explains 0 of the variance

3) Precip week and TimeSinceChena are the most significant 

```{r, echo=FALSE}
plot(M0.NO3.FI)
```

```{r, echo=FALSE}
qqnorm(resid(M0.NO3.FI))
```

```{r, echo=FALSE}
f2.NO3.FI <- formula(Flush_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + TempWeek +  TimeSinceChena + (1|site.ID))

M1.NO3.FI <- lmer(f2.NO3.FI, data = HI_FI_NO3)

summary(M1.NO3.FI)

```


```{r}
aictab(list(M0.NO3.FI, M1.NO3.FI))

```

#########################################################################################################
######################################### fDOM ##########################################################
#########################################################################################################


#### Scatter plot matrix ####
``` {r}
fDOM_data.1 <- HI_FI_fDOM[,c("Flush_index","StormPrecip")]

pairs(fDOM_data.1)

HI_FI_fDOM %>% ggplot(aes(x = StormPrecip, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. StormPrecip")

```

``` {r}
fDOM_data.2 <- HI_FI_fDOM[,c("Flush_index","PrecipWeek")]

pairs(fDOM_data.1)

HI_FI_fDOM %>% ggplot(aes(x = PrecipWeek, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. PrecipWeek")

```

``` {r}
fDOM_data.1 <- HI_FI_fDOM[,c("Flush_index","PrecipMonth")]

pairs(fDOM_data.1)

HI_FI_fDOM %>% ggplot(aes(x = PrecipMonth, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. PrecipMonth")

```

``` {r}
fDOM_data.1 <- HI_FI_fDOM[,c("Flush_index","ThreeMonth")]

pairs(fDOM_data.1)

HI_FI_fDOM %>% ggplot(aes(x = ThreeMonth, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. ThreeMonth")

```

``` {r}
fDOM_data.1 <- HI_FI_fDOM[,c("Flush_index","StormTemp")]

pairs(fDOM_data.1)

HI_FI_fDOM %>% ggplot(aes(x = StormTemp, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. StormTemp")

```

``` {r}
fDOM_data.1 <- HI_FI_fDOM[,c("Flush_index","TempWeek")]

pairs(fDOM_data.1)

HI_FI_fDOM %>% ggplot(aes(x = TempWeek, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. TempWeek")

```

``` {r}
fDOM_data.1 <- HI_FI_fDOM[,c("Flush_index","Intensity")]

pairs(fDOM_data.1)

HI_FI_fDOM %>% ggplot(aes(x = Intensity, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. Intensity")

```

``` {r}
fDOM_data.1 <- HI_FI_fDOM[,c("Flush_index","TimeSinceChena")]

pairs(fDOM_data.1)

HI_FI_fDOM %>% ggplot(aes(x = StormPrecip, y = TimeSinceChena)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. TimeSinceChena")

```


``` {r}
fDOM_data_FI <- HI_FI_fDOM[,c("Flush_index","StormPrecip", "StormTemp", "PrecipWeek", "PrecipMonth", "ThreeMonth", "TempWeek", "Intensity", "TimeSinceChena")]

fDOM_data_FI <- na.omit(fDOM_data_FI)
cor(fDOM_data_FI)

```
1) Storm temperature is correlated with temp week (0.728) but temp week is more correlated with FI (0.02 vs. -0.09)

2) Storm temperature is correlated with TimeSinceChena (-0.679) but TSC is more correlated with FI (-0.123 vs. 0.02)

3) Precip week is correlated with precip month (0.609) but precip week is more correlated with FI (-0.218 vs. -0.2009)

4) Precip month is correlated with three month (0.698) but ThreeMonth is more correlated with FI (-0.264 vs. -0.200) 

5) Three month is correlated with TimeSinceChena (0.579) but ThreeMonth is more correlated with FI (-0.264 vs. -0.123)

```{r, echo=FALSE}
f1.fDOM_FI <- formula(Flush_index ~ StormPrecip + PrecipWeek + PrecipMonth + ThreeMonth + Intensity + StormTemp + TempWeek +  TimeSinceChena + (1|site.ID))

M0.fDOM_FI <- lmer(f1.fDOM_FI, data = HI_FI_fDOM)

summary(M0.fDOM_FI)

```
1)Scaled residuals look ok

2) Site explains slightly more variation 

3) Precip week is most significant
```{r, echo=FALSE}
plot(M0.fDOM_FI)
```

```{r, echo=FALSE}
qqnorm(resid(M0.fDOM_FI))
```

```{r, echo=FALSE}
f2.fDOM_FI <- formula(Flush_index ~ StormPrecip + PrecipWeek + ThreeMonth + Intensity + TempWeek +  TimeSinceChena + (1|site.ID))

M1.fDOM_FI <- lmer(f2.fDOM_FI, data = HI_FI_fDOM)

summary(M1.fDOM_FI)

```


```{r}
aictab(list(M0.fDOM_FI, M1.fDOM_FI))

```


#########################################################################################################
######################################### SPC ##########################################################
#########################################################################################################


#### Scatter plot matrix ####
``` {r}
SPC_data.1 <- HI_FI_SPC[,c("Flush_index","StormPrecip")]

pairs(SPC_data.1)

HI_FI_SPC %>% ggplot(aes(x = StormPrecip, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. StormPrecip")

```

``` {r}
SPC_data.2 <- HI_FI_SPC[,c("Flush_index","PrecipWeek")]

pairs(SPC_data.1)

HI_FI_SPC %>% ggplot(aes(x = PrecipWeek, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. PrecipWeek")

```

``` {r}
SPC_data.1 <- HI_FI_SPC[,c("Flush_index","PrecipMonth")]

pairs(SPC_data.1)

HI_FI_SPC %>% ggplot(aes(x = PrecipMonth, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. PrecipMonth")

```

``` {r}
SPC_data.1 <- HI_FI_SPC[,c("Flush_index","ThreeMonth")]

pairs(SPC_data.1)

HI_FI_SPC %>% ggplot(aes(x = ThreeMonth, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. ThreeMonth")

```

``` {r}
SPC_data.1 <- HI_FI_SPC[,c("Flush_index","StormTemp")]

pairs(SPC_data.1)

HI_FI_SPC %>% ggplot(aes(x = StormTemp, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. StormTemp")

```

``` {r}
SPC_data.1 <- HI_FI_SPC[,c("Flush_index","TempWeek")]

pairs(SPC_data.1)

HI_FI_SPC %>% ggplot(aes(x = TempWeek, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. TempWeek")

```

``` {r}
SPC_data.1 <- HI_FI_SPC[,c("Flush_index","Intensity")]

pairs(SPC_data.1)

HI_FI_SPC %>% ggplot(aes(x = Intensity, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. Intensity")

```

``` {r}
SPC_data.1 <- HI_FI_SPC[,c("Flush_index","TimeSinceChena")]

pairs(SPC_data.1)

HI_FI_SPC %>% ggplot(aes(x = StormPrecip, y = TimeSinceChena)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. TimeSinceChena")

```


``` {r}
SPC_data_FI <- HI_FI_SPC[,c("Flush_index","StormPrecip", "StormTemp", "PrecipWeek", "PrecipMonth", "ThreeMonth", "TempWeek", "Intensity", "TimeSinceChena")]

SPC_data_FI <- na.omit(SPC_data_FI)
cor(SPC_data_FI)

```
1) Storm temperature is correlated with temp week (0.8209) but temp week is more correlated with FI (-0.02 vs. 0.019)

2) Storm temperature is correlated with TimeSinceChena (-0.703) but TSC is more correlated with FI (-0.026 vs. 0.019)

3) Precip week is correlated with precip month (0.609) but precip month is more correlated with FI (0.195 vs. 0.167)

4) Precip month is correlated with three month (0.670) but PrecipMonth is more correlated with FI (0.19 vs. -0.002) 

5) Three month is correlated with TimeSinceChena (0.563) but TSC is more correlated with FI (-0.02 vs. -0.002)
```{r, echo=FALSE}
f1.SPC_FI <- formula(Flush_index ~ StormPrecip + PrecipWeek + PrecipMonth + ThreeMonth + Intensity + StormTemp + TempWeek +  TimeSinceChena + (1|site.ID))

M0.SPC_FI <- lmer(f1.SPC_FI, data = HI_FI_SPC)

summary(M0.SPC_FI)

```
1) Scaled resiudals aren't great

2) Site explains 0 variance

3) Precip month is most significant


```{r, echo=FALSE}
plot(M0.SPC_FI)
```

```{r, echo=FALSE}
qqnorm(resid(M0.SPC_FI))
```
Not very good 

```{r, echo=FALSE}
f2.SPC_FI <- formula(Flush_index ~ StormPrecip + PrecipWeek + PrecipMonth  + Intensity + TempWeek +  TimeSinceChena + (1|site.ID))

M1.SPC_FI <- lmer(f2.SPC_FI, data = HI_FI_SPC)

summary(M1.SPC_FI)

```


```{r}
aictab(list(M0.SPC_FI, M1.SPC_FI))

```


#########################################################################################################
######################################### turb ##########################################################
#########################################################################################################


#### Scatter plot matrix ####
``` {r}
turb_data.1 <- HI_FI_turb[,c("Flush_index","StormPrecip")]

pairs(turb_data.1)

HI_FI_turb %>% ggplot(aes(x = StormPrecip, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. StormPrecip")

```

``` {r}
turb_data.2 <- HI_FI_turb[,c("Flush_index","PrecipWeek")]

pairs(turb_data.1)

HI_FI_turb %>% ggplot(aes(x = PrecipWeek, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. PrecipWeek")

```

``` {r}
turb_data.1 <- HI_FI_turb[,c("Flush_index","PrecipMonth")]

pairs(turb_data.1)

HI_FI_turb %>% ggplot(aes(x = PrecipMonth, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. PrecipMonth")

```

``` {r}
turb_data.1 <- HI_FI_turb[,c("Flush_index","ThreeMonth")]

pairs(turb_data.1)

HI_FI_turb %>% ggplot(aes(x = ThreeMonth, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. ThreeMonth")

```

``` {r}
turb_data.1 <- HI_FI_turb[,c("Flush_index","StormTemp")]

pairs(turb_data.1)

HI_FI_turb %>% ggplot(aes(x = StormTemp, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. StormTemp")

```

``` {r}
turb_data.1 <- HI_FI_turb[,c("Flush_index","TempWeek")]

pairs(turb_data.1)

HI_FI_turb %>% ggplot(aes(x = TempWeek, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. TempWeek")

```

``` {r}
turb_data.1 <- HI_FI_NO3[,c("Flush_index","Intensity")]

pairs(turb_data.1)

HI_FI_turb %>% ggplot(aes(x = Intensity, y = Flush_index)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. Intensity")

```

``` {r}
turb_data.1 <- HI_FI_turb[,c("Flush_index","TimeSinceChena")]

pairs(turb_data.1)

HI_FI_turb %>% ggplot(aes(x = StormPrecip, y = TimeSinceChena)) + 
  geom_hline(yintercept = 0, linetype = "dotted", size = 1) +
  geom_errorbar(aes(ymin=FI_ymin, ymax=FI_ymax), colour="black", alpha=0.5, size=.5, width = 0.1)+ 
  geom_point(aes(color = site.ID), size = 2) +
  scale_color_manual(values = c("orange red", viridis::viridis(6)),
                     labels = c("French", "Moose", "Poker", "Vault", "Stuart", "Caribou")) +
  ylab("Flushing Index") +
  ggtitle("HI vs. TimeSinceChena")

```


``` {r}
turb_data_FI <- HI_FI_turb[,c("Flush_index","StormPrecip", "StormTemp", "PrecipWeek", "PrecipMonth", "ThreeMonth", "TempWeek", "Intensity", "TimeSinceChena")]

turb_data_FI <- na.omit(turb_data_FI)
cor(turb_data_FI)

```


1) Storm temperature is correlated with temp week (0.7605) but StormTemp is more correlated with FI (0.03 vs. -0.0089)

2) Storm temperature is correlated with TimeSinceChena (-0.74) but TSC is more correlated with FI (-0.05 vs. 0.03)

3) Precip week is correlated with precip month (0.616) but precip month is more correlated with FI (-0.07 vs. 0.01)

4) Precip month is correlated with three month (0.677) but PrecipMonth is more correlated with FI (-0.07 vs. 0.03) 

5) Three month is correlated with TimeSinceChena (0.562) but TSC is more correlated with FI (-0.05 vs. -0.03)


```{r, echo=FALSE}
f1.turb_FI <- formula(Flush_index ~ StormPrecip + PrecipWeek + PrecipMonth + ThreeMonth + Intensity + StormTemp + TempWeek +  TimeSinceChena + (1|site.ID))

M0.turb_FI <- lmer(f1.turb_FI, data = HI_FI_turb)

summary(M0.turb_FI)

```
1)Scaled residuals look ok

2) Site explains little variance

3)Storm Precip is most significant

```{r, echo=FALSE}
plot(M0.turb_FI)
```
Some funnelling going on here 

```{r, echo=FALSE}
qqnorm(resid(M0.turb_FI))
```

```{r, echo=FALSE}
f2.turb_FI <- formula(Flush_index ~ StormPrecip + PrecipWeek + PrecipMonth + Intensity + StormTemp +  TimeSinceChena + (1|site.ID))

M1.turb_FI <- lmer(f2.turb_FI, data = HI_FI_turb)

summary(M1.turb_FI)

```


```{r}
aictab(list(M0.turb_FI, M1.turb_FI))

```



