CARI_storm2c_06_21_Q<- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm2c_06_21_Q.csv")
CARI_storm2c_06_21_NO3 <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm2c_06_21_NO3.csv")
#CARI_storm2c_06_21_fDOM <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm2c_06_21_fDOM.csv",
#                                    col_types = cols(datavalue = col_double()))
CARI_storm2c_06_21_SPC <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm2c_06_21_SPC.csv")
CARI_storm2c_06_21_turb <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm2c_06_21_Turb.csv")
#CARI_storm3_06_23 <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm3_06_23.csv")
CARI_storm3_06_23_Q<- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm3_06_23_Q.csv")
CARI_storm3_06_23_NO3 <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm3_06_23_NO3.csv")
CARI_storm3_06_23_fDOM <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm3_06_23_fDOM.csv",
col_types = cols(datavalue = col_double()))
CARI_storm3_06_23_SPC <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm3_06_23_SPC.csv")
CARI_storm3_06_23_turb <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm3_06_23_Turb.csv")
#CARI_storm4_07_09 <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm4_07_09.csv")
CARI_storm4_07_09_Q<- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm4_07_09_Q.csv")
CARI_storm4_07_09_NO3 <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm4_07_09_NO3.csv")
CARI_storm4_07_09_fDOM <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm4_07_09_fDOM.csv",
col_types = cols(datavalue = col_double()))
CARI_storm4_07_09_SPC <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm4_07_09_SPC.csv")
CARI_storm4_07_09_turb <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm4_07_09_Turb.csv")
#CARI_storm5_07_13 <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm5_07_13.csv")
CARI_storm5_07_13_Q<- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm5_07_13_Q.csv")
CARI_storm5_07_13_NO3 <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm5_07_13_NO3.csv",
col_types = cols(datavalue = col_double()))
CARI_storm5_07_13_fDOM <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm5_07_13_fDOM.csv",
col_types = cols(datavalue = col_double()))
CARI_storm5_07_13_SPC <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm5_07_13_SPC.csv")
CARI_storm5_07_13_turb <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm5_07_13_Turb.csv")
#CARI_storm6_07_24 <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm6_07_24.csv")
CARI_storm6_07_24_Q<- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm6_07_24_Q.csv")
CARI_storm6_07_24_NO3 <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm6_07_24_NO3.csv",
col_types = cols(datavalue = col_double()))
CARI_storm6_07_24_fDOM <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm6_07_24_fDOM.csv",
col_types = cols(datavalue = col_double()))
CARI_storm6_07_24_SPC <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm6_07_24_SPC.csv")
CARI_storm6_07_24_turb <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm6_07_24_Turb.csv")
#CARI_storm7_07_27 <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm7_07_27.csv")
CARI_storm7_07_27_Q<- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm7_07_27_Q.csv")
CARI_storm7_07_27_NO3 <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm7_07_27_NO3.csv")
CARI_storm7_07_27_fDOM <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm7_07_27_fDOM.csv",
col_types = cols(datavalue = col_double()))
CARI_storm7_07_27_SPC <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm7_07_27_SPC.csv")
CARI_storm7_07_27_turb <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm7_07_27_Turb.csv")
#CARI_storm8a_08_02 <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm8a_08_02.csv")
CARI_storm8a_08_02_Q<- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm8a_08_02_Q.csv")
CARI_storm8a_08_02_NO3 <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm8a_08_02_NO3.csv")
CARI_storm8a_08_02_fDOM <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm8a_08_02_fDOM.csv",
col_types = cols(datavalue = col_double()))
CARI_storm8a_08_02_SPC <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm8a_08_02_SPC.csv")
CARI_storm8a_08_02_turb <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm8a_08_02_Turb.csv")
#CARI_storm8b_08_03 <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm8b_08_03.csv")
CARI_storm8b_08_03_Q<- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm8b_08_03_Q.csv")
CARI_storm8b_08_03_NO3 <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm8b_08_03_NO3.csv")
CARI_storm8b_08_03_fDOM <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm8b_08_03_fDOM.csv",
col_types = cols(datavalue = col_double()))
CARI_storm8b_08_03_SPC <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm8b_08_03_SPC.csv")
CARI_storm8b_08_03_turb <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm8b_08_03_Turb.csv")
#CARI_storm9_09_07 <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm9_09_07.csv")
CARI_storm9_09_07_Q<- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm9_09_07_Q.csv")
CARI_storm9_09_07_NO3 <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm9_09_07_NO3.csv")
CARI_storm9_09_07_fDOM <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm9_09_07_fDOM.csv",
col_types = cols(datavalue = col_double()))
CARI_storm9_09_07_SPC <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm9_09_07_SPC.csv")
CARI_storm9_09_07_turb <- read_csv("~/Documents/Storms/Storm_Events/2020/CARI/CARI_storm9_09_07_Turb.csv")
# normalize data #
dfList <- Filter(function(x) is(x, "data.frame"), mget(ls()))
for(i in 1:length(dfList)) {
dfList[[i]][["datavalue"]] =
(dfList[[i]][["datavalue"]] - min(dfList[[i]][["datavalue"]], na.rm=T)) / (max(dfList[[i]][["datavalue"]], na.rm=T) - min(dfList[[i]][["datavalue"]], na.rm=T))
}
list2env(dfList ,.GlobalEnv)
#### fxn: plot hysteresis loop ####
hyst_plot = function(dat_Q, dat_response, site, response_var, storm_num) {
dat.p = ggplot(data = dat_Q,
aes(x=(dat_Q$datavalue),
y=(dat_response$datavalue),
color = as.numeric(dat_Q$valuedatetime))) +
geom_point() +
scale_colour_gradientn(colors = rainbow(3)) +
theme_bw() +
theme(legend.position="none") +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=14,face="bold")) +
ylab(paste(site, response_var))+
xlab("Normalized Discharge") +
ggtitle(paste("Storm", storm_num))
return(dat.p)
}
CARI_storm2a_06_19_NO3.p = hyst_plot(CARI_storm2a_06_19_Q, CARI_storm2a_06_19_NO3, "CARI", "NO3", "0619a")
CARI_storm2b_06_20_NO3.p = hyst_plot(CARI_storm2b_06_20_Q, CARI_storm2b_06_20_NO3, "CARI", "NO3", "0620b")
CARI_storm2c_06_21_NO3.p = hyst_plot(CARI_storm2c_06_21_Q, CARI_storm2c_06_21_NO3, "CARI", "NO3", "0621c")
CARI_storm3_06_23_NO3.p = hyst_plot(CARI_storm3_06_23_Q, CARI_storm3_06_23_NO3, "CARI", "NO3", "0623")
CARI_storm4_07_09_NO3.p = hyst_plot(CARI_storm4_07_09_Q, CARI_storm4_07_09_NO3, "CARI", "NO3", "0709")
CARI_storm5_07_13_NO3.p = hyst_plot(CARI_storm5_07_13_Q, CARI_storm5_07_13_NO3, "CARI", "NO3", "0713")
CARI_storm6_07_24_NO3.p = hyst_plot(CARI_storm6_07_24_Q, CARI_storm6_07_24_NO3, "CARI", "NO3", "0724")
CARI_storm7_07_27_NO3.p = hyst_plot(CARI_storm7_07_27_Q, CARI_storm7_07_27_NO3, "CARI", "NO3", "0727")
CARI_storm8a_08_02_NO3.p = hyst_plot(CARI_storm8a_08_02_Q, CARI_storm8a_08_02_NO3, "CARI", "NO3", "0802a")
CARI_storm8b_08_03_NO3.p = hyst_plot(CARI_storm8b_08_03_Q, CARI_storm8b_08_03_NO3, "CARI", "NO3", "0803b")
CARI_storm9_09_07_NO3.p = hyst_plot(CARI_storm9_09_07_Q, CARI_storm9_09_07_NO3, "CARI", "NO3", "0907")
#fDOM#
#CARI_storm1_06_15_fDOM.p = hyst_plot(CARI_storm1_06_15_Q, CARI_storm1_06_15_fDOM, "CARI", "fDOM", "0615")
CARI_storm2a_06_19_fDOM.p = hyst_plot(CARI_storm2a_06_19_Q, CARI_storm2a_06_19_fDOM, "CARI", "fDOM", "0619a")
CARI_storm2b_06_20_fDOM.p = hyst_plot(CARI_storm2b_06_20_Q, CARI_storm2b_06_20_fDOM, "CARI", "fDOM", "0620b")
CARI_storm2c_06_21_fDOM.p = hyst_plot(CARI_storm2c_06_21_Q, CARI_storm2c_06_21_fDOM, "CARI", "fDOM", "0621c")
CARI_storm3_06_23_fDOM.p = hyst_plot(CARI_storm3_06_23_Q, CARI_storm3_06_23_fDOM, "CARI", "fDOM", "0623")
CARI_storm4_07_09_fDOM.p = hyst_plot(CARI_storm4_07_09_Q, CARI_storm4_07_09_fDOM, "CARI", "fDOM", "0709")
CARI_storm5_07_13_fDOM.p = hyst_plot(CARI_storm5_07_13_Q, CARI_storm5_07_13_fDOM, "CARI", "fDOM", "0713")
CARI_storm6_07_24_fDOM.p = hyst_plot(CARI_storm6_07_24_Q, CARI_storm6_07_24_fDOM, "CARI", "fDOM", "0724")
CARI_storm7_07_27_fDOM.p = hyst_plot(CARI_storm7_07_27_Q, CARI_storm7_07_27_fDOM, "CARI", "fDOM", "0727")
CARI_storm8a_08_02_fDOM.p = hyst_plot(CARI_storm8a_08_02_Q, CARI_storm8a_08_02_fDOM, "CARI", "fDOM", "0802a")
CARI_storm8b_08_03_fDOM.p = hyst_plot(CARI_storm8b_08_03_Q, CARI_storm8b_08_03_fDOM, "CARI", "fDOM", "0803b")
CARI_storm9_09_07_fDOM.p = hyst_plot(CARI_storm9_09_07_Q, CARI_storm9_09_07_fDOM, "CARI", "fDOM", "0907")
#SPC #
CARI_storm1_06_15_SPC <- na.omit(CARI_storm1_06_15_SPC)
CARI_storm1_06_15_SPC <- CARI_storm1_06_15_SPC[!duplicated(CARI_storm1_06_15_SPC$valuedatetime), ]
CARI_storm2a_06_19_Q <- CARI_storm2a_06_19_Q[!duplicated(CARI_storm2a_06_19_Q$valuedatetime), ]
CARI_storm2a_06_19_SPC <- CARI_storm2a_06_19_SPC[!duplicated(CARI_storm2a_06_19_SPC$valuedatetime), ]
CARI_storm2b_06_20_Q <- CARI_storm2b_06_20_Q[!duplicated(CARI_storm2b_06_20_Q$valuedatetime), ]
CARI_storm2b_06_20_SPC <- CARI_storm2b_06_20_SPC[!duplicated(CARI_storm2b_06_20_SPC$valuedatetime), ]
CARI_storm3_06_23_Q <- CARI_storm3_06_23_Q[!duplicated(CARI_storm3_06_23_Q$valuedatetime), ]
CARI_storm3_06_23_SPC <- CARI_storm3_06_23_SPC[!duplicated(CARI_storm3_06_23_SPC$valuedatetime), ]
CARI_storm4_07_09_Q <- CARI_storm4_07_09_Q[!duplicated(CARI_storm4_07_09_Q$valuedatetime), ]
CARI_storm4_07_09_SPC <- CARI_storm4_07_09_SPC[!duplicated(CARI_storm4_07_09_SPC$valuedatetime), ]
CARI_storm5_07_13_Q <- CARI_storm5_07_13_Q[!duplicated(CARI_storm5_07_13_Q$valuedatetime), ]
CARI_storm5_07_13_SPC <- CARI_storm5_07_13_SPC[!duplicated(CARI_storm5_07_13_SPC$valuedatetime), ]
CARI_storm6_07_24_Q <- CARI_storm6_07_24_Q[!duplicated(CARI_storm6_07_24_Q$valuedatetime), ]
CARI_storm6_07_24_SPC <- CARI_storm6_07_24_SPC[!duplicated(CARI_storm6_07_24_SPC$valuedatetime), ]
CARI_storm7_07_27_Q <- CARI_storm7_07_27_Q[!duplicated(CARI_storm7_07_27_Q$valuedatetime), ]
CARI_storm7_07_27_SPC <- CARI_storm7_07_27_SPC[!duplicated(CARI_storm7_07_27_SPC$valuedatetime), ]
CARI_storm8a_08_02_Q <- CARI_storm8a_08_02_Q[!duplicated(CARI_storm8a_08_02_Q$valuedatetime), ]
CARI_storm8a_08_02_SPC <- CARI_storm8a_08_02_SPC[!duplicated(CARI_storm8a_08_02_SPC$valuedatetime), ]
CARI_storm8b_08_03_Q <- CARI_storm8b_08_03_Q[!duplicated(CARI_storm8b_08_03_Q$valuedatetime), ]
CARI_storm8b_08_03_SPC <- CARI_storm8b_08_03_SPC[!duplicated(CARI_storm8b_08_03_SPC$valuedatetime), ]
CARI_storm9_09_07_Q <- CARI_storm9_09_07_Q[!duplicated(CARI_storm9_09_07_Q$valuedatetime), ]
CARI_storm9_09_07_SPC <- CARI_storm9_09_07_SPC[!duplicated(CARI_storm9_09_07_SPC$valuedatetime), ]
#CARI_storm1_06_15_SPC.p = hyst_plot(CARI_storm1_06_15_Q, CARI_storm1_06_15_SPC, "CARI", "SPC", "0615")
CARI_storm2a_06_19_SPC.p = hyst_plot(CARI_storm2a_06_19_Q, CARI_storm2a_06_19_SPC, "CARI", "SPC", "0619a")
CARI_storm2b_06_20_SPC.p = hyst_plot(CARI_storm2b_06_20_Q, CARI_storm2b_06_20_SPC, "CARI", "SPC", "0620b")
CARI_storm2c_06_21_SPC.p = hyst_plot(CARI_storm2c_06_21_Q, CARI_storm2c_06_21_SPC, "CARI", "SPC", "0621c")
CARI_storm3_06_23_SPC.p = hyst_plot(CARI_storm3_06_23_Q, CARI_storm3_06_23_SPC, "CARI", "SPC", "0623")
CARI_storm4_07_09_SPC.p = hyst_plot(CARI_storm4_07_09_Q, CARI_storm4_07_09_SPC, "CARI", "SPC", "0709")
CARI_storm5_07_13_SPC.p = hyst_plot(CARI_storm5_07_13_Q, CARI_storm5_07_13_SPC, "CARI", "SPC", "0713")
CARI_storm6_07_24_SPC.p = hyst_plot(CARI_storm6_07_24_Q, CARI_storm6_07_24_SPC, "CARI", "SPC", "0724")
CARI_storm7_07_27_SPC.p = hyst_plot(CARI_storm7_07_27_Q, CARI_storm7_07_27_SPC, "CARI", "SPC", "0727")
CARI_storm8a_08_02_SPC.p = hyst_plot(CARI_storm8a_08_02_Q, CARI_storm8a_08_02_SPC, "CARI", "SPC", "0802a")
CARI_storm8b_08_03_SPC.p = hyst_plot(CARI_storm8b_08_03_Q, CARI_storm8b_08_03_SPC, "CARI", "SPC", "0803b")
CARI_storm9_09_07_SPC.p = hyst_plot(CARI_storm9_09_07_Q, CARI_storm9_09_07_SPC, "CARI", "SPC", "0907")
#turb #
#CARI_storm2a_06_19_turb <- CARI_storm2a_06_19_turb[!duplicated(CARI_storm2a_06_19_turb$valuedatetime), ]
CARI_storm2b_06_20_turb <- CARI_storm2b_06_20_turb[!duplicated(CARI_storm2b_06_20_turb$valuedatetime), ]
CARI_storm3_06_23_turb <- CARI_storm3_06_23_turb[!duplicated(CARI_storm3_06_23_turb$valuedatetime), ]
CARI_storm4_07_09_turb <- CARI_storm4_07_09_turb[!duplicated(CARI_storm4_07_09_turb$valuedatetime), ]
CARI_storm5_07_13_turb <- CARI_storm5_07_13_turb[!duplicated(CARI_storm5_07_13_turb$valuedatetime), ]
CARI_storm6_07_24_turb <- CARI_storm6_07_24_turb[!duplicated(CARI_storm6_07_24_turb$valuedatetime), ]
CARI_storm7_07_27_turb <- CARI_storm7_07_27_turb[!duplicated(CARI_storm7_07_27_turb$valuedatetime), ]
CARI_storm8a_08_02_turb <- CARI_storm8a_08_02_turb[!duplicated(CARI_storm8a_08_02_turb$valuedatetime), ]
CARI_storm8b_08_03_turb <- CARI_storm8b_08_03_turb[!duplicated(CARI_storm8b_08_03_turb$valuedatetime), ]
CARI_storm9_09_07_turb <- CARI_storm9_09_07_turb[!duplicated(CARI_storm9_09_07_turb$valuedatetime), ]
#CARI_storm1_06_15_turb.p = hyst_plot(CARI_storm1_06_15_Q, CARI_storm1_06_15_turb, "CARI", "turb", "0615")
CARI_storm2a_06_19_turb.p = hyst_plot(CARI_storm2a_06_19_Q, CARI_storm2a_06_19_turb, "CARI", "turb", "0619a")
CARI_storm2b_06_20_turb.p = hyst_plot(CARI_storm2b_06_20_Q, CARI_storm2b_06_20_turb, "CARI", "turb", "0620b")
CARI_storm2c_06_21_turb.p = hyst_plot(CARI_storm2c_06_21_Q, CARI_storm2c_06_21_turb, "CARI", "turb", "0621c")
CARI_storm3_06_23_turb.p = hyst_plot(CARI_storm3_06_23_Q, CARI_storm3_06_23_turb, "CARI", "turb", "0623")
CARI_storm4_07_09_turb.p = hyst_plot(CARI_storm4_07_09_Q, CARI_storm4_07_09_turb, "CARI", "turb", "0709")
CARI_storm5_07_13_turb.p = hyst_plot(CARI_storm5_07_13_Q, CARI_storm5_07_13_turb, "CARI", "turb", "0713")
CARI_storm6_07_24_turb.p = hyst_plot(CARI_storm6_07_24_Q, CARI_storm6_07_24_turb, "CARI", "turb", "0724")
CARI_storm7_07_27_turb.p = hyst_plot(CARI_storm7_07_27_Q, CARI_storm7_07_27_turb, "CARI", "turb", "0727")
CARI_storm8a_08_02_turb.p = hyst_plot(CARI_storm8a_08_02_Q, CARI_storm8a_08_02_turb, "CARI", "turb", "0802a")
CARI_storm8b_08_03_turb.p = hyst_plot(CARI_storm8b_08_03_Q, CARI_storm8b_08_03_turb, "CARI", "turb", "0803b")
CARI_storm9_09_07_turb.p = hyst_plot(CARI_storm9_09_07_Q, CARI_storm9_09_07_turb, "CARI", "turb", "0907")
multiplot(
CARI_storm2a_06_19_NO3.p,CARI_storm2a_06_19_fDOM.p,CARI_storm2a_06_19_SPC.p,CARI_storm2a_06_19_turb.p,
CARI_storm2b_06_20_NO3.p,CARI_storm2b_06_20_fDOM.p,CARI_storm2b_06_20_SPC.p,CARI_storm2b_06_20_turb.p,
CARI_storm2c_06_21_NO3.p,
CARI_storm3_06_23_NO3.p,CARI_storm3_06_23_fDOM.p,CARI_storm3_06_23_SPC.p,CARI_storm3_06_23_turb.p,
CARI_storm4_07_09_NO3.p,CARI_storm4_07_09_fDOM.p,CARI_storm4_07_09_SPC.p,CARI_storm4_07_09_turb.p,
CARI_storm5_07_13_NO3.p,CARI_storm5_07_13_fDOM.p,CARI_storm5_07_13_SPC.p,CARI_storm5_07_13_turb.p,
CARI_storm6_07_24_NO3.p,CARI_storm6_07_24_fDOM.p,CARI_storm6_07_24_SPC.p,CARI_storm6_07_24_turb.p,
CARI_storm7_07_27_NO3.p,CARI_storm7_07_27_fDOM.p,CARI_storm7_07_27_SPC.p,CARI_storm7_07_27_turb.p,
CARI_storm8a_08_02_NO3.p,CARI_storm8a_08_02_fDOM.p,CARI_storm8a_08_02_SPC.p,CARI_storm8a_08_02_turb.p,
CARI_storm8b_08_03_NO3.p,CARI_storm8b_08_03_fDOM.p,CARI_storm8b_08_03_SPC.p,CARI_storm8b_08_03_turb.p,
CARI_storm9_09_07_NO3.p,CARI_storm9_09_07_fDOM.p,CARI_storm9_09_07_SPC.p,CARI_storm9_09_07_turb.p,
cols = 7)
multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
library(grid)
# Make a list from the ... arguments and plotlist
plots <- c(list(...), plotlist)
numPlots = length(plots)
# If layout is NULL, then use 'cols' to determine layout
if (is.null(layout)) {
# Make the panel
# ncol: Number of columns of plots
# nrow: Number of rows needed, calculated from # of cols
layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
ncol = cols, nrow = ceiling(numPlots/cols))
}
if (numPlots==1) {
print(plots[[1]])
} else {
# Set up the page
grid.newpage()
pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))
# Make each plot, in the correct location
for (i in 1:numPlots) {
# Get the i,j matrix positions of the regions that contain this subplot
matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))
print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
layout.pos.col = matchidx$col))
}
}
}
multiplot(
CARI_storm2a_06_19_NO3.p,CARI_storm2a_06_19_fDOM.p,CARI_storm2a_06_19_SPC.p,CARI_storm2a_06_19_turb.p,
CARI_storm2b_06_20_NO3.p,CARI_storm2b_06_20_fDOM.p,CARI_storm2b_06_20_SPC.p,CARI_storm2b_06_20_turb.p,
CARI_storm2c_06_21_NO3.p,
CARI_storm3_06_23_NO3.p,CARI_storm3_06_23_fDOM.p,CARI_storm3_06_23_SPC.p,CARI_storm3_06_23_turb.p,
CARI_storm4_07_09_NO3.p,CARI_storm4_07_09_fDOM.p,CARI_storm4_07_09_SPC.p,CARI_storm4_07_09_turb.p,
CARI_storm5_07_13_NO3.p,CARI_storm5_07_13_fDOM.p,CARI_storm5_07_13_SPC.p,CARI_storm5_07_13_turb.p,
CARI_storm6_07_24_NO3.p,CARI_storm6_07_24_fDOM.p,CARI_storm6_07_24_SPC.p,CARI_storm6_07_24_turb.p,
CARI_storm7_07_27_NO3.p,CARI_storm7_07_27_fDOM.p,CARI_storm7_07_27_SPC.p,CARI_storm7_07_27_turb.p,
CARI_storm8a_08_02_NO3.p,CARI_storm8a_08_02_fDOM.p,CARI_storm8a_08_02_SPC.p,CARI_storm8a_08_02_turb.p,
CARI_storm8b_08_03_NO3.p,CARI_storm8b_08_03_fDOM.p,CARI_storm8b_08_03_SPC.p,CARI_storm8b_08_03_turb.p,
CARI_storm9_09_07_NO3.p,CARI_storm9_09_07_fDOM.p,CARI_storm9_09_07_SPC.p,CARI_storm9_09_07_turb.p,
cols = 7)
setwd("~/Documents/Storms_clean_repo")
knitr::opts_chunk$set(echo = TRUE)
library(reticulate)
Sys.which("python")
use_python("/usr/bin/python")
library(tidyverse)
options(tz="America/Anchorage")
library(ggplot2)
library(gridExtra)
library(boot)
setwd("~/Documents/Storms_clean_repo")
knitr::opts_chunk$set(echo = TRUE)
library(reticulate)
Sys.which("python")
use_python("/usr/bin/python")
library(tidyverse)
options(tz="America/Anchorage")
library(ggplot2)
library(gridExtra)
library(boot)
reticulate::repl_python()
CARI.hyst.results.list = list(py$hysdict_CARI_storm1_05_08_NO3,
py$hysdict_CARI_storm1_05_08_fDOM,
py$hysdict_CARI_storm1_05_08_SPC,
py$hysdict_CARI_storm1_05_08_turb,
py$hysdict_CARI_storm2_06_30_NO3,
py$hysdict_CARI_storm2_06_30_fDOM,
py$hysdict_CARI_storm2_06_30_SPC,
py$hysdict_CARI_storm2_06_30_turb,
py$hysdict_CARI_storm3_07_12_NO3,
py$hysdict_CARI_storm3_07_12_fDOM,
py$hysdict_CARI_storm3_07_12_SPC,
py$hysdict_CARI_storm3_07_12_turb,
py$hysdict_CARI_storm5_07_31_NO3,
py$hysdict_CARI_storm5_07_31_fDOM,
py$hysdict_CARI_storm5_07_31_SPC,
py$hysdict_CARI_storm5_07_31_turb,
py$hysdict_CARI_storm6a_08_02_NO3,
py$hysdict_CARI_storm6a_08_02_fDOM,
py$hysdict_CARI_storm6a_08_02_SPC,
py$hysdict_CARI_storm6a_08_02_turb,
py$hysdict_CARI_storm6b_08_03_NO3,
py$hysdict_CARI_storm6b_08_03_fDOM,
py$hysdict_CARI_storm6b_08_03_SPC,
py$hysdict_CARI_storm6b_08_03_turb,
py$hysdict_CARI_storm6c_08_05_NO3,
py$hysdict_CARI_storm6c_08_05_fDOM,
py$hysdict_CARI_storm6c_08_05_SPC,
py$hysdict_CARI_storm6c_08_05_turb,
py$hysdict_CARI_storm6d_08_10_NO3,
py$hysdict_CARI_storm6d_08_10_fDOM,
py$hysdict_CARI_storm6d_08_10_SPC,
py$hysdict_CARI_storm6d_08_10_turb,
py$hysdict_CARI_storm7b_08_13_NO3,
py$hysdict_CARI_storm7b_08_13_fDOM,
py$hysdict_CARI_storm7b_08_13_SPC,
py$hysdict_CARI_storm7b_08_13_turb,
py$hysdict_CARI_storm8_08_16_NO3,
py$hysdict_CARI_storm8_08_16_fDOM,
py$hysdict_CARI_storm8_08_16_SPC,
py$hysdict_CARI_storm8_08_16_turb)
CARI.hyst.results.list.2 = list()
for (i in 1:length(CARI.hyst.results.list)){
CARI.hyst.results.list.2[[i]] = as.data.frame(t(as.numeric(c(
CARI.hyst.results.list[[i]][["HI_mean_with_Interp"]],
CARI.hyst.results.list[[i]][["HI_standard_deviation_with_Interp"]],
CARI.hyst.results.list[[i]][["Normalized slope of response"]],
CARI.hyst.results.list[[i]][["interpolated Max width of response"]],
CARI.hyst.results.list[[i]][["Min response"]],
CARI.hyst.results.list[[i]][["Max response"]],
CARI.hyst.results.list[[i]][["Peak Q"]]
))))
names(CARI.hyst.results.list.2[[i]]) = c("HI_mean_Interp", "HI_sd_with_Interp", "N.S.", "Max_width_Interp", "Min_response", "Max_response", "Peak_Q")
}
HIs.list = list()
HIs.tests = list()
for (i in 1:length(CARI.hyst.results.list)){
HIs.list[[i]] = unlist(CARI.hyst.results.list[[i]][["Hysteresis_Index"]],recursive=FALSE)
HIs.tests[[i]] = as.data.frame(t(round(as.numeric(c(shapiro.test(HIs.list[[i]])$statistic, shapiro.test(HIs.list[[i]])$p.value,
t.test(HIs.list[[i]], mu=0)$statistic, t.test(HIs.list[[i]], mu=0)$p.value,
t.test(HIs.list[[i]], mu=0)$conf.int[1],t.test(HIs.list[[i]], mu=0)$conf.int[2],
wilcox.test(HIs.list[[i]], mu=0)$statistic, wilcox.test(HIs.list[[i]], mu=0)$p.value)), 4)))
names(HIs.tests[[i]]) = c("ShapiroTest.W", "ShapiroTest.p", "t.test.stat", "t.test.p", "t.test.CIlow", "t.test.CIhigh",
"wilcox.test.stat", "wilcox.test.p")
}
CARI.hyst.results.list.3 =list()
for (i in 1:length(CARI.hyst.results.list)){
CARI.hyst.results.list.3[[i]] = cbind(CARI.hyst.results.list.2[[i]], HIs.tests[[i]])
}
CARI.hyst.results.df = bind_rows(CARI.hyst.results.list.3, .id = "column_label")
CARI.hyst.results.df$storm.ID = c("CARI_storm1_05_08_NO3",
"CARI_storm1_05_08_fDOM",
"CARI_storm1_05_08_SPC",
"CARI_storm1_05_08_turb",
"CARI_storm2_06_30_NO3",
"CARI_storm2_06_30_fDOM",
"CARI_storm2_06_30_SPC",
"CARI_storm2_06_30_turb",
"CARI_storm3_07_12_NO3",
"CARI_storm3_07_12_fDOM",
"CARI_storm3_07_12_SPC",
"CARI_storm3_07_12_turb",
"CARI_storm5_07_31_NO3",
"CARI_storm5_07_31_fDOM",
"CARI_storm5_07_31_SPC",
"CARI_storm5_07_31_turb",
"CARI_storm6a_08_02_NO3",
"CARI_storm6a_08_02_fDOM",
"CARI_storm6a_08_02_SPC",
"CARI_storm6a_08_02_turb",
"CARI_storm6b_08_03_NO3",
"CARI_storm6b_08_03_fDOM",
"CARI_storm6b_08_03_SPC",
"CARI_storm6b_08_03_turb",
"CARI_storm6c_08_05_NO3",
"CARI_storm6c_08_05_fDOM",
"CARI_storm6c_08_05_SPC",
"CARI_storm6c_08_05_turb",
"CARI_storm6d_08_10_NO3",
"CARI_storm6d_08_10_fDOM",
"CARI_storm6d_08_10_SPC",
"CARI_storm6d_08_10_turb",
"CARI_storm7b_08_13_NO3",
"CARI_storm7b_08_13_fDOM",
"CARI_storm7b_08_13_SPC",
"CARI_storm7b_08_13_turb",
"CARI_storm8_08_16_NO3",
"CARI_storm8_08_16_fDOM",
"CARI_storm8_08_16_SPC",
"CARI_storm8_08_16_turb")
CARI.hyst.results.df$site.ID = "CARI"
write.csv(CARI.hyst.results.df, "~/Documents/Storms_clean_repo/Output_from_analysis/03_HI_FI/2019/CARI/CARI.hyst.results.csv")
# plot HI by normalized discharge
HIs.Q.list =list()
HIs.df.list = list()
#pdf("~/Documents/Storms/Output_from_analysis/HI_plots/2019/CARI/CARI.hyst.HI_Q.plots.pdf", width = 25, height =15, onefile=FALSE)
par(mfrow=c(4,7))
for (i in 1:length(HIs.list)) {
HIs.Q.list[[i]] = names(HIs.list[[i]])
HIs.Q.list[[i]] = (sapply(strsplit(HIs.Q.list[[i]], " "), "[[", 4))
HIs.Q.list[[i]] = as.numeric(gsub("%", "", HIs.Q.list[[i]]))
HIs.df.list[[i]] = as.data.frame(cbind(HIs.list[[i]], HIs.Q.list[[i]]))
HIs.df.list[[i]]= HIs.df.list[[i]][order(HIs.df.list[[i]][["V2"]]),]
plot(HIs.df.list[[i]][["V1"]] ~ HIs.df.list[[i]][["V2"]], type="l",
ylab="norm.response", xlab="Q intervals", main= CARI.hyst.results.df$storm.ID[i])
abline(h=0, lty=2)
}
dev.off()
## plot HI with bootstrapped 95% CIs around the median ##
HIs.Q.list =list()
HIs.df.list = list()
par(mfrow=c(1,1))
for (i in 1:length(HIs.list)) {
HIs.Q.list[[i]] = names(HIs.list[[i]])
HIs.Q.list[[i]] = (sapply(strsplit(HIs.Q.list[[i]], " "), "[[", 4))
HIs.Q.list[[i]] = as.numeric(gsub("%", "", HIs.Q.list[[i]]))
HIs.df.list[[i]] = as.data.frame(cbind(HIs.list[[i]], HIs.Q.list[[i]]))
HIs.df.list[[i]]= HIs.df.list[[i]][order(HIs.df.list[[i]][["V2"]]),]
names(HIs.df.list[[i]]) = c("HI", "Q_interval")
}
CARI.HI.df = bind_rows(HIs.df.list, .id = "column_label")
CARI.HI.df$storm.ID = c(rep("CARI_storm1_05_08_NO3", 50),
rep("CARI_storm1_05_08_fDOM", 50),
rep("CARI_storm1_05_08_SPC", 50),
rep("CARI_storm1_05_08_turb", 50),
rep("CARI_storm2_06_30_NO3", 50),
rep("CARI_storm2_06_30_fDOM", 50),
rep("CARI_storm2_06_30_SPC", 50),
rep("CARI_storm2_06_30_turb", 50),
rep("CARI_storm3_07_12_NO3", 50),
rep("CARI_storm3_07_12_fDOM", 50),
rep("CARI_storm3_07_12_SPC", 50),
rep("CARI_storm3_07_12_turb", 50),
rep("CARI_storm5_07_31_NO3", 50),
rep("CARI_storm5_07_31_fDOM", 50),
rep("CARI_storm5_07_31_SPC", 50),
rep("CARI_storm5_07_31_turb", 50),
rep("CARI_storm6a_08_02_NO3", 50),
rep("CARI_storm6a_08_02_fDOM", 50),
rep("CARI_storm6a_08_02_SPC", 50),
rep("CARI_storm6a_08_02_turb", 50),
rep("CARI_storm6b_08_03_NO3", 50),
rep("CARI_storm6b_08_03_fDOM", 50),
rep("CARI_storm6b_08_03_SPC", 50),
rep("CARI_storm6b_08_03_turb", 50),
rep("CARI_storm6c_08_05_NO3", 50),
rep("CARI_storm6c_08_05_fDOM", 50),
rep("CARI_storm6c_08_05_SPC", 50),
rep("CARI_storm6c_08_05_turb", 50),
rep("CARI_storm6d_08_10_NO3", 50),
rep("CARI_storm6d_08_10_fDOM", 50),
rep("CARI_storm6d_08_10_SPC", 50),
rep("CARI_storm6d_08_10_turb", 50),
rep("CARI_storm7b_08_13_NO3", 50),
rep("CARI_storm7b_08_13_fDOM", 50),
rep("CARI_storm7b_08_13_SPC", 50),
rep("CARI_storm7b_08_13_turb", 50),
rep("CARI_storm8_08_16_NO3", 49),
rep("CARI_storm8_08_16_fDOM", 50),
rep("CARI_storm8_08_16_SPC", 50),
rep("CARI_storm8_08_16_turb", 50))
View(CARI.HI.df)
CARI.HI.df %>%
group_by(column_label) %>%
mutate(Diff = Q_interval - lag(Q_interval))
test <- CARI.HI.df %>%
group_by(column_label) %>%
mutate(Diff = Q_interval - lag(Q_interval))
View(test)
which(test$Diff > 2)
CARI.HI.df$storm.ID = c(rep("CARI_storm1_05_08_NO3", 50),
rep("CARI_storm1_05_08_fDOM", 50),
rep("CARI_storm1_05_08_SPC", 50),
rep("CARI_storm1_05_08_turb", 50),
rep("CARI_storm2_06_30_NO3", 50),
rep("CARI_storm2_06_30_fDOM", 50),
rep("CARI_storm2_06_30_SPC", 50),
rep("CARI_storm2_06_30_turb", 50),
rep("CARI_storm3_07_12_NO3", 50),
rep("CARI_storm3_07_12_fDOM", 50),
rep("CARI_storm3_07_12_SPC", 50),
rep("CARI_storm3_07_12_turb", 50),
rep("CARI_storm5_07_31_NO3", 50),
rep("CARI_storm5_07_31_fDOM", 50),
rep("CARI_storm5_07_31_SPC", 50),
rep("CARI_storm5_07_31_turb", 50),
rep("CARI_storm6a_08_02_NO3", 50),
rep("CARI_storm6a_08_02_fDOM", 50),
rep("CARI_storm6a_08_02_SPC", 50),
rep("CARI_storm6a_08_02_turb", 50),
rep("CARI_storm6b_08_03_NO3", 50),
rep("CARI_storm6b_08_03_fDOM", 50),
rep("CARI_storm6b_08_03_SPC", 50),
rep("CARI_storm6b_08_03_turb", 50),
rep("CARI_storm6c_08_05_NO3", 49),
rep("CARI_storm6c_08_05_fDOM", 50),
rep("CARI_storm6c_08_05_SPC", 50),
rep("CARI_storm6c_08_05_turb", 50),
rep("CARI_storm6d_08_10_NO3", 48),
rep("CARI_storm6d_08_10_fDOM", 50),
rep("CARI_storm6d_08_10_SPC", 50),
rep("CARI_storm6d_08_10_turb", 50),
rep("CARI_storm7b_08_13_NO3", 50),
rep("CARI_storm7b_08_13_fDOM", 50),
rep("CARI_storm7b_08_13_SPC", 50),
rep("CARI_storm7b_08_13_turb", 50),
rep("CARI_storm8_08_16_NO3", 49),
rep("CARI_storm8_08_16_fDOM", 50),
rep("CARI_storm8_08_16_SPC", 50),
rep("CARI_storm8_08_16_turb", 50))
CARI.HI.df$storm.ID = as.factor(CARI.HI.df$storm.ID)
CARI.HI.df = separate(data=CARI.HI.df, col=storm.ID, into=c("site.ID","storm.num", "month", "day", "response"), sep = "_", remove = F)
par(mfrow=c(1,1))
median_cl_boot <- function(x, conf = 0.95) {
lconf <- (1 - conf)/2
uconf <- 1 - lconf
require(boot)
bmedian <- function(x, ind) median(x[ind])
bt <- boot(x, bmedian, 10000)
bb <- boot.ci(bt, conf = 0.95, type = "perc")
data.frame(y = median(x), ymin = quantile(bt$t, lconf), ymax = quantile(bt$t,
uconf))
}
g0 <- ggplot(CARI.HI.df, aes(x = storm.num, y = HI, label=storm.num, fill=response))
g1 = g0 + geom_jitter(width = 0.1, fill = "grey", colour = "#0571B0", alpha=0.25, size=3) +
theme(axis.text.x = element_text(angle = 0))+  labs(x="") + facet_wrap(~ response, scales = "free_x") +
theme_bw() +geom_hline(yintercept=0) + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(legend.position = "none")
g2 <- g1 +
stat_summary(fun.data = median_cl_boot, geom = "errorbar",
colour = "black", width = 0.2, size=1) +
stat_summary(fun.y = median, geom = "point",
colour = "black", size = 3)
ggsave("~/Documents/Storms_clean_repo/plots/HI_plots/2019/CARI/CARI.HI.median.boot.pdf", plot=g2, width = 8, height = 6, units ="in")
write.csv(CARI.HI.df, "~/Documents/Storms_clean_repo/Output_from_analysis/03_HI_FI/2019/CARI/CARI.HI.df.csv")
CARI.HI.df$date <- as.Date(with(CARI.HI.df, paste(month, day, sep = "-")), "%m-%d")
CARI.HI.df$doy <- yday(CARI.HI.df$date)
g0 <- ggplot(CARI.HI.df, aes(x = doy, y = HI, label=doy, fill=response))
g1 = g0 + geom_jitter(width = 0.1, fill = "grey", colour = "#0571B0", alpha=0.25, size=3) +
theme(axis.text.x = element_text(angle = 0))+  labs(x="") + facet_wrap(~ response, scales = "free_x") +
theme_bw() +geom_hline(yintercept=0) + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(legend.position = "none")
g2 <- g1 +
stat_summary(fun.data = median_cl_boot, geom = "errorbar",
colour = "black", width = 0.2, size=1) +
stat_summary(fun.y = median, geom = "point",
colour = "black", size = 3)
ggsave("~/Documents/Storms_clean_repo/plots/HI_plots/2019/CARI/CARI.HI.median.boot.doy.pdf", plot=g2, width = 8, height = 6, units ="in")
write.csv(CARI.HI.df, "~/Documents/Storms_clean_repo/Output_from_analysis/03_HI_FI/2019/CARI/CARI.HI.df.doy.csv")
reticulate::repl_python()
