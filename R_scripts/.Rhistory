abline(v= as.POSIXct("2018-06-21 01:30:00", tz="America/Anchorage"), col="purple")
abline(v= as.POSIXct("2018-06-24 01:00:00", tz="America/Anchorage"), col="purple")
FRCH_storm1_06_21 = FRCH[FRCH$DateTime > as.POSIXct("2018-06-21 01:30:00", tz="America/Anchorage") &
FRCH$DateTime < as.POSIXct("2018-06-24 01:00:00", tz="America/Anchorage"),]
plot(FRCH_storm1_06_21$MeanDischarge ~ as.POSIXct(FRCH_storm1_06_21$DateTime, tz="America/Anchorage"), type="l", xlab="", ylab="Q (L/sec)",ylim = c(400,600), col="blue", main="FRCH 180621 storm 1",
xlim = as.POSIXct(c("2018-06-15 00:00:00","2018-06-30 23:45:00"), tz="America/Anchorage"))
lines(FRCH$nitrateuM * 25 ~ FRCH$DateTime, type="l", xlab="", ylab="", col="purple",
xlim = as.POSIXct(c("2019-05-01 00:00:00","2019-10-15 01:00:00"), tz="America/Anchorage"))
lines(FRCH$fDOM.QSU * 10 ~ FRCH$DateTime, type="l", xlab="", ylab="", col="brown",
xlim = as.POSIXct(c("2019-05-01 00:00:00","2019-10-15 01:00:00"), tz="America/Anchorage"))
lines(FRCH$SpCond.uScm * 6 ~ FRCH$DateTime, type="l", xlab="", ylab="", col="red",
xlim = as.POSIXct(c("2019-05-01 00:00:00","2019-10-15 01:00:00"), tz="America/Anchorage"))
lines(FRCH$Turbidity.FNU * 100 ~ FRCH$DateTime, type="l", xlab="", ylab="", col="black",
xlim = as.POSIXct(c("2019-05-01 00:00:00","2019-10-15 01:00:00"), tz="America/Anchorage"))
par(new = T)
plot(POKE.st$inst_rainfall_mm ~ POKE.st$DateTime, type="h",
xlim = as.POSIXct(c("2018-06-15 00:00:00","2018-06-30 23:45:00"), tz="America/Anchorage"),
ylim = c(10,0),
axes=F, xlab="", ylab="")
axis(side = 4)
# Storm 2a #
plot(FRCH$MeanDischarge ~ FRCH$DateTime, type="l", xlab="", ylab="Q (L/sec)",
xlim = as.POSIXct(c("2018-06-28 00:00:00","2018-07-15 23:45:00"), tz="America/Anchorage"))
abline(h=FRCH_bfQ_mn*2, col="red", lty=2)
abline(h=FRCH_bfQ_mn, col="red")
par(new = T)
plot(POKE.st$inst_rainfall_mm ~ POKE.st$DateTime, type="h",
xlim = as.POSIXct(c("2018-06-28 00:00:00","2018-07-15 23:45:00"), tz="America/Anchorage"),
ylim = c(10,0),
axes=F, xlab="", ylab="")
axis(side = 4)
mtext(side = 4, line = 3, 'CRREL Met Station precip. (mm)')
abline(v = as.POSIXct(poke.five.fourty.eight$DateTime), col = "yellow", lwd = 0.1)
abline(v = as.POSIXct(poke.five.twenty.four$DateTime), col="green", lwd = 0.1)
abline(v= as.POSIXct("2018-06-29 18:30:00", tz="America/Anchorage"), col="purple")
abline(v= as.POSIXct("2018-07-04 14:00:00", tz="America/Anchorage"), col="purple")
FRCH_storm2a_06_29 = FRCH[FRCH$DateTime > as.POSIXct("2018-06-29 18:30:00", tz="America/Anchorage") &
FRCH$DateTime < as.POSIXct("2018-07-04 14:00:00", tz="America/Anchorage"),]
plot(FRCH_storm2a_06_29$MeanDischarge ~ as.POSIXct(FRCH_storm2a_06_29$DateTime, tz="America/Anchorage"), type="l", xlab="", ylab="Q (L/sec)",ylim = c(300,1200), col="blue", main="FRCH 180629 storm 2a",
xlim = as.POSIXct(c("2018-06-28 00:00:00","2018-07-15 23:45:00"), tz="America/Anchorage"))
lines(FRCH$nitrateuM * 25 ~ FRCH$DateTime, type="l", xlab="", ylab="", col="purple",
xlim = as.POSIXct(c("2019-05-01 00:00:00","2019-10-15 01:00:00"), tz="America/Anchorage"))
lines(FRCH$fDOM.QSU * 10 ~ FRCH$DateTime, type="l", xlab="", ylab="", col="brown",
xlim = as.POSIXct(c("2019-05-01 00:00:00","2019-10-15 01:00:00"), tz="America/Anchorage"))
abline(v= as.POSIXct("2018-06-29 18:30:00", tz="America/Anchorage"), col="purple")
abline(v= as.POSIXct("2018-06-29 18:30:00"), col="purple")
abline(v= as.POSIXct("2018-06-29 23:30:00"), col="purple")
abline(v= as.POSIXct("2018-06-30 02:30:00"), col="purple")
abline(v= as.POSIXct("2018-07-04 24:00:00", tz="America/Anchorage"), col="purple")
abline(v= as.POSIXct("2018-07-04 23:00:00", tz="America/Anchorage"), col="purple")
abline(v= as.POSIXct("2018-07-04 23:00:00", ), col="purple")
rm(POKE.st)
POKE.st <- read_csv("~/Documents/DoD_2018_Jake/RainGauge/POKE.RainGauge.2018.csv")
head(POKE.st$DateTime)
attributes(POKE.st$DateTime)$tzone <- 'America/Anchorage'
head(POKE.st$DateTime)
rm(POKE.st)
### Sum daily discharge ###
POKE.st$twentyfour <- rollapplyr(POKE.st$inst_rainfall_mm, 96, sum, na.rm = TRUE, fill = NA, partial = TRUE)
POKE.st$fourtyeight <- rollapplyr(POKE.st$inst_rainfall_mm, 192, sum, na.rm = TRUE, fill = NA, partial = TRUE)
# Greater than 5 #
poke.five.twenty.four <- POKE.st[which(POKE.st$twentyfour >= 5),] # twenty four hour period where the precip is 5
POKE.st <- read_csv("~/Documents/DoD_2018_Jake/RainGauge/POKE.RainGauge.2018.csv")
### Sum daily discharge ###
POKE.st$twentyfour <- rollapplyr(POKE.st$inst_rainfall_mm, 96, sum, na.rm = TRUE, fill = NA, partial = TRUE)
POKE.st$fourtyeight <- rollapplyr(POKE.st$inst_rainfall_mm, 192, sum, na.rm = TRUE, fill = NA, partial = TRUE)
# Greater than 5 #
poke.five.twenty.four <- POKE.st[which(POKE.st$twentyfour >= 5),] # twenty four hour period where the precip is 5
poke.five.fourty.eight <- POKE.st[which(POKE.st$fourtyeight >= 5),] # fourty eight hour period where the precip is greater than 10
# Greater than 10 #
poke.ten.twenty.four <- POKE.st[which(POKE.st$twentyfour >= 10),] # twenty four hour period where the precip is 10
poke.ten.fourty.eight <- POKE.st[which(POKE.st$fourtyeight >= 10),] # fourty eight hour period where the precip is greater than 10
### Precip Discharge Chem ###
#FRCH#
# rename the columns to what they were to save me a bunch of time going back and changing every call to a column
names(FRCH) <- c("DateTime", "Site", "MeanDischarge", "day",
"fDOM.QSU", "SpCond.uScm", "Turbidity.FNU",
"nitrateuM")
#plots
plot(POKE.st$inst_rainfall_mm ~ POKE.st$DateTime, type="h",
xlim = as.POSIXct(c("2018-05-01 0:00:00","2018-10-15 00:00:00"), tz="America/Anchorage"),
ylim = c(10,0),
axes=F, xlab="", ylab="")
axis(side = 4)
mtext(side = 4, line = 3, 'POKE precip. (mm)')
abline(v = as.POSIXct(poke.five.fourty.eight$DateTime), col="yellow", lwd = 0.1)
abline(v = as.POSIXct(poke.five.twenty.four$DateTime), col = "green", lwd = 0.1)
par(new = T)
plot(POKE.st$inst_rainfall_mm ~ POKE.st$DateTime, type="h",
xlim = as.POSIXct(c("2018-05-01 0:00:00","2018-10-15 00:00:00"), tz="America/Anchorage"),
ylim = c(10,0),
axes=F, xlab="", ylab="")
par(new = T)
plot(FRCH$MeanDischarge ~ FRCH$DateTime, type="l", xlab="", ylab="Q (L/sec)",
xlim = as.POSIXct(c("2018-05-01 00:00:00","2018-10-15 00:00:00"), tz="America/Anchorage"))
abline(h=FRCH_bfQ_mn*2, col="red", lty=2)
abline(h=FRCH_bfQ_mn, col="red")
lines(FRCH$nitrateuM * 25 ~ FRCH$DateTime, type="l", xlab="", ylab="", col="purple",
xlim = as.POSIXct(c("2018-05-01 00:00:00","2018-10-15 01:00:00"), tz="America/Anchorage"))
lines(FRCH$fDOM.QSU * 10 ~ FRCH$DateTime, type="l", xlab="", ylab="", col="brown",
xlim = as.POSIXct(c("2018-05-01 00:00:00","2018-10-15 01:00:00"), tz="America/Anchorage"))
lines(FRCH$SpCond.uScm * 4 ~ FRCH$DateTime, type="l", xlab="", ylab="", col="red",
xlim = as.POSIXct(c("2018-05-01 00:00:00","2018-10-15 01:00:00"), tz="America/Anchorage"))
lines(FRCH$Turbidity.FNU * 100 ~ FRCH$DateTime, type="l", xlab="", ylab="", col="blue",
xlim = as.POSIXct(c("2018-05-01 00:00:00","2018-10-15 01:00:00"), tz="America/Anchorage"))
# NO chem until June 1st
# Storm 1 #
plot(FRCH$MeanDischarge ~ FRCH$DateTime, type="l", xlab="", ylab="Q (L/sec)",
xlim = as.POSIXct(c("2018-06-15 00:00:00","2018-06-30 23:45:00"), tz="America/Anchorage"))
abline(h=FRCH_bfQ_mn*2, col="red", lty=2)
abline(h=FRCH_bfQ_mn, col="red")
lines(FRCH$nitrateuM * 25 ~ FRCH$DateTime, type="l", xlab="", ylab="", col="purple",
xlim = as.POSIXct(c("2018-05-01 00:00:00","2018-10-15 01:00:00"), tz="America/Anchorage"))
lines(FRCH$fDOM.QSU * 10 ~ FRCH$DateTime, type="l", xlab="", ylab="", col="brown",
xlim = as.POSIXct(c("2018-05-01 00:00:00","2018-10-15 01:00:00"), tz="America/Anchorage"))
par(new = T)
plot(POKE.st$inst_rainfall_mm ~ POKE.st$DateTime, type="h",
xlim = as.POSIXct(c("2018-06-15 00:00:00","2018-06-30 23:45:00"), tz="America/Anchorage"),
ylim = c(10,0),
axes=F, xlab="", ylab="")
axis(side = 4)
mtext(side = 4, line = 3, 'CRREL Met Station precip. (mm)')
abline(v = as.POSIXct(poke.five.fourty.eight$DateTime), col = "yellow", lwd = 0.1)
abline(v = as.POSIXct(poke.five.twenty.four$DateTime), col="green", lwd = 0.1)
abline(v= as.POSIXct("2018-06-21 01:30:00", tz="America/Anchorage"), col="purple")
abline(v= as.POSIXct("2018-06-24 01:00:00", tz="America/Anchorage"), col="purple")
FRCH_storm1_06_21 = FRCH[FRCH$DateTime > as.POSIXct("2018-06-21 01:30:00", tz="America/Anchorage") &
FRCH$DateTime < as.POSIXct("2018-06-24 01:00:00", tz="America/Anchorage"),]
plot(FRCH_storm1_06_21$MeanDischarge ~ as.POSIXct(FRCH_storm1_06_21$DateTime, tz="America/Anchorage"), type="l", xlab="", ylab="Q (L/sec)",ylim = c(400,600), col="blue", main="FRCH 180621 storm 1",
xlim = as.POSIXct(c("2018-06-15 00:00:00","2018-06-30 23:45:00"), tz="America/Anchorage"))
lines(FRCH$nitrateuM * 25 ~ FRCH$DateTime, type="l", xlab="", ylab="", col="purple",
xlim = as.POSIXct(c("2019-05-01 00:00:00","2019-10-15 01:00:00"), tz="America/Anchorage"))
lines(FRCH$fDOM.QSU * 10 ~ FRCH$DateTime, type="l", xlab="", ylab="", col="brown",
xlim = as.POSIXct(c("2019-05-01 00:00:00","2019-10-15 01:00:00"), tz="America/Anchorage"))
lines(FRCH$SpCond.uScm * 6 ~ FRCH$DateTime, type="l", xlab="", ylab="", col="red",
xlim = as.POSIXct(c("2019-05-01 00:00:00","2019-10-15 01:00:00"), tz="America/Anchorage"))
lines(FRCH$Turbidity.FNU * 100 ~ FRCH$DateTime, type="l", xlab="", ylab="", col="black",
xlim = as.POSIXct(c("2019-05-01 00:00:00","2019-10-15 01:00:00"), tz="America/Anchorage"))
par(new = T)
plot(POKE.st$inst_rainfall_mm ~ POKE.st$DateTime, type="h",
xlim = as.POSIXct(c("2018-06-15 00:00:00","2018-06-30 23:45:00"), tz="America/Anchorage"),
ylim = c(10,0),
axes=F, xlab="", ylab="")
axis(side = 4)
# Storm 2a #
plot(FRCH$MeanDischarge ~ FRCH$DateTime, type="l", xlab="", ylab="Q (L/sec)",
xlim = as.POSIXct(c("2018-06-28 00:00:00","2018-07-15 23:45:00"), tz="America/Anchorage"))
abline(h=FRCH_bfQ_mn*2, col="red", lty=2)
abline(h=FRCH_bfQ_mn, col="red")
par(new = T)
plot(POKE.st$inst_rainfall_mm ~ POKE.st$DateTime, type="h",
xlim = as.POSIXct(c("2018-06-28 00:00:00","2018-07-15 23:45:00"), tz="America/Anchorage"),
ylim = c(10,0),
axes=F, xlab="", ylab="")
axis(side = 4)
mtext(side = 4, line = 3, 'CRREL Met Station precip. (mm)')
abline(v = as.POSIXct(poke.five.fourty.eight$DateTime), col = "yellow", lwd = 0.1)
abline(v = as.POSIXct(poke.five.twenty.four$DateTime), col="green", lwd = 0.1)
abline(v= as.POSIXct("2018-06-29 18:30:00"), col="purple")
head(FRCH$DateTime)
abline(v= as.POSIXct("2018-06-29 18:30:00", tz="America/Anchorage"), col="purple")
abline(v= as.POSIXct("2018-07-04 14:00:00", ), col="purple")
abline(v= as.POSIXct("2018-07-04 23:45:00", ), col="purple")
# Storm 2b #
plot(FRCH$MeanDischarge ~ FRCH$DateTime, type="l", xlab="", ylab="Q (L/sec)",
xlim = as.POSIXct(c("2018-06-28 00:00:00","2018-07-15 23:45:00"), tz="America/Anchorage"))
abline(h=FRCH_bfQ_mn*2, col="red", lty=2)
abline(h=FRCH_bfQ_mn, col="red")
par(new = T)
plot(POKE.st$inst_rainfall_mm ~ POKE.st$DateTime, type="h",
xlim = as.POSIXct(c("2018-06-28 00:00:00","2018-07-15 23:45:00"), tz="America/Anchorage"),
ylim = c(10,0),
axes=F, xlab="", ylab="")
axis(side = 4)
mtext(side = 4, line = 3, 'CRREL Met Station precip. (mm)')
abline(v = as.POSIXct(poke.five.fourty.eight$DateTime), col = "yellow", lwd = 0.1)
abline(v = as.POSIXct(poke.five.twenty.four$DateTime), col="green", lwd = 0.1)
abline(v= as.POSIXct("2018-07-04 14:30:00", tz="America/Anchorage"), col="purple")
abline(v= as.POSIXct("2018-07-08 14:00:00", tz="America/Anchorage"), col="purple")
# Storm 2b #
plot(FRCH$MeanDischarge ~ FRCH$DateTime, type="l", xlab="", ylab="Q (L/sec)",
xlim = as.POSIXct(c("2018-06-28 00:00:00","2018-07-15 23:45:00"), tz="America/Anchorage"))
head(FRCH$DateTime)
# Storm 2b #
attributes(FRCH$DateTime)$tzone <- "America/Anchorage"
head(FRCH$DateTime)
plot(FRCH$MeanDischarge ~ FRCH$DateTime, type="l", xlab="", ylab="Q (L/sec)",
xlim = as.POSIXct(c("2018-06-28 00:00:00","2018-07-15 23:45:00"), tz="America/Anchorage"))
abline(h=FRCH_bfQ_mn*2, col="red", lty=2)
abline(h=FRCH_bfQ_mn, col="red")
par(new = T)
plot(POKE.st$inst_rainfall_mm ~ POKE.st$DateTime, type="h",
xlim = as.POSIXct(c("2018-06-28 00:00:00","2018-07-15 23:45:00"), tz="America/Anchorage"),
ylim = c(10,0),
axes=F, xlab="", ylab="")
axis(side = 4)
mtext(side = 4, line = 3, 'CRREL Met Station precip. (mm)')
abline(v = as.POSIXct(poke.five.fourty.eight$DateTime), col = "yellow", lwd = 0.1)
abline(v = as.POSIXct(poke.five.twenty.four$DateTime), col="green", lwd = 0.1)
abline(v= as.POSIXct("2018-07-04 14:30:00", tz="America/Anchorage"), col="purple")
abline(v= as.POSIXct("2018-07-08 14:00:00", tz="America/Anchorage"), col="purple")
head(POKE.st$DateTime)
attributes(POKE.st$DateTime)$tzone <- "America/Anchorage"
plot(FRCH$MeanDischarge ~ FRCH$DateTime, type="l", xlab="", ylab="Q (L/sec)",
xlim = as.POSIXct(c("2018-06-28 00:00:00","2018-07-15 23:45:00"), tz="America/Anchorage"))
abline(h=FRCH_bfQ_mn*2, col="red", lty=2)
abline(h=FRCH_bfQ_mn, col="red")
par(new = T)
plot(POKE.st$inst_rainfall_mm ~ POKE.st$DateTime, type="h",
xlim = as.POSIXct(c("2018-06-28 00:00:00","2018-07-15 23:45:00"), tz="America/Anchorage"),
ylim = c(10,0),
axes=F, xlab="", ylab="")
axis(side = 4)
mtext(side = 4, line = 3, 'CRREL Met Station precip. (mm)')
abline(v = as.POSIXct(poke.five.fourty.eight$DateTime), col = "yellow", lwd = 0.1)
abline(v = as.POSIXct(poke.five.twenty.four$DateTime), col="green", lwd = 0.1)
abline(v= as.POSIXct("2018-07-04 14:30:00", tz="America/Anchorage"), col="purple")
abline(v= as.POSIXct("2018-07-08 14:00:00", tz="America/Anchorage"), col="purple")
# Storm 2b #
attributes(FRCH$DateTime)$tzone <- "America/Anchorage"
attributes(POKE.st$DateTime)$tzone <- "America/Anchorage"
plot(FRCH$MeanDischarge ~ FRCH$DateTime, type="l", xlab="", ylab="Q (L/sec)",
xlim = as.POSIXct(c("2018-06-28 00:00:00","2018-07-15 23:45:00"), tz="America/Anchorage"))
abline(h=FRCH_bfQ_mn*2, col="red", lty=2)
abline(h=FRCH_bfQ_mn, col="red")
abline(v= as.POSIXct("2018-07-04 14:30:00", tz="America/Anchorage"), col="purple")
abline(v= as.POSIXct("2018-07-08 14:00:00", tz="America/Anchorage"), col="purple")
par(new = T)
plot(POKE.st$inst_rainfall_mm ~ POKE.st$DateTime, type="h",
xlim = as.POSIXct(c("2018-06-28 00:00:00","2018-07-15 23:45:00"), tz="America/Anchorage"),
ylim = c(10,0),
axes=F, xlab="", ylab="")
axis(side = 4)
mtext(side = 4, line = 3, 'CRREL Met Station precip. (mm)')
abline(v = as.POSIXct(poke.five.fourty.eight$DateTime), col = "yellow", lwd = 0.1)
abline(v = as.POSIXct(poke.five.twenty.four$DateTime), col="green", lwd = 0.1)
abline(v= as.POSIXct("2018-07-04 14:30:00", tz="America/Anchorage"), col="purple")
abline(v= as.POSIXct("2018-07-08 14:00:00", tz="America/Anchorage"), col="purple")
reticulate::repl_python()
CARI.hyst.results.list = list(py$hysdict_CARI_storm2_06_21_NO3,
py$hysdict_CARI_storm2_06_21_fDOM,
py$hysdict_CARI_storm2_06_21_SPC,
py$hysdict_CARI_storm2_06_21_turb,
py$hysdict_CARI_storm3_06_29_NO3,
py$hysdict_CARI_storm3_06_29_fDOM,
py$hysdict_CARI_storm3_06_29_SPC,
py$hysdict_CARI_storm3_06_29_turb,
py$hysdict_CARI_storm5a_08_04_NO3,
py$hysdict_CARI_storm5a_08_04_fDOM,
py$hysdict_CARI_storm5a_08_04_SPC,
py$hysdict_CARI_storm5a_08_04_turb,
py$hysdict_CARI_storm5b_08_05_NO3,
py$hysdict_CARI_storm5b_08_05_fDOM,
py$hysdict_CARI_storm5b_08_05_SPC,
py$hysdict_CARI_storm5b_08_05_turb,
py$hysdict_CARI_storm5c_08_06_NO3,
py$hysdict_CARI_storm5c_08_06_fDOM,
py$hysdict_CARI_storm5c_08_06_SPC,
py$hysdict_CARI_storm5c_08_06_turb,
py$hysdict_CARI_storm6_08_13_NO3,
py$hysdict_CARI_storm6_08_13_fDOM,
py$hysdict_CARI_storm6_08_13_SPC,
py$hysdict_CARI_storm6_08_13_turb,
py$hysdict_CARI_storm7_08_21_NO3,
py$hysdict_CARI_storm7_08_21_fDOM,
py$hysdict_CARI_storm7_08_21_SPC,
py$hysdict_CARI_storm7_08_21_turb,
py$hysdict_CARI_storm8_08_24_NO3,
py$hysdict_CARI_storm8_08_24_fDOM,
py$hysdict_CARI_storm8_08_24_SPC,
py$hysdict_CARI_storm8_08_24_turb,
py$hysdict_CARI_storm9_08_26_NO3,
py$hysdict_CARI_storm9_08_26_fDOM,
py$hysdict_CARI_storm9_08_26_SPC,
py$hysdict_CARI_storm9_08_26_turb,
py$hysdict_CARI_storm10_08_30_NO3,
py$hysdict_CARI_storm10_08_30_fDOM,
py$hysdict_CARI_storm10_08_30_SPC,
py$hysdict_CARI_storm10_08_30_turb,
py$hysdict_CARI_storm11_09_02_NO3,
py$hysdict_CARI_storm11_09_02_fDOM,
py$hysdict_CARI_storm11_09_02_SPC,
py$hysdict_CARI_storm11_09_02_turb,
py$hysdict_CARI_storm12a_09_20_NO3,
py$hysdict_CARI_storm12a_09_20_fDOM,
py$hysdict_CARI_storm12a_09_20_SPC,
py$hysdict_CARI_storm12a_09_20_turb,
py$hysdict_CARI_storm12b_09_25_fDOM,
py$hysdict_CARI_storm12b_09_25_SPC,
py$hysdict_CARI_storm12b_09_25_turb)
CARI.hyst.results.list.2 = list()
for (i in 1:length(CARI.hyst.results.list)){
CARI.hyst.results.list.2[[i]] = as.data.frame(t(as.numeric(c(
CARI.hyst.results.list[[i]][["HI_mean_with_Interp"]],
CARI.hyst.results.list[[i]][["HI_standard_deviation_with_Interp"]],
CARI.hyst.results.list[[i]][["Normalized slope of response"]],
CARI.hyst.results.list[[i]][["interpolated Max width of response"]],
CARI.hyst.results.list[[i]][["Min response"]],
CARI.hyst.results.list[[i]][["Max response"]],
CARI.hyst.results.list[[i]][["Peak Q"]]
))))
names(CARI.hyst.results.list.2[[i]]) = c("HI_mean_Interp", "HI_sd_with_Interp", "N.S.", "Max_width_Interp", "Min_response", "Max_response", "Peak_Q")
}
HIs.list = list()
HIs.tests = list()
for (i in 1:length(CARI.hyst.results.list)){
HIs.list[[i]] = unlist(CARI.hyst.results.list[[i]][["Hysteresis_Index"]],recursive=FALSE)
HIs.tests[[i]] = as.data.frame(t(round(as.numeric(c(shapiro.test(HIs.list[[i]])$statistic, shapiro.test(HIs.list[[i]])$p.value,
t.test(HIs.list[[i]], mu=0)$statistic, t.test(HIs.list[[i]], mu=0)$p.value,
t.test(HIs.list[[i]], mu=0)$conf.int[1],t.test(HIs.list[[i]], mu=0)$conf.int[2],
wilcox.test(HIs.list[[i]], mu=0)$statistic, wilcox.test(HIs.list[[i]], mu=0)$p.value)), 4)))
names(HIs.tests[[i]]) = c("ShapiroTest.W", "ShapiroTest.p", "t.test.stat", "t.test.p", "t.test.CIlow", "t.test.CIhigh",
"wilcox.test.stat", "wilcox.test.p")
}
CARI.hyst.results.list.3 =list()
for (i in 1:length(CARI.hyst.results.list)){
CARI.hyst.results.list.3[[i]] = cbind(CARI.hyst.results.list.2[[i]], HIs.tests[[i]])
}
CARI.hyst.results.df = bind_rows(CARI.hyst.results.list.3, .id = "column_label")
CARI.hyst.results.df$storm.ID = c(
"CARI_storm2_06_21_NO3",
"CARI_storm2_06_21_fDOM",
"CARI_storm2_06_21_SPC",
"CARI_storm2_06_21_turb",
"CARI_storm3_06_29_NO3",
"CARI_storm3_06_29_fDOM",
"CARI_storm3_06_29_SPC",
"CARI_storm3_06_29_turb",
"CARI_storm5a_08_04_NO3",
"CARI_storm5a_08_04_fDOM",
"CARI_storm5a_08_04_SPC",
"CARI_storm5a_08_04_turb",
"CARI_storm5b_08_05_NO3",
"CARI_storm5b_08_05_fDOM",
"CARI_storm5b_08_05_SPC",
"CARI_storm5b_08_05_turb",
"CARI_storm5c_08_06_NO3",
"CARI_storm5c_08_06_fDOM",
"CARI_storm5c_08_06_SPC",
"CARI_storm5c_08_06_turb",
"CARI_storm6_08_13_NO3",
"CARI_storm6_08_13_fDOM",
"CARI_storm6_08_13_SPC",
"CARI_storm6_08_13_turb",
"CARI_storm7_08_21_NO3",
"CARI_storm7_08_21_fDOM",
"CARI_storm7_08_21_SPC",
"CARI_storm7_08_21_turb",
"CARI_storm8_08_24_NO3",
"CARI_storm8_08_24_fDOM",
"CARI_storm8_08_24_SPC",
"CARI_storm8_08_24_turb",
"CARI_storm9_08_26_NO3",
"CARI_storm9_08_26_fDOM",
"CARI_storm9_08_26_SPC",
"CARI_storm9_08_26_turb",
"CARI_storm10_08_30_NO3",
"CARI_storm10_08_30_fDOM",
"CARI_storm10_08_30_SPC",
"CARI_storm10_08_30_turb",
"CARI_storm11_09_02_NO3",
"CARI_storm11_09_02_fDOM",
"CARI_storm11_09_02_SPC",
"CARI_storm11_09_02_turb",
"CARI_storm12a_09_20_NO3",
"CARI_storm12a_09_20_fDOM",
"CARI_storm12a_09_20_SPC",
"CARI_storm12a_09_20_turb",
"CARI_storm12b_09_25_fDOM",
"CARI_storm12b_09_25_SPC",
"CARI_storm12b_09_25_turb"
)
CARI.hyst.results.df$site.ID = "CARI"
write.csv(CARI.hyst.results.df, "~/Documents/Storms_clean_repo/Output_from_analysis/03_HI_FI/2018/CARI/CARI.hyst.results.csv")
# plot HI by normalized discharge
HIs.Q.list =list()
HIs.df.list = list()
#pdf("~/Documents/Storms/Output_from_analysis/HI_plots/2018/CARI/CARI.hyst.HI_Q.plots.pdf", width = 25, height =15, onefile=FALSE)
par(mfrow=c(4,7))
for (i in 1:length(HIs.list)) {
HIs.Q.list[[i]] = names(HIs.list[[i]])
HIs.Q.list[[i]] = (sapply(strsplit(HIs.Q.list[[i]], " "), "[[", 4))
HIs.Q.list[[i]] = as.numeric(gsub("%", "", HIs.Q.list[[i]]))
HIs.df.list[[i]] = as.data.frame(cbind(HIs.list[[i]], HIs.Q.list[[i]]))
HIs.df.list[[i]]= HIs.df.list[[i]][order(HIs.df.list[[i]][["V2"]]),]
plot(HIs.df.list[[i]][["V1"]] ~ HIs.df.list[[i]][["V2"]], type="l",
ylab="norm.response", xlab="Q intervals", main= CARI.hyst.results.df$storm.ID[i])
abline(h=0, lty=2)
}
dev.off()
## plot HI with bootstrapped 95% CIs around the median ##
HIs.Q.list =list()
HIs.df.list = list()
par(mfrow=c(1,1))
for (i in 1:length(HIs.list)) {
HIs.Q.list[[i]] = names(HIs.list[[i]])
HIs.Q.list[[i]] = (sapply(strsplit(HIs.Q.list[[i]], " "), "[[", 4))
HIs.Q.list[[i]] = as.numeric(gsub("%", "", HIs.Q.list[[i]]))
HIs.df.list[[i]] = as.data.frame(cbind(HIs.list[[i]], HIs.Q.list[[i]]))
HIs.df.list[[i]]= HIs.df.list[[i]][order(HIs.df.list[[i]][["V2"]]),]
names(HIs.df.list[[i]]) = c("HI", "Q_interval")
}
CARI.HI.df = bind_rows(HIs.df.list, .id = "column_label")
CARI.HI.df$storm.ID = c(
rep("CARI_storm2_06_21_NO3", 50),
rep("CARI_storm2_06_21_fDOM", 50),
rep("CARI_storm2_06_21_SPC", 50),
rep("CARI_storm2_06_21_turb", 50),
rep("CARI_storm3_06_29_NO3", 50),
rep("CARI_storm3_06_29_fDOM", 50),
rep("CARI_storm3_06_29_SPC", 50),
rep("CARI_storm3_06_29_turb", 50),
rep("CARI_storm5a_08_04_NO3", 50),
rep("CARI_storm5a_08_04_fDOM", 50),
rep("CARI_storm5a_08_04_SPC", 50),
rep("CARI_storm5a_08_04_turb", 50),
rep("CARI_storm5b_08_05_NO3", 50),
rep("CARI_storm5b_08_05_fDOM", 50),
rep("CARI_storm5b_08_05_SPC", 50),
rep("CARI_storm5b_08_05_turb", 50),
rep("CARI_storm5c_08_06_NO3", 50),
rep("CARI_storm5c_08_06_fDOM", 50),
rep("CARI_storm5c_08_06_SPC", 50),
rep("CARI_storm5c_08_06_turb", 50),
rep("CARI_storm6_08_13_NO3", 50),
rep("CARI_storm6_08_13_fDOM", 50),
rep("CARI_storm6_08_13_SPC", 50),
rep("CARI_storm6_08_13_turb", 50),
rep("CARI_storm7_08_21_NO3", 50),
rep("CARI_storm7_08_21_fDOM", 50),
rep("CARI_storm7_08_21_SPC", 50),
rep("CARI_storm7_08_21_turb", 50),
rep("CARI_storm8_08_24_NO3", 50),
rep("CARI_storm8_08_24_fDOM", 50),
rep("CARI_storm8_08_24_SPC", 50),
rep("CARI_storm8_08_24_turb", 50),
rep("CARI_storm9_08_26_NO3", 50),
rep("CARI_storm9_08_26_fDOM", 50),
rep("CARI_storm9_08_26_SPC", 50),
rep("CARI_storm9_08_26_turb", 50),
rep("CARI_storm10_08_30_NO3", 50),
rep("CARI_storm10_08_30_fDOM", 50),
rep("CARI_storm10_08_30_SPC", 50),
rep("CARI_storm10_08_30_turb", 50),
rep("CARI_storm11_09_02_NO3", 50),
rep("CARI_storm11_09_02_fDOM", 50),
rep("CARI_storm11_09_02_SPC", 50),
rep("CARI_storm11_09_02_turb", 50),
rep("CARI_storm12a_09_20_NO3", 50),
rep("CARI_storm12a_09_20_fDOM", 50),
rep("CARI_storm12a_09_20_SPC", 50),
rep("CARI_storm12a_09_20_turb", 50),
rep("CARI_storm12b_09_25_fDOM", 50),
rep("CARI_storm12b_09_25_SPC", 50),
rep("CARI_storm12b_09_25_turb", 50))
CARI.HI.df$storm.ID = as.factor(CARI.HI.df$storm.ID)
CARI.HI.df = separate(data=CARI.HI.df, col=storm.ID, into=c("site.ID","storm.num", "month", "day", "response"), sep = "_", remove = F)
par(mfrow=c(1,1))
median_cl_boot <- function(x, conf = 0.95) {
lconf <- (1 - conf)/2
uconf <- 1 - lconf
require(boot)
bmedian <- function(x, ind) median(x[ind])
bt <- boot(x, bmedian, 10000)
bb <- boot.ci(bt, conf = 0.95, type = "perc")
data.frame(y = median(x), ymin = quantile(bt$t, lconf), ymax = quantile(bt$t,
uconf))
}
g0 <- ggplot(CARI.HI.df, aes(x = storm.num, y = HI, label=storm.num, fill=response))
g1 = g0 + geom_jitter(width = 0.1, fill = "grey", colour = "#0571B0", alpha=0.25, size=3) +
theme(axis.text.x = element_text(angle = 0))+  labs(x="") + facet_wrap(~ response, scales = "free_x") +
theme_bw() +geom_hline(yintercept=0) + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(legend.position = "none")
g2 <- g1 +
stat_summary(fun.data = median_cl_boot, geom = "errorbar",
colour = "black", width = 0.2, size=1) +
stat_summary(fun.y = median, geom = "point",
colour = "black", size = 3)
ggsave("~/Documents/Storms_clean_repo/plots/HI_plots/2018/CARI/CARI.HI.median.boot.pdf", plot=g2, width = 8, height = 6, units ="in")
write.csv(CARI.HI.df, "~/Documents/Storms_clean_repo/Output_from_analysis/03_HI_FI/2018/CARI/CARI.HI.df.csv")
CARI.HI.df <- read_csv("~/Documents/Storms/Output_from_analysis/HI_plots/2018/CARI/CARI.HI.df.csv")
CARI.HI.df$date <- as.Date(with(CARI.HI.df, paste(month, day, sep = "-")), "%m-%d")
CARI.HI.df$doy <- yday(CARI.HI.df$date)
g0 <- ggplot(CARI.HI.df, aes(x = doy, y = HI, label=doy, fill=response))
g1 = g0 + geom_jitter(width = 0.1, fill = "grey", colour = "#0571B0", alpha=0.25, size=3) +
theme(axis.text.x = element_text(angle = 0))+  labs(x="") + facet_wrap(~ response, scales = "free_x") +
theme_bw() +geom_hline(yintercept=0) + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + theme(legend.position = "none")
g2 <- g1 +
stat_summary(fun.data = median_cl_boot, geom = "errorbar",
colour = "black", width = 0.2, size=1) +
stat_summary(fun.y = median, geom = "point",
colour = "black", size = 3)
ggsave("~/Documents/Storms_clean_repo/plots/HI_plots/2018/CARI/CARI.HI.median.boot.doy.pdf", plot=g2, width = 8, height = 6, units ="in")
ggsave("~/Documents/Storms_clean_repo/plots/HI_plots/2018/CARI/CARI.HI.median.boot.doy.pdf", plot=g2, width = 8, height = 6, units ="in")
write.csv(CARI.HI.df, "~/Documents/Storms_clean_repo/Output_from_analysis/03_HI_FI/2018/CARI/CARI.HI.df.doy.csv")
FRCH.HI.2018 <- read.csv("~/Documents/Storms_clean_repo/Output_from_analysis/03_HI_FI/2018/FRCH/FRCH.hyst.results.csv")
MOOS.HI.2018 <- read.csv("~/Documents/Storms_clean_repo/Output_from_analysis/03_HI_FI/2018/MOOS/MOOS.hyst.results.csv")
CARI.HI.2018 <- read.csv("~/Documents/Storms_clean_repo/Output_from_analysis/03_HI_FI/2018/CARI/CARI.hyst.results.csv")
HI.2018 <- rbind(FRCH.HI.2018, MOOS.HI.2018, CARI.HI.2018)
HI.2018$year <- "2018"
all.results <- rbind(HI.2018)
all.results$date <- as.Date(with(all.results, paste(year, month, day,sep="-")), "%Y-%m-%d")
setwd("~/Documents/Storms_clean_repo")
knitr::opts_chunk$set(echo = TRUE)
library(reticulate)
Sys.which("python")
use_python("/usr/bin/python")
library(tidyverse)
options(tz="America/Anchorage")
library(ggplot2)
library(gridExtra)
library(boot)
reticulate::repl_python()
