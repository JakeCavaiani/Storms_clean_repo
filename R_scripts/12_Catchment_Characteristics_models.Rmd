---
title: "12_Catchment_Characteristics_models"
author: "Jake Cavaiani"
date: "9/14/2022"
output:
  word_document: default
  html_document: default
---

#load libraries 
```{r}
library(here)
library(tidyverse)
library(nlme)
library(forecast)
library(stats)
library(readr)
library(ggplot2)
library(plotly)
library(GGally)
library(ggpmisc)
library(ggpubr)
library(ggExtra)
library(lubridate)
library(nlme)
library(MuMIn)
library(multcomp)
library(lme4)
library(car)
library(ggeffects)
library(dotwhisker)
library(broom)
library(jtools)
library(sjPlot)
```


``` {r}
# reading in data 
AMC <- read.csv("~/Documents/Storms_clean_repo/Output_from_analysis/08_Catchment_characteristics/Antecedent_HI_BETA_Catchment.csv")

# removing a bunch of the catchment characteristic columns that are unnecessary 
AMC <- AMC[,-c(1:3,9,10,18,19,21,22,25:28,42:50,52:56,60:65,67:81,83,85,86)]
AMC <- AMC[!duplicated(AMC$Hyst_index), ] # removing duplicated rows 

AMC <- AMC %>%
  mutate(across(c(pctburn_lg), 
                ~ifelse(site.ID == "CARI", 40, .)))


```


```{r}
# taking the mean HI for each catchment and year 
CV.all.year <- AMC %>% group_by(response_var,site.ID, year) %>%
  dplyr::summarise(meanHI = mean(Hyst_index, na.rm = TRUE),
                   meanBETA = mean(Beta_index, na.rm = TRUE),
                   sdHI = sd(Hyst_index, na.rm = TRUE),
                   sdBETA = sd(Beta_index, na.rm = TRUE),
                  CVhi = sdHI/meanHI,
                  CVbeta = sdBETA/meanBETA,
                  CatBurn = paste(burn),
                  CatPF = paste(pf),
                  Slope = as.numeric(SLOPE_MEAN),
                  fireyear_lg = as.numeric(fireyear_lg),
                  pctburn_lg = as.numeric(pctburn_lg),
                  areaburn_lg = as.numeric(areaburn_lg),
                  PF = as.numeric(Pf_Prob_1m_mean_x),
                  NDVI = as.numeric(NDVI_p50))


CV.all.year <- CV.all.year[!duplicated(CV.all.year$meanHI), ] # removing duplicated rows
# NDVI didnt properly merge over so manually putting in the NDVI value for each year 
CV.all.year[c(1,22,42,63),17] <- 0.192390502 # CARI 2018
CV.all.year[c(2,23,43,64),17] <- 0.247047948 # CARI 2019
CV.all.year[c(3,24,44,65),17] <- 0.192382581 # CARI 2020
CV.all.year[c(4,25,45,66),17] <- NA # CARI 2021

CV.all.year[c(5,26,46,67),17] <- 0.186534723 # FRCH 2018
CV.all.year[c(6,27,47,68),17] <- 0.26075781 # FRCH 2019
CV.all.year[c(7,28,48,69),17] <- 0.190424498 # FRCH 2020
CV.all.year[c(8,29,49,70),17] <- NA  # FRCH 2021

CV.all.year[c(9,30,50,71),17] <- 0.200191538 # MOOS 2018
CV.all.year[c(10,31,51,72),17] <- 0.258797953 # MOOS 2019
CV.all.year[c(11,32,52,73),17] <- 0.229493425 # MOOS 2020
CV.all.year[c(12,33,53,74),17] <- NA # MOOS 2021

CV.all.year[c(13,34,54,75),17] <- 0.247071561 # POKE 2019
CV.all.year[c(14,35,55,76),17] <- 0.217774775 # POKE 2020
CV.all.year[c(15,36,56,77),17] <- NA # POKE 2021

CV.all.year[c(16,36,57,78),17] <- 0.274414997 # STRT 2019
CV.all.year[c(17,37,58,79),17] <- 0.23730122 # STRT 2020
CV.all.year[c(18,38,59,80),17] <- NA # STRT 2021

CV.all.year[c(19,39,60,81),17] <- 0.229493954 # VAUL 2019
CV.all.year[c(20,40,61,82),17] <- 0.225580538 # VAUL 2020
CV.all.year[c(21,41,62,83),17] <- NA # VAUL 2021


```

```{r}
# scaling data # 
#scaling # 
CV.all.year[c("Slope", "fireyear_lg", "pctburn_lg", "areaburn_lg", "PF", "NDVI")] <- lapply(CV.all.year[c("Slope", "fireyear_lg", "pctburn_lg", "areaburn_lg", "PF", "NDVI")], function(x) c(scale(x)))

CV_all_year_NO3 = subset(CV.all.year, response_var == "NO3")
# fDOM #
CV_all_year_fDOM = subset(CV.all.year, response_var == "fDOM")
# SPC #
CV_all_year_SPC = subset(CV.all.year, response_var == "SPC")
# turb #
CV_all_year_turb = subset(CV.all.year, response_var == "turb")

```

```{r}
# testing to see if outliers are real from the input data 
# VAUL_2019 for NO3 has a really low meanHI...lets investigate that 

# VAUL_NO3_2019 <- subset(AMC, site.ID == "VAUL" & year == "2019" & response_var == "NO3")
# 
# mean(VAUL_NO3_2019$Hyst_index)
# 
# ggplot(VAUL_NO3_2019, aes(Beta_index, Hyst_index)) +
#   geom_errorbar(aes(ymin = HI_ymin, ymax = HI_ymax), color = "black", alpha = 0.5, size = 0.5, width = 0.05) +
#   geom_errorbarh(aes(xmin = Beta_ymin, xmax = Beta_ymax), colour = "black", alpha = 0.5, size = .5, height = 0.05) +
#   geom_point(aes(colour = factor(site.ID), shape = pf), size = 2.5) +
#   geom_hline(yintercept = 0) + geom_vline(xintercept = 0) 
# 
# ggplot(HI_FI_NO3, aes(Beta_index, Hyst_index)) + 
#   geom_errorbar(aes(ymin = HI_ymin, ymax = HI_ymax), colour = "black", alpha = 0.5, size = .5, width = 0.05)+ 
#   geom_errorbarh(aes(xmin = Beta_ymin, xmax = Beta_ymax), colour = "black", alpha = 0.5, size = .5, height = 0.05) +
#   geom_point(aes(colour = factor(site.ID), shape = pf), size = 2.5) +
#   geom_hline(yintercept = 0) + geom_vline(xintercept = 0) +
#   scale_color_manual(values=c("#3288BD","#FF7F00", "#A6761D", "#6A3D9A", "#66C2A5", "#E7298A")) + 
#   theme_bw() +
#   ylim(-1.5, 1.5) + xlim(-1.5, 1.5)+
#   ggtitle(vn)+ 
#   ylab("HI") +
#   xlab("") +
#   theme(panel.border = element_blank(), 
#         panel.grid.major = element_blank(),
#         panel.grid.minor = element_blank(), 
#         axis.line = element_line(colour = "black"), 
#         text = element_text(size = 15),
#         legend.position = "none") +
#     labs(
#       colour = "Catchment",
#       shape = "PF Extent")

```

# NO3
```{r}

CV.all <- AMC %>% group_by(response_var,site.ID) %>%
  dplyr::summarise(meanHI = mean(Hyst_index, na.rm = TRUE),
                   meanBETA = mean(Beta_index, na.rm = TRUE),
                   sdHI = sd(Hyst_index, na.rm = TRUE),
                   sdBETA = sd(Beta_index, na.rm = TRUE),
                  CVhi = sdHI/meanHI,
                  CVbeta = sdBETA/meanBETA,
                  CatBurn = paste(burn),
                  CatPF = paste(pf),
                  Slope = as.numeric(SLOPE_MEAN),
                  fireyear_lg = as.numeric(fireyear_lg),
                  pctburn_lg = as.numeric(pctburn_lg),
                  areaburn_lg = as.numeric(areaburn_lg),
                  PF = as.numeric(Pf_Prob_1m_mean_x),
                  NDVI = as.numeric(NDVI_p50))

CV.all <- CV.all[!duplicated(CV.all$meanHI), ] # removing duplicated rows


CV_all_NO3 = subset(CV.all, response_var == "NO3")
# fDOM #
CV_all_fDOM = subset(CV.all, response_var == "fDOM")
# SPC #
CV_all_SPC = subset(CV.all, response_var == "SPC")
# turb #
CV_all_turb = subset(CV.all, response_var == "turb")

NO3_data_year<- CV_all_year_NO3[,c("site.ID", "year", "meanHI", "meanBETA", "CVhi", "CVbeta", "Slope", "fireyear_lg", "pctburn_lg", "areaburn_lg", "PF", "NDVI", "CatBurn", "CatPF")]

NO3_data<- CV_all_NO3[,c("site.ID", "meanHI", "meanBETA", "CVhi", "CVbeta", "Slope", "fireyear_lg", "pctburn_lg", "areaburn_lg", "PF", "NDVI", "CatBurn", "CatPF")]


ggpairs(NO3_data_year,
        columns = c("meanHI","Slope", "pctburn_lg", "PF"),
        ggplot2::aes(colour = site.ID))

# ggsave("pairs1.pdf",
#        width = 10, height = 10)

```

# NO3
# HI model - year  
```{r}
HI.no3.year <- lmer(meanHI ~ CatPF*pctburn_lg + (1|year), 
             data = NO3_data_year)
summary(HI.no3.year) # year is adding little variance 

# pctburn_lg is the more significant predictor here but still relatively small with a t-value < 2
vif(HI.no3.year)



```
# diagnostic plot 
```{r, echo=FALSE}
plot(HI.no3.year, type=c("p","smooth"), col.line=1)
plot(HI.no3.year,
     sqrt(abs(resid(.)))~fitted(.),
     type=c("p","smooth"), col.line=1)
lattice::qqmath(HI.no3.year)

```

```{r}
pr <- ggpredict(HI.no3.year)
plot(pr, add.data = TRUE)

tab_model(HI.no3.year)


```

```{r}
# Trying to get a meanHI vs. pct_burn plot with two linear regression lines of best fit for categorical PF extent 
ggplot(NO3_data_year, aes(x = pctburn_lg, y = meanHI, color = CatPF)) +
  xlab("Burn") +
  ylab("Hysteresis") +
  geom_point() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = CatPF)) +
  scale_color_manual(values = c("#0072B2", "#CC79A7"), "PF Extent") +
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "left",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  theme_classic()
  
# high pf : #0072B2
# med pf: #CC79A7

```

# HI model - all years 
```{r}
HI.no3 <- lm(meanHI ~ CatPF*pctburn_lg, 
             data = NO3_data)
summary(HI.no3) # nothing is significant here 

vif(HI.no3)
plot(HI.no3)
```

# BETA model- year 
```{r}
BETA.no3.year <- lmer(meanBETA ~ CatPF*pctburn_lg + (1|year), 
             data = NO3_data_year)
summary(BETA.no3.year) # year is adding NO variance
# looks like PF is the winner here but not very high 
 
vif(BETA.no3.year)

```


```{r, echo=FALSE}
plot(BETA.no3.year, type=c("p","smooth"), col.line=1)
plot(BETA.no3.year,
     sqrt(abs(resid(.)))~fitted(.),
     type=c("p","smooth"), col.line=1)
lattice::qqmath(BETA.no3.year)
```


```{r}
pr <- ggpredict(BETA.no3.year)
plot(pr, add.data = TRUE)
```
```{r}
# Trying to get a meanHI vs. pct_burn plot with two linear regression lines of best fit for categorical PF extent 
ggplot(NO3_data_year, aes(x = pctburn_lg, y = meanBETA, color = CatPF)) +
  xlab("Burn") +
  ylab("BETA") +
  geom_point() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = CatPF)) +
  scale_color_manual(values = c("#0072B2", "#CC79A7"), "PF Extent") +
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "left",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  theme_classic()
  
# high pf : #0072B2
# med pf: #CC79A7

```

# BETA model - all years 
```{r}
BETA.no3 <- lm(meanBETA ~ CatPF*pctburn_lg, 
             data = NO3_data)
summary(BETA.no3) # nothing is significant here 
 
vif(BETA.no3)
plot(BETA.no3)
```

```{r}
pr <- ggpredict(BETA.no3)
plot(pr, add.data = TRUE)

```

# CVHI model 
```{r}
CVhi.no3.year <- lmer(CVhi ~ CatPF*pctburn_lg + (1|year), 
             data = NO3_data_year)
summary(CVhi.no3.year) # year is adding variance
#pctburn_lg narrowly edges out PF 

vif(CVhi.no3.year)

```

```{r, echo=FALSE}
plot(CVhi.no3.year, type=c("p","smooth"), col.line=1)
plot(CVhi.no3.year,
     sqrt(abs(resid(.)))~fitted(.),
     type=c("p","smooth"), col.line=1)
lattice::qqmath(CVhi.no3.year)
```

# let me log transform 
```{r}
NO3_data_year$logCVhi <- log(abs(NO3_data_year$CVhi))

CVhi.no3.year.log <- lmer(logCVhi ~ CatPF*pctburn_lg + (1|year), 
             data = NO3_data_year)
summary(CVhi.no3.year) # year is adding variance
#pctburn_lg narrowly edges out PF 

vif(CVhi.no3.year)

```

```{r, echo=FALSE}
plot(CVhi.no3.year.log, type=c("p","smooth"), col.line=1)
plot(CVhi.no3.year.log,
     sqrt(abs(resid(.)))~fitted(.),
     type=c("p","smooth"), col.line=1)
lattice::qqmath(CVhi.no3.year.log)
```


```{r}
pr <- ggpredict(CVhi.no3.year)
plot(pr, add.data = TRUE)

```

```{r}
# Trying to get a meanHI vs. pct_burn plot with two linear regression lines of best fit for categorical PF extent 
ggplot(NO3_data_year, aes(x = pctburn_lg, y = CVhi, color = CatPF)) +
  xlab("Burn") +
  ylab("CVhi") +
  geom_point() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = CatPF)) +
  scale_color_manual(values = c("#0072B2", "#CC79A7"), "PF Extent") +
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "left",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  theme_classic()
  
# high pf : #0072B2
# med pf: #CC79A7

```

```{r}
CVno3 <- NO3_data_year %>% 
  group_by(CatPF) %>% 
  dplyr::summarise(meanCVhi = mean(CVhi),
                   meanCVbeta = mean(CVbeta))


```


# CVBETA model 
```{r}
CVbeta.no3.year <- lmer(CVbeta ~ CatPF*areaburn_lg + (1|year), 
             data = NO3_data_year)
summary(CVbeta.no3.year) # year is adding variance 
# PF is more significant but these arent really doing anything 

vif(CVbeta.no3.year)

```

```{r, echo=FALSE}
plot(CVbeta.no3.year, type=c("p","smooth"), col.line=1)
plot(CVbeta.no3.year,
     sqrt(abs(resid(.)))~fitted(.),
     type=c("p","smooth"), col.line=1)
lattice::qqmath(CVbeta.no3.year)
```
residuals dont look great. What if I log transform here

# let me log transform 
```{r}
NO3_data_year$logCVbeta <- log(abs(NO3_data_year$CVbeta))

CVbeta.no3.year.log <- lmer(logCVbeta ~ CatPF*pctburn_lg + (1|year), 
             data = NO3_data_year)
summary(CVbeta.no3.year.log) # year is adding variance
#pctburn_lg narrowly edges out PF 

vif(CVbeta.no3.year.log)

```



```{r, echo=FALSE}
plot(CVbeta.no3.year.log, type=c("p","smooth"), col.line=1)
plot(CVbeta.no3.year.log,
     sqrt(abs(resid(.)))~fitted(.),
     type=c("p","smooth"), col.line=1)
lattice::qqmath(CVbeta.no3.year.log)
```
This is better but we have two big points for CARI 2020 and POKE 2020 that could be causing this issue


```{r}
pr <- ggpredict(CVbeta.no3.year)
plot(pr, add.data = TRUE)

```


```{r}
# Trying to get a meanHI vs. pct_burn plot with two linear regression lines of best fit for categorical PF extent 
ggplot(NO3_data_year, aes(x = pctburn_lg, y = CVbeta, color = CatPF)) +
  xlab("Burn") +
  ylab("CV BETA") +
  geom_point() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = CatPF)) +
  scale_color_manual(values = c("#0072B2", "#CC79A7"), "PF Extent") +
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "left",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  theme_classic()
  
# high pf : #0072B2
# med pf: #CC79A7

```

# fDOM # 
```{r}
fDOM_data_year<- CV_all_year_fDOM[,c("site.ID", "year", "meanHI", "meanBETA", "CVhi", "CVbeta", "Slope", "fireyear_lg", "pctburn_lg", "areaburn_lg", "PF", "NDVI", "CatBurn", "CatPF")]

fDOM_data<- CV_all_fDOM[,c("site.ID", "meanHI", "meanBETA", "CVhi", "CVbeta", "Slope", "fireyear_lg", "pctburn_lg", "areaburn_lg", "PF", "NDVI", "CatBurn", "CatPF")]

ggpairs(fDOM_data_year,
        columns = c("meanHI","Slope", "pctburn_lg", "PF"),
        ggplot2::aes(colour = site.ID))

CVfDOM <- fDOM_data_year %>% 
  group_by(CatPF) %>% 
  dplyr::summarise(meanCVhi = mean(abs(CVhi)),
                   meanCVbeta = mean(abs(CVbeta)))

# ggsave("pairs1.pdf",
#        width = 10, height = 10)

```


# HI model - year 
```{r}
HI.fDOM.year <- lmer(meanHI ~ CatPF*pctburn_lg + (1|year), 
             data = fDOM_data_year)
summary(HI.fDOM.year) # year is adding 0 variance 
# pct_burn is the more significant but they are both pretty big 

vif(HI.fDOM.year)

```

```{r, echo=FALSE}
plot(HI.fDOM.year, type=c("p","smooth"), col.line=1)
plot(HI.fDOM.year,
     sqrt(abs(resid(.)))~fitted(.),
     type=c("p","smooth"), col.line=1)
lattice::qqmath(HI.fDOM.year)
```


```{r}
pr <- ggpredict(HI.fDOM.year)
plot(pr, add.data = TRUE)

```

```{r}
# Trying to get a meanHI vs. pct_burn plot with two linear regression lines of best fit for categorical PF extent 
ggplot(fDOM_data_year, aes(x = pctburn_lg, y = meanHI, color = CatPF)) +
  xlab("Burn") +
  ylab("Hysteresis") +
  geom_point() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = CatPF)) +
  scale_color_manual(values = c("#0072B2", "#CC79A7"), "PF Extent") +
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "left",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  theme_classic()
  
# high pf : #0072B2
# med pf: #CC79A7

```


# HI model - all years
```{r}
HI.fDOM <- lm(meanHI ~ CatPF*pctburn_lg, 
             data = fDOM_data)
summary(HI.fDOM) 
# nothing is significant 
plot(HI.fDOM)

```

# BETA model - year 
```{r}
BETA.fDOM.year <- lmer(meanBETA ~ CatPF*pctburn_lg + (1|year), 
             data = fDOM_data_year)
summary(BETA.fDOM.year) # year is adding variance 
# pctburn is adding more individually but the interaction term in the biggest 

vif(BETA.fDOM.year)

```

```{r, echo=FALSE}
plot(BETA.fDOM.year, type=c("p","smooth"), col.line=1)
plot(BETA.fDOM.year,
     sqrt(abs(resid(.)))~fitted(.),
     type=c("p","smooth"), col.line=1)
lattice::qqmath(BETA.fDOM.year)
```
let me log transform to see if its better:


```{r}
# log transform 
fDOM_data_year$logmeanBETA <- log(abs(fDOM_data_year$meanBETA))

BETA.fDOM.year.log <- lmer(logmeanBETA ~ CatPF*pctburn_lg + (1|year), 
             data = fDOM_data_year)
summary(BETA.fDOM.year.log)

vif(BETA.fDOM.year.log)

```


```{r, echo=FALSE}
plot(BETA.fDOM.year.log, type=c("p","smooth"), col.line=1)
plot(BETA.fDOM.year.log,
     sqrt(abs(resid(.)))~fitted(.),
     type=c("p","smooth"), col.line=1)
lattice::qqmath(BETA.fDOM.year.log)
```
this looks worse TBH


```{r}
pr <- ggpredict(BETA.fDOM.year)
plot(pr, add.data = TRUE)

```

```{r}
# Trying to get a meanHI vs. pct_burn plot with two linear regression lines of best fit for categorical PF extent 
ggplot(fDOM_data_year, aes(x = pctburn_lg, y = meanBETA, color = CatPF)) +
  xlab("Burn") +
  ylab("BETA") +
  geom_point() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = CatPF)) +
  scale_color_manual(values = c("#0072B2", "#CC79A7"), "PF Extent") +
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "left",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  theme_classic()
  
# high pf : #0072B2
# med pf: #CC79A7

```

# CVHI model 
```{r}
CVhi.fDOM.year <- lmer(CVhi ~ CatPF*pctburn_lg + (1|year), 
             data = fDOM_data_year)
summary(CVhi.fDOM.year)

vif(CVhi.fDOM.year)

```

```{r, echo=FALSE}
plot(CVhi.fDOM.year, type=c("p","smooth"), col.line=1)
plot(CVhi.fDOM.year,
     sqrt(abs(resid(.)))~fitted(.),
     type=c("p","smooth"), col.line=1)
lattice::qqmath(CVhi.fDOM.year)
```
Lets log transform 

```{r}
#log transform 
fDOM_data_year$logCVhi <- log(abs(fDOM_data_year$CVhi))
CVhi.fDOM.year.log <- lmer(logCVhi ~ CatPF*pctburn_lg + (1|year), 
             data = fDOM_data_year)
summary(CVhi.fDOM.year.log) # year is adding NO variance 
# pctburn_lg is more significant on its own
# interaction has the highest t-value 

vif(CVhi.fDOM.year.log)

```

```{r, echo=FALSE}
plot(CVhi.fDOM.year.log, type=c("p","smooth"), col.line=1)
plot(CVhi.fDOM.year.log,
     sqrt(abs(resid(.)))~fitted(.),
     type=c("p","smooth"), col.line=1)
lattice::qqmath(CVhi.fDOM.year.log)
```
this looks better, lets interpret this:

```{r}
pr <- ggpredict(CVhi.fDOM.year.log)
plot(pr, add.data = TRUE)

```

```{r}
# Trying to get a meanHI vs. pct_burn plot with two linear regression lines of best fit for categorical PF extent 
ggplot(fDOM_data_year, aes(x = pctburn_lg, y = CVhi, color = CatPF)) +
  xlab("Burn") +
  ylab("CV Hysteresis") +
  geom_point() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = CatPF)) +
  scale_color_manual(values = c("#0072B2", "#CC79A7"), "PF Extent") +
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "left",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  theme_classic()
  
# high pf : #0072B2
# med pf: #CC79A7

```

```{r}
CVhi.fDOM <- lm(CVhi ~ CatPF*pctburn_lg, 
             data = fDOM_data)
summary(CVhi.fDOM) # nothing is significant 

plot(CVhi.fDOM)

```


# CVBETA model - year
```{r}
CVbeta.fDOM.year <- lmer(CVbeta ~ CatPF*pctburn_lg + (1|year), 
             data = fDOM_data_year)
summary(CVbeta.fDOM.year)

vif(CVbeta.fDOM.year)

```

```{r, echo=FALSE}
plot(CVbeta.fDOM.year, type=c("p","smooth"), col.line=1)
plot(CVbeta.fDOM.year,
     sqrt(abs(resid(.)))~fitted(.),
     type=c("p","smooth"), col.line=1)
lattice::qqmath(CVbeta.fDOM.year)
```
Let me log transform

```{r}
# log transform
fDOM_data_year$logCVbeta <- log(abs(fDOM_data_year$CVbeta))

CVbeta.fDOM.year.log <- lmer(logCVbeta ~ CatPF*pctburn_lg + (1|year), 
             data = fDOM_data_year)
summary(CVbeta.fDOM.year.log) # year adds 0 variance and nothing is really explaining it here 

```

```{r, echo=FALSE}
plot(CVbeta.fDOM.year.log, type=c("p","smooth"), col.line=1)
plot(CVbeta.fDOM.year.log,
     sqrt(abs(resid(.)))~fitted(.),
     type=c("p","smooth"), col.line=1)
lattice::qqmath(CVbeta.fDOM.year.log)
```
This still doesnt look great 

```{r}
pr <- ggpredict(CVbeta.fDOM.year.log)
plot(pr, add.data = TRUE)

```

```{r}
# Trying to get a meanHI vs. pct_burn plot with two linear regression lines of best fit for categorical PF extent 
ggplot(fDOM_data_year, aes(x = pctburn_lg, y = CVbeta, color = CatPF)) +
  xlab("Burn") +
  ylab("CV BETA") +
  geom_point() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = CatPF)) +
  scale_color_manual(values = c("#0072B2", "#CC79A7"), "PF Extent") +
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "left",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  theme_classic()
  
# high pf : #0072B2
# med pf: #CC79A7

```

```{r}
CVbeta.fDOM <- lm(logCVbeta ~ CatPF*pctburn_lg, 
             data = fDOM_data_year)
summary(CVbeta.fDOM) # nothing is significant 
plot(CVbeta.fDOM)
```

# SPC # 

```{r}
SPC_data_year<- CV_all_year_SPC[,c("site.ID", "year", "meanHI", "meanBETA", "CVhi", "CVbeta", "Slope", "fireyear_lg", "pctburn_lg", "areaburn_lg", "PF", "NDVI", "CatBurn", "CatPF")]

SPC_data<- CV_all_SPC[,c("site.ID", "meanHI", "meanBETA", "CVhi", "CVbeta", "Slope", "fireyear_lg", "pctburn_lg", "areaburn_lg", "PF", "NDVI", "CatBurn", "CatPF")]

ggpairs(SPC_data_year,
        columns = c("meanHI","Slope", "pctburn_lg", "PF"),
        ggplot2::aes(colour = site.ID))

# ggsave("pairs1.pdf",
#        width = 10, height = 10)

```


# HI model - year 
```{r}
HI.SPC.year <- lmer(meanHI ~ CatPF*pctburn_lg + (1|year), 
             data = SPC_data_year)
summary(HI.SPC.year) # year is adding to the variance
# nothing is really explaining anything here 

vif(HI.SPC.year)

```

```{r, echo=FALSE}
plot(HI.SPC.year, type=c("p","smooth"), col.line=1)
plot(HI.SPC.year,
     sqrt(abs(resid(.)))~fitted(.),
     type=c("p","smooth"), col.line=1)
lattice::qqmath(HI.SPC.year)
```
residuals arent the best....log transforming makes it worse 


```{r}
pr <- ggpredict(HI.SPC.year)
plot(pr, add.data = TRUE)

```

```{r}
# Trying to get a meanHI vs. pct_burn plot with two linear regression lines of best fit for categorical PF extent 
ggplot(SPC_data_year, aes(x = pctburn_lg, y = meanHI, color = CatPF)) +
  xlab("Burn") +
  ylab("Hysteresis") +
  geom_point() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = CatPF)) +
  scale_color_manual(values = c("#0072B2", "#CC79A7"), "PF Extent") +
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "left",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  theme_classic()
  
# high pf : #0072B2
# med pf: #CC79A7

```

# BETA model 
```{r}
BETA.SPC.year <- lmer(meanBETA ~ CatPF*pctburn_lg + (1|year), 
             data = SPC_data_year)
summary(BETA.SPC.year)

```

```{r, echo=FALSE}
plot(BETA.SPC.year, type=c("p","smooth"), col.line=1)
plot(BETA.SPC.year,
     sqrt(abs(resid(.)))~fitted(.),
     type=c("p","smooth"), col.line=1)
lattice::qqmath(BETA.SPC.year)
```
one point is making this meh...let me log transform 

```{r}
# log transform 
SPC_data_year$logmeanBETA <- log(abs(SPC_data_year$meanBETA))

BETA.SPC.year.log <- lmer(logmeanBETA ~ CatPF*pctburn_lg + (1|year), 
             data = SPC_data_year)
summary(BETA.SPC.year.log) # year is adding 0 variance 
# nothing is really explaining this here 

```

```{r, echo=FALSE}
plot(BETA.SPC.year.log, type=c("p","smooth"), col.line=1)
plot(BETA.SPC.year.log,
     sqrt(abs(resid(.)))~fitted(.),
     type=c("p","smooth"), col.line=1)
lattice::qqmath(BETA.SPC.year.log)
```

```{r}
pr <- ggpredict(BETA.SPC.year.log)
plot(pr, add.data = TRUE)

```


```{r}
# Trying to get a meanHI vs. pct_burn plot with two linear regression lines of best fit for categorical PF extent 
ggplot(SPC_data_year, aes(x = pctburn_lg, y = meanBETA, color = CatPF)) +
  xlab("Burn") +
  ylab("Hysteresis") +
  geom_point() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = CatPF)) +
  scale_color_manual(values = c("#0072B2", "#CC79A7"), "PF Extent") +
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "left",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  theme_classic()
  
# high pf : #0072B2
# med pf: #CC79A7

```

```{r}
BETA.SPC <- lm(meanBETA ~ CatPF*pctburn_lg, 
             data = SPC_data_year)
summary(BETA.SPC) # year is adding 0 variance 
# nothing is really explaining this here 
plot(BETA.SPC)
```

# CVHI model 
```{r}
SPC_data_year$logCVhi <- log(abs(SPC_data_year$CVhi))

CVhi.SPC.year.log <- lmer(CVhi ~ CatPF*pctburn_lg + (1|year), 
             data = SPC_data_year)
summary(CVhi.SPC.year.log) # year is adding to variance
# nothing is really explaining this here 

vif(CVhi.SPC.year.log)

```

```{r, echo=FALSE}
plot(CVhi.SPC.year.log, type=c("p","smooth"), col.line=1)
plot(CVhi.SPC.year.log,
     sqrt(abs(resid(.)))~fitted(.),
     type=c("p","smooth"), col.line=1)
lattice::qqmath(CVhi.SPC.year.log)
```
One point is really out of whack 
```{r}
pr <- ggpredict(CVhi.SPC.year.log)
plot(pr, add.data = TRUE)


```

```{r}
# Trying to get a meanHI vs. pct_burn plot with two linear regression lines of best fit for categorical PF extent 
ggplot(SPC_data_year, aes(x = pctburn_lg, y = CVhi, color = CatPF)) +
  xlab("Burn") +
  ylab("CV Hysteresis") +
  geom_point() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = CatPF)) +
  scale_color_manual(values = c("#0072B2", "#CC79A7"), "PF Extent") +
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "left",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  theme_classic()
  
# high pf : #0072B2
# med pf: #CC79A7

```

# CVBETA model 
```{r}
# log transform 
SPC_data_year$logCVbeta <- log(abs(SPC_data_year$CVbeta))
CVbeta.SPC.year.log <- lmer(logCVbeta ~ CatPF*pctburn_lg + (1|year), 
             data = SPC_data_year)
summary(CVbeta.SPC.year.log) # year is adding 0 variance 
# nothing is really explaining anything really 

vif(CVbeta.SPC.year.log)

```

```{r, echo=FALSE}
plot(CVbeta.SPC.year.log, type=c("p","smooth"), col.line=1)
plot(CVbeta.SPC.year.log,
     sqrt(abs(resid(.)))~fitted(.),
     type=c("p","smooth"), col.line=1)
lattice::qqmath(CVbeta.SPC.year.log)
```

```{r}
CVbeta.SPC <- lm(logCVbeta ~ CatPF*pctburn_lg, 
             data = SPC_data_year)
summary(CVbeta.SPC) # year is adding 0 variance 
# nothing is really explaining anything really

plot(CVbeta.SPC)

```


```{r}
pr <- ggpredict(CVbeta.SPC.year.log)
plot(pr, add.data = TRUE)

```

```{r}
# Trying to get a meanHI vs. pct_burn plot with two linear regression lines of best fit for categorical PF extent 
ggplot(SPC_data_year, aes(x = pctburn_lg, y = CVbeta, color = CatPF)) +
  xlab("Burn") +
  ylab("CV BETA") +
  geom_point() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = CatPF)) +
  scale_color_manual(values = c("#0072B2", "#CC79A7"), "PF Extent") +
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "left",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  theme_classic()
  
# high pf : #0072B2
# med pf: #CC79A7

```

# turb # 
```{r}
turb_data_year<- CV_all_year_turb[,c("site.ID", "year", "meanHI", "meanBETA", "CVhi", "CVbeta", "Slope", "fireyear_lg", "pctburn_lg", "areaburn_lg", "PF", "NDVI", "CatBurn", "CatPF")]

turb_data<- CV_all_turb[,c("site.ID", "meanHI", "meanBETA", "CVhi", "CVbeta", "Slope", "fireyear_lg", "pctburn_lg", "areaburn_lg", "PF", "NDVI", "CatBurn", "CatPF")]

ggpairs(turb_data_year,
        columns = c("meanHI","Slope", "pctburn_lg", "PF"),
        ggplot2::aes(colour = site.ID))

CVturb <- turb_data_year %>% 
  group_by(CatPF) %>% 
  dplyr::summarise(meanCVhi = mean(abs(CVhi)),
                   meanCVbeta = mean(abs(CVbeta)))
# ggsave("pairs1.pdf",
#        width = 10, height = 10)

```


# HI model 
```{r}
turb_data_year$logmeanHI <- log(abs(turb_data_year$meanHI))

HI.turb.year.log <- lmer(logmeanHI ~ CatPF*pctburn_lg + (1|year), 
             data = turb_data_year)

summary(HI.turb.year.log) # year is adding some variance 
# pctburn_lg is more important individually but the interaction term is most significant though it has a low t-value(1.439)

vif(HI.turb.year.log)

```

```{r, echo=FALSE}
plot(HI.turb.year.log, type=c("p","smooth"), col.line=1)
plot(HI.turb.year.log,
     sqrt(abs(resid(.)))~fitted(.),
     type=c("p","smooth"), col.line=1)
lattice::qqmath(HI.turb.year.log)
```

```{r}
pr <- ggpredict(HI.turb.year.log)
plot(pr, add.data = TRUE)


```

```{r}
# Trying to get a meanHI vs. pct_burn plot with two linear regression lines of best fit for categorical PF extent 
ggplot(turb_data_year, aes(x = pctburn_lg, y = meanHI, color = CatPF)) +
  xlab("Burn") +
  ylab("Hysteresis") +
  geom_point() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = CatPF)) +
  scale_color_manual(values = c("#0072B2", "#CC79A7"), "PF Extent") +
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "left",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  theme_classic()
  
# high pf : #0072B2
# med pf: #CC79A7

```


# BETA model 
```{r}
BETA.turb.year <- lmer(meanBETA ~ CatPF*pctburn_lg + (1|year), 
             data = turb_data_year)
summary(BETA.turb.year) # year is adding variance
# PF is the big player here

vif(BETA.turb.year)

```

```{r, echo=FALSE}
plot(BETA.turb.year, type=c("p","smooth"), col.line=1)
plot(BETA.turb.year,
     sqrt(abs(resid(.)))~fitted(.),
     type=c("p","smooth"), col.line=1)
lattice::qqmath(BETA.turb.year)
```

```{r}
pr <- ggpredict(BETA.turb.year)
plot(pr, add.data = TRUE)

```


```{r}
# Trying to get a meanHI vs. pct_burn plot with two linear regression lines of best fit for categorical PF extent 
ggplot(turb_data_year, aes(x = pctburn_lg, y = meanBETA, color = CatPF)) +
  xlab("Burn") +
  ylab("BETA") +
  geom_point() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = CatPF)) +
  scale_color_manual(values = c("#0072B2", "#CC79A7"), "PF Extent") +
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "left",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  theme_classic()
  
# high pf : #0072B2
# med pf: #CC79A7

```

# CVHI model 
```{r}
CVhi.turb.year <- lmer(CVhi ~ CatPF*pctburn_lg + (1|year), 
             data = turb_data_year)
summary(CVhi.turb.year)

vif(CVhi.turb.year)

```

```{r, echo=FALSE}
plot(CVhi.turb.year, type=c("p","smooth"), col.line=1)
plot(CVhi.turb.year,
     sqrt(abs(resid(.)))~fitted(.),
     type=c("p","smooth"), col.line=1)
lattice::qqmath(CVhi.turb.year)
```
lets log transform 
```{r}
# log transform 
turb_data_year$logCVhi <- log(abs(turb_data_year$CVhi))

CVhi.turb.year.log <- lmer(logCVhi ~ CatPF*pctburn_lg + (1|year), 
             data = turb_data_year)
summary(CVhi.turb.year.log)

vif(CVhi.turb.year.log)

```

```{r, echo=FALSE}
plot(CVhi.turb.year.log, type=c("p","smooth"), col.line=1)
plot(CVhi.turb.year.log,
     sqrt(abs(resid(.)))~fitted(.),
     type=c("p","smooth"), col.line=1)
lattice::qqmath(CVhi.turb.year.log)
```


```{r}
pr <- ggpredict(CVhi.turb.year.log)
plot(pr, add.data = TRUE)

```

```{r}
# Trying to get a meanHI vs. pct_burn plot with two linear regression lines of best fit for categorical PF extent 
ggplot(turb_data_year, aes(x = pctburn_lg, y = CVhi, color = CatPF)) +
  xlab("Burn") +
  ylab("CV Hysteresis") +
  geom_point() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = CatPF)) +
  scale_color_manual(values = c("#0072B2", "#CC79A7"), "PF Extent") +
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "left",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  theme_classic()
  
# high pf : #0072B2
# med pf: #CC79A7

```

# CVBETA model 
```{r}
turb_data_year$logCVbeta <- log(abs(turb_data_year$CVbeta))

CVbeta.turb.year.log <- lmer(logCVbeta ~ CatPF*pctburn_lg + (1|year), 
             data = turb_data_year)
summary(CVbeta.turb.year.log)

vif(CVbeta.turb.year.log)

```

```{r, echo=FALSE}
plot(CVbeta.turb.year.log, type=c("p","smooth"), col.line=1)
plot(CVbeta.turb.year.log,
     sqrt(abs(resid(.)))~fitted(.),
     type=c("p","smooth"), col.line=1)
lattice::qqmath(CVbeta.turb.year.log)
```


```{r}
pr <- ggpredict(CVbeta.turb.year.log)
plot(pr, add.data = TRUE)

```

```{r}
# Trying to get a meanHI vs. pct_burn plot with two linear regression lines of best fit for categorical PF extent 
ggplot(turb_data_year, aes(x = pctburn_lg, y = CVbeta, color = CatPF)) +
  xlab("Burn") +
  ylab("CV BETA") +
  geom_point() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = CatPF)) +
  scale_color_manual(values = c("#0072B2", "#CC79A7"), "PF Extent") +
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "left",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  theme_classic()
  
# high pf : #0072B2
# med pf: #CC79A7

```

```{r}
CVbeta.turb <- lm(logCVbeta ~ CatPF*pctburn_lg, 
             data = turb_data_year)
summary(CVbeta.turb) # nothing is significant 

plot(CVbeta.turb)

```




### PLOTTING ###
# HI 
```{r}
ggplot(CV.all.year, aes(x = pctburn_lg, y = meanHI, color = CatPF)) +
  xlab("Burn") +
  ylab("Hysteresis") +
  geom_point() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = CatPF)) +
  scale_color_manual(values = c("#0072B2", "#CC79A7"), "PF Extent") +
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "left",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  theme_classic() +
  facet_wrap(~response_var, scales = "free")

ggsave(path = "~/Documents/Storms_clean_repo/plots/Catchment_characteristics", 
       filename = "HI_burn.pdf",
       width = 10, height = 10)


```

# BETA
```{r}
ggplot(CV.all.year, aes(x = pctburn_lg, y = meanBETA, color = CatPF)) +
  xlab("Burn") +
  ylab("BETA") +
  geom_point() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = CatPF)) +
  scale_color_manual(values = c("#0072B2", "#CC79A7"), "PF Extent") +
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "left",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  theme_classic() +
  facet_wrap(~response_var, scales = "free")

ggsave(path = "~/Documents/Storms_clean_repo/plots/Catchment_characteristics", 
       filename = "BETA_burn.pdf",
       width = 10, height = 10)

```


# CVhi
```{r}
ggplot(CV.all.year, aes(x = pctburn_lg, y = CVhi, color = CatPF)) +
  xlab("Burn") +
  ylab("CV Hysteresis") +
  geom_point() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = CatPF)) +
  scale_color_manual(values = c("#0072B2", "#CC79A7"), "PF Extent") +
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "left",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  theme_classic() +
  facet_wrap(~response_var, scales = "free")

ggsave(path = "~/Documents/Storms_clean_repo/plots/Catchment_characteristics", 
       filename = "CVhi_burn.pdf",
       width = 10, height = 10)


```

# CVbeta
```{r}
ggplot(CV.all.year, aes(x = pctburn_lg, y = CVbeta, color = CatPF)) +
  xlab("Burn") +
  ylab("CV BETA") +
  geom_point() +
  geom_smooth(method = "lm", na.rm = TRUE, fullrange = TRUE, aes(group = CatPF)) +
  scale_color_manual(values = c("#0072B2", "#CC79A7"), "PF Extent") +
  stat_poly_eq(formula = y~x,
               label.y = "top", label.x = "left",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) + 
  theme_classic() +
  facet_wrap(~response_var, scales = "free")

ggsave(path = "~/Documents/Storms_clean_repo/plots/Catchment_characteristics", 
       filename = "CVbeta_burn.pdf",
       width = 10, height = 10)



```


